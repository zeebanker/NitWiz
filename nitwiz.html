<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>NitWiz - Poker Player Intelligence</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Space+Grotesk:wght@700&family=Allura&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            /* Prevent pull-to-refresh on mobile */
            overscroll-behavior-y: contain;
            /* Better text rendering */
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            /* Smooth scrolling */
            scroll-behavior: smooth;
        }

        :root {
            --bg-dark: #0a0e27;
            --bg-mid: #1a1f3a;
            --purple-primary: #a855f7;
            --purple-light: #c084fc;
            --cyan-accent: #22d3ee;
            --orange-accent: #FF9A00;
            --white: #ffffff;
            
            /* Legacy mappings */
            --dark-bg: #0a0e27;
            --blue-accent: #22d3ee;
            --orange-primary: #a855f7;
            --card-white: #ffffff;
            --shadow-dark: rgba(10, 14, 39, 0.8);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: 
                /* Dark overlay */
                linear-gradient(135deg, rgba(10, 14, 39, 0.7) 0%, rgba(26, 31, 58, 0.8) 50%, rgba(15, 22, 41, 0.7) 100%),
                /* Brushed metal texture */
                repeating-linear-gradient(
                    0deg,
                    #c0c5ce 0px,
                    #d4d8de 1px,
                    #e8eaed 2px,
                    #d4d8de 3px,
                    #c0c5ce 4px,
                    #a8adb5 5px,
                    #c0c5ce 6px
                ),
                /* Base metallic color */
                linear-gradient(90deg, #b8bdc5 0%, #c8cdd5 50%, #b8bdc5 100%);
            color: var(--white);
            min-height: 100vh;
            padding: 1rem;
            position: relative;
            /* Touch optimizations */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            touch-action: manipulation;
            -webkit-overflow-scrolling: touch;
        }

        /* Add metallic shine effect */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                linear-gradient(
                    115deg,
                    transparent 0%,
                    rgba(255, 255, 255, 0.05) 30%,
                    transparent 50%,
                    rgba(255, 255, 255, 0.05) 70%,
                    transparent 100%
                );
            pointer-events: none;
            z-index: 0;
        }

        /* Remove old effect */
        body::after {
            display: none;
        }

        /* SPLASH SCREEN */
        #splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                linear-gradient(135deg, rgba(10, 14, 39, 0.7) 0%, rgba(26, 31, 58, 0.8) 50%, rgba(15, 22, 41, 0.7) 100%),
                repeating-linear-gradient(
                    0deg,
                    #c0c5ce 0px,
                    #d4d8de 1px,
                    #e8eaed 2px,
                    #d4d8de 3px,
                    #c0c5ce 4px,
                    #a8adb5 5px,
                    #c0c5ce 6px
                ),
                linear-gradient(90deg, #b8bdc5 0%, #c8cdd5 50%, #b8bdc5 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            cursor: pointer;
        }

        .splash-metal-sheet {
            background: linear-gradient(135deg, #d8dde5 0%, #c8ccd4 50%, #b8bdc5 100%);
            border: 3px solid #a8acb4;
            border-radius: 16px;
            padding: 4rem 6rem;
            box-shadow: 
                0 12px 32px rgba(0, 0, 0, 0.5),
                0 6px 16px rgba(0, 0, 0, 0.4),
                inset 0 3px 6px rgba(255, 255, 255, 0.5),
                inset 0 -3px 6px rgba(0, 0, 0, 0.3),
                inset 3px 0 6px rgba(255, 255, 255, 0.3),
                inset -3px 0 6px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .splash-logo {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 4.5rem;
            font-weight: 700;
            color: transparent;
            background: linear-gradient(135deg, #5a5e66 0%, #3a3e46 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 
                0 2px 0 rgba(255, 255, 255, 0.4),
                0 -2px 2px rgba(0, 0, 0, 0.7),
                2px 0 0 rgba(255, 255, 255, 0.2),
                -2px 0 2px rgba(0, 0, 0, 0.5);
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.4));
            letter-spacing: 2px;
            margin-bottom: 0.3rem;
        }

        .splash-subtitle {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 0.7rem;
            font-weight: 600;
            color: transparent;
            background: linear-gradient(135deg, #6a6e76 0%, #4a4e56 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 
                0 1px 0 rgba(255, 255, 255, 0.3),
                0 -1px 1px rgba(0, 0, 0, 0.5);
            letter-spacing: 4px;
            margin-bottom: 1.5rem;
        }

        .splash-logo-icon {
            display: flex;
            justify-content: center;
            margin-bottom: 1.5rem;
            position: relative;
        }

        .splash-logo-icon svg {
            filter: 
                drop-shadow(0 2px 0 rgba(255, 255, 255, 0.4))
                drop-shadow(0 -2px 2px rgba(0, 0, 0, 0.7))
                drop-shadow(2px 0 0 rgba(255, 255, 255, 0.2))
                drop-shadow(-2px 0 2px rgba(0, 0, 0, 0.5))
                drop-shadow(0 2px 4px rgba(0, 0, 0, 0.4));
        }

        .splash-suits-metal {
            font-size: 1.6rem;
            letter-spacing: 0.6rem;
            color: transparent;
            background: linear-gradient(135deg, #5a5e66 0%, #3a3e46 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 
                0 2px 0 rgba(255, 255, 255, 0.4),
                0 -2px 2px rgba(0, 0, 0, 0.7),
                2px 0 0 rgba(255, 255, 255, 0.2),
                -2px 0 2px rgba(0, 0, 0, 0.5);
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.4));
            margin-bottom: 3rem;
        }

        .splash-card-suits {
            display: flex;
            gap: 2rem;
            justify-content: center;
            align-items: center;
            margin-bottom: 6rem;
        }

        .splash-card-suits .suit {
            width: 48px;
            height: 48px;
            filter: drop-shadow(0 2px 2px rgba(255, 255, 255, 0.4))
                    drop-shadow(0 -2px 2px rgba(0, 0, 0, 0.6));
        }

        .splash-copyright {
            font-family: Arial, sans-serif;
            font-size: 0.7rem;
            color: transparent;
            background: linear-gradient(135deg, #6a6e76 0%, #4a4e56 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 
                0 1px 0 rgba(255, 255, 255, 0.3),
                0 -1px 1px rgba(0, 0, 0, 0.6);
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
            letter-spacing: 0.5px;
            margin-top: 3rem;
        }

        /* DASHBOARD GRID BUTTONS */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            padding: 1.5rem;
            max-width: 600px;
            margin: 0 auto;
            margin-bottom: 8rem; /* More space for exit button */
        }

        .dashboard-btn {
            background: linear-gradient(135deg, #d8dde5 0%, #c8ccd4 50%, #b8bdc5 100%);
            border: 3px solid #a8acb4;
            border-radius: 12px;
            padding: 1.5rem 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 
                0 8px 24px rgba(0, 0, 0, 0.3),
                0 4px 12px rgba(0, 0, 0, 0.2),
                inset 0 2px 4px rgba(255, 255, 255, 0.5),
                inset 0 -2px 4px rgba(0, 0, 0, 0.2),
                inset 2px 0 4px rgba(255, 255, 255, 0.3),
                inset -2px 0 4px rgba(0, 0, 0, 0.15);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            min-height: 110px;
            aspect-ratio: 1 / 1;
        }

        .dashboard-btn:hover {
            transform: translateY(-4px);
            box-shadow: 
                0 12px 32px rgba(0, 0, 0, 0.4),
                0 6px 16px rgba(0, 0, 0, 0.3),
                inset 0 2px 4px rgba(255, 255, 255, 0.5),
                inset 0 -2px 4px rgba(0, 0, 0, 0.2),
                inset 2px 0 4px rgba(255, 255, 255, 0.3),
                inset -2px 0 4px rgba(0, 0, 0, 0.15);
        }

        .dashboard-btn:active {
            transform: translateY(0px);
            box-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.2),
                inset 0 3px 6px rgba(0, 0, 0, 0.3),
                inset 0 -1px 2px rgba(255, 255, 255, 0.3);
        }

        .dashboard-btn svg {
            width: 36px;
            height: 36px;
            filter: drop-shadow(0 2px 2px rgba(255, 255, 255, 0.5))
                    drop-shadow(0 -2px 2px rgba(0, 0, 0, 0.4));
            stroke: #9333ea;
            opacity: 0.8;
        }

        .dashboard-btn span {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 0.85rem;
            font-weight: 700;
            color: transparent;
            background: linear-gradient(135deg, #5a5e66 0%, #3a3e46 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 
                0 1px 0 rgba(255, 255, 255, 0.4),
                0 -1px 1px rgba(0, 0, 0, 0.6);
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
            letter-spacing: 0.5px;
            text-align: center;
            line-height: 1.2;
        }

        /* EXIT BUTTON */
        .exit-btn {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 60px;
            padding: 0;
            border-radius: 10px;
            background: linear-gradient(135deg, #d8dde5 0%, #c8ccd4 50%, #b8bdc5 100%);
            border: 2px solid #a8acb4;
            box-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.3),
                0 2px 6px rgba(0, 0, 0, 0.2),
                inset 0 2px 3px rgba(255, 255, 255, 0.5),
                inset 0 -2px 3px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .exit-btn:hover {
            transform: translateX(-50%) translateY(-2px);
            box-shadow: 
                0 6px 16px rgba(0, 0, 0, 0.4),
                0 3px 8px rgba(0, 0, 0, 0.3),
                inset 0 2px 3px rgba(255, 255, 255, 0.5),
                inset 0 -2px 3px rgba(0, 0, 0, 0.2);
        }

        .exit-btn:active {
            transform: translateX(-50%) translateY(0px);
            box-shadow: 
                0 2px 6px rgba(0, 0, 0, 0.2),
                inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .exit-btn svg {
            width: 28px;
            height: 28px;
            filter: drop-shadow(0 1px 1px rgba(255, 255, 255, 0.4))
                    drop-shadow(0 -1px 1px rgba(0, 0, 0, 0.4));
            stroke: #dc2626;
            opacity: 1;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 2rem;
            background: 
                /* Brushed nickel texture */
                repeating-linear-gradient(
                    90deg,
                    #c8ccd4 0px,
                    #d8dce4 0.5px,
                    #e8ecf4 1px,
                    #d8dce4 1.5px,
                    #c8ccd4 2px
                ),
                /* Base metallic color */
                linear-gradient(180deg, #bfc3cb 0%, #d4d8e0 50%, #bfc3cb 100%);
            border-radius: 16px;
            border: 2px solid #a8acb4;
            box-shadow: 
                0 12px 32px rgba(0, 0, 0, 0.5),
                inset 0 3px 0 rgba(255, 255, 255, 0.7),
                inset 0 -3px 0 rgba(0, 0, 0, 0.35),
                inset 3px 0 0 rgba(255, 255, 255, 0.35),
                inset -3px 0 0 rgba(0, 0, 0, 0.25);
            position: relative;
        }

        header::before {
            content: '';
            position: absolute;
            top: -1px;
            left: -1px;
            right: -1px;
            bottom: -1px;
            background: linear-gradient(135deg, 
                rgba(168, 85, 247, 0.4) 0%, 
                transparent 50%, 
                rgba(34, 211, 238, 0.4) 100%);
            border-radius: 16px;
            z-index: -1;
            opacity: 0.6;
        }

        h1 {
            font-family: 'Allura', cursive;
            font-size: 4rem;
            font-weight: 400;
            color: transparent;
            background: linear-gradient(135deg, #5a5e66 0%, #3a3e46 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 
                0 2px 0 rgba(255, 255, 255, 0.4),
                0 -2px 2px rgba(0, 0, 0, 0.8),
                2px 0 0 rgba(255, 255, 255, 0.2),
                -2px 0 2px rgba(0, 0, 0, 0.6);
            filter: drop-shadow(0 3px 6px rgba(0, 0, 0, 0.5));
            margin-bottom: 0.5rem;
            line-height: 1.2;
        }

        .card-suits {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-top: 0.5rem;
            font-size: 2rem;
            font-style: italic;
            transform: skewX(-12deg);
        }

        .suit {
            color: transparent;
            background: linear-gradient(135deg, #5a5e66 0%, #3a3e46 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 
                0 1px 0 rgba(255, 255, 255, 0.3),
                0 -1px 1px rgba(0, 0, 0, 0.6),
                1px 0 0 rgba(255, 255, 255, 0.15),
                -1px 0 1px rgba(0, 0, 0, 0.4);
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.4));
        }

        .suit.spade::before { content: '♠'; }
        .suit.club::before { content: '♣'; }
        .suit.heart::before { content: '♥'; }
        .suit.diamond::before { content: '♦'; }

        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .tab {
            padding: 0.875rem 1.75rem;
            background: 
                /* Brushed nickel texture */
                repeating-linear-gradient(
                    90deg,
                    #c8ccd4 0px,
                    #d8dce4 0.5px,
                    #e8ecf4 1px,
                    #d8dce4 1.5px,
                    #c8ccd4 2px
                ),
                /* Base metallic */
                linear-gradient(180deg, #bfc3cb 0%, #d4d8e0 50%, #bfc3cb 100%);
            border: 2px solid #a8acb4;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 0.875rem;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 150px;
            text-align: center;
            box-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.5),
                inset 0 -1px 0 rgba(0, 0, 0, 0.25);
            color: #2a2e3a;
        }

        .tab:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 6px 16px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.6),
                inset 0 -1px 0 rgba(0, 0, 0, 0.3),
                0 0 20px rgba(168, 85, 247, 0.3);
        }

        .tab.active {
            background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%);
            color: var(--white);
            border-color: #8b2fc9;
            box-shadow: 
                0 6px 20px rgba(168, 85, 247, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                inset 0 -1px 0 rgba(0, 0, 0, 0.4);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section {
            background: 
                /* Brushed nickel texture */
                repeating-linear-gradient(
                    90deg,
                    #c8ccd4 0px,
                    #d8dce4 0.5px,
                    #e8ecf4 1px,
                    #d8dce4 1.5px,
                    #c8ccd4 2px
                ),
                /* Base metallic color */
                linear-gradient(180deg, #bfc3cb 0%, #d4d8e0 50%, #bfc3cb 100%);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            /* Laser-cut edge with beveled metal look */
            border: 2px solid #a8acb4;
            box-shadow: 
                /* Outer shadow - plate sitting on surface */
                0 8px 24px rgba(0, 0, 0, 0.4),
                /* Top bevel highlight */
                inset 0 2px 0 rgba(255, 255, 255, 0.6),
                /* Bottom bevel shadow */
                inset 0 -2px 0 rgba(0, 0, 0, 0.3),
                /* Left bevel highlight */
                inset 2px 0 0 rgba(255, 255, 255, 0.3),
                /* Right bevel shadow */
                inset -2px 0 0 rgba(0, 0, 0, 0.2);
            position: relative;
        }

        /* Add laser-cut edge glow effect */
        .section::before {
            content: '';
            position: absolute;
            top: -1px;
            left: -1px;
            right: -1px;
            bottom: -1px;
            background: linear-gradient(45deg, 
                rgba(168, 85, 247, 0.3) 0%, 
                transparent 30%, 
                transparent 70%, 
                rgba(34, 211, 238, 0.3) 100%);
            border-radius: 12px;
            z-index: -1;
            opacity: 0.5;
        }

        .section-title {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 1.35rem;
            font-weight: 900;
            color: transparent;
            background: linear-gradient(135deg, #3a3e46 0%, #2a2e36 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 
                0 1px 0 rgba(255, 255, 255, 0.4),
                0 -1px 1px rgba(0, 0, 0, 0.7),
                1px 0 0 rgba(255, 255, 255, 0.2),
                -1px 0 1px rgba(0, 0, 0, 0.5);
            filter: drop-shadow(0 2px 3px rgba(0, 0, 0, 0.4));
            font-variant: small-caps;
            letter-spacing: 1.4px;
            margin-bottom: 1.5rem;
            line-height: 1.2;
        }

        /* Inline name edit input on card title */
        .card-name-edit-input {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 1.35rem;
            font-weight: 900;
            font-variant: small-caps;
            letter-spacing: 1.4px;
            color: #2a2e36;
            background: rgba(255, 255, 255, 0.5);
            border: none;
            border-bottom: 2px solid var(--purple-primary);
            outline: none;
            padding: 0 0.25rem;
            width: 100%;
            line-height: 1.2;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            font-size: 1.0rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: transparent;
            background: linear-gradient(135deg, #5a5e66 0%, #3a3e46 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 
                0 1px 0 rgba(255, 255, 255, 0.3),
                0 -1px 1px rgba(0, 0, 0, 0.6),
                1px 0 0 rgba(255, 255, 255, 0.15),
                -1px 0 1px rgba(0, 0, 0, 0.4);
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
            letter-spacing: 0.5px;
            font-variant: small-caps;
        }

        .form-group input[type="text"],
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.75rem 1rem;
            background: rgba(26, 31, 58, 0.6);
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 10px;
            color: var(--white);
            font-family: 'Inter', sans-serif;
            font-size: 0.9375rem;
            transition: all 0.3s ease;
        }

        .form-group input[type="text"]:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--purple-primary);
            background: rgba(26, 31, 58, 0.8);
            box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.1);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .btn {
            padding: 0.875rem 2rem;
            font-family: 'Inter', sans-serif;
            font-size: 0.9375rem;
            font-weight: 600;
            letter-spacing: 0.3px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 1rem;
            margin-bottom: 1rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%);
            color: var(--white);
            box-shadow: 0 4px 12px rgba(168, 85, 247, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(168, 85, 247, 0.5);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            color: var(--white);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: var(--white);
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }

        /* METALLIC ICON BUTTONS */
        .btn-metallic {
            width: 56px;
            height: 56px;
            padding: 0;
            margin: 0;
            /* Apple keyboard: very tight radius */
            border-radius: 6px;
            /* Clean matte keycap surface */
            background:
                linear-gradient(
                    180deg,
                    #e4e6ea 0%,
                    #d6d8dc 40%,
                    #cbcdd1 100%
                );
            /* Sharp, precise border */
            border: 1px solid #a0a2a6;
            border-bottom: 2px solid #909296;
            box-shadow:
                /* Key sitting on surface — tight, crisp */
                0 1px 0 rgba(255, 255, 255, 0.6),
                0 2px 1px rgba(0, 0, 0, 0.12),
                0 3px 2px rgba(0, 0, 0, 0.08),
                /* Very subtle inner top highlight */
                inset 0 1px 0 rgba(255, 255, 255, 0.65);
            cursor: pointer;
            transition: all 0.1s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-metallic:hover {
            transform: translateY(-1px);
            background:
                linear-gradient(
                    180deg,
                    #eaecf0 0%,
                    #dcdee2 40%,
                    #d1d3d7 100%
                );
            box-shadow:
                0 1px 0 rgba(255, 255, 255, 0.6),
                0 3px 2px rgba(0, 0, 0, 0.15),
                0 5px 4px rgba(0, 0, 0, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.7);
        }

        .btn-metallic:active {
            transform: translateY(1px);
            background:
                linear-gradient(
                    180deg,
                    #c8cacf 0%,
                    #cdcfd3 40%,
                    #d2d4d8 100%
                );
            border-bottom: 1px solid #909296;
            box-shadow:
                0 0 0 rgba(0, 0, 0, 0),
                inset 0 1px 3px rgba(0, 0, 0, 0.15),
                inset 0 0 1px rgba(0, 0, 0, 0.1);
        }

        /* Etched icon style */
        .btn-metallic svg {
            filter: drop-shadow(0 1px 1px rgba(255, 255, 255, 0.5))
                    drop-shadow(0 -1px 1px rgba(0, 0, 0, 0.3));
            opacity: 0.7;
        }

        .btn-metallic.btn-delete svg {
            stroke: #dc2626;
        }

        .btn-metallic.btn-save svg {
            stroke: #9333ea;
        }

        .btn-metallic.btn-new svg {
            stroke: #9333ea;
        }

        .btn-metallic.btn-exit svg {
            stroke: #dc2626;
        }

        .btn-metallic.btn-home svg {
            stroke: #4a7a5e;
        }

        .list-container {
            display: grid;
            gap: 1rem;
        }

        .list-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            border-radius: 8px;
            border-left: 4px solid var(--blue-accent);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .list-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-left-color: var(--orange-primary);
            transform: translateX(5px);
        }

        .list-item.selected {
            border-left-color: var(--orange-primary);
            background: rgba(255, 154, 0, 0.1);
        }

        .list-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .list-item-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--orange-primary);
        }

        .list-item-meta {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .tags {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 0.5rem;
        }

        .tag {
            padding: 0.25rem 0.75rem;
            background: rgba(255, 154, 0, 0.2);
            border-radius: 4px;
            font-size: 0.75rem;
            color: var(--orange-primary);
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        /* MOBILE OPTIMIZATION */
        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }

            /* Body & Container */
            body {
                padding: 0.5rem;
                padding-left: max(0.5rem, env(safe-area-inset-left));
                padding-right: max(0.5rem, env(safe-area-inset-right));
                padding-bottom: max(0.5rem, env(safe-area-inset-bottom));
            }

            .container {
                padding: 0;
            }

            /* Splash Screen - Mobile */
            .splash-metal-sheet {
                padding: 3rem 2rem;
                margin: 1rem;
            }

            .splash-logo {
                font-size: 3rem;
                margin-bottom: 1.5rem;
            }

            .splash-card-suits {
                gap: 1.5rem;
                margin-bottom: 4rem;
            }

            .splash-card-suits .suit {
                width: 36px;
                height: 36px;
            }

            /* Dashboard - Mobile Grid */
            .dashboard-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.65rem;
                padding: 1rem;
                margin-bottom: 6rem;
            }

            .dashboard-btn {
                min-height: 90px;
                padding: 1rem 0.5rem;
                aspect-ratio: 1 / 1;
            }

            .dashboard-btn svg {
                width: 28px;
                height: 28px;
            }

            .dashboard-btn span {
                font-size: 0.75rem;
            }

            .dashboard-btn span {
                font-size: 1rem;
            }

            /* Drum Picker - Mobile */
            .combo-lock-frame {
                width: 100%;
            }

            .combo-lock-frame .apple-picker-container {
                height: 220px;
            }

            .apple-picker-item {
                height: 40px;
                font-size: 0.85rem;
            }

            .apple-picker-item.selected {
                font-size: 1rem;
            }
            
            .apple-picker-selection-bar {
                height: 40px;
            }

            /* Form Elements - Mobile */
            .section {
                padding: 1rem;
                margin-bottom: 1rem;
            }

            .section-title {
                font-size: 1.25rem;
            }

            .form-subsection-header {
                font-size: 0.95rem;
            }

            /* Sliders - Larger Touch Targets */
            .range-slider::-webkit-slider-thumb {
                width: 28px;
                height: 34px;
            }

            .range-slider::-moz-range-thumb {
                width: 28px;
                height: 34px;
            }

            .slider-value-labels {
                font-size: 0.75rem;
            }

            /* Buttons - Larger Touch Targets */
            .btn-metallic {
                width: 54px;
                height: 54px;
                min-width: 54px;
                min-height: 54px;
            }

            .btn-metallic svg {
                width: 22px;
                height: 22px;
            }

            /* Button Row - Mobile Spacing */
            .form-group:has(.btn-metallic) > div {
                max-width: 100% !important;
                gap: 0.5rem;
            }

            /* Exit Button - Mobile */
            .exit-btn {
                width: 54px;
                height: 54px;
                bottom: 1rem;
            }

            .exit-btn svg {
                width: 22px;
                height: 22px;
            }

            /* Text Areas */
            textarea {
                font-size: 16px; /* Prevents zoom on iOS */
            }

            input[type="text"],
            input[type="number"] {
                font-size: 16px; /* Prevents zoom on iOS */
            }

            /* Form Groups */
            .form-group {
                margin-bottom: 1.5rem;
            }

            .slider-layout {
                gap: 0.6rem;
            }

            .slider-layout label {
                min-width: 100px;
                font-size: 0.82rem;
            }

            .slider-value-labels {
                font-size: 0.7rem;
                padding: 0 4px;
                gap: 2px;
            }

            .slider-value-label {
                text-align: center;
            }

            /* Descriptor Chips - Mobile */
            .desc-selector {
                gap: 0.4rem 0.5rem;
            }

            .desc-chip {
                font-size: 0.72rem;
                padding: 0.3rem 0.1rem;
                letter-spacing: 0.3px;
            }

            .form-group.slider-layout:has(.desc-selector) {
                flex-direction: column;
                gap: 0.3rem;
            }

            .form-group.slider-layout:has(.desc-selector) > label {
                min-width: unset;
                padding-top: 0;
            }

            /* Notecard - Mobile */
            .notecard-section {
                min-height: 80px;
            }

            .notecard-entry {
                font-size: 0.78rem;
            }

            .notecard-inline-input {
                font-size: 16px; /* Prevents iOS zoom */
            }

            .notecard-edit-btn,
            .notecard-add-btn {
                padding: 0.5rem;
            }

            /* Form subsection spacing */
            .form-subsection {
                margin-bottom: 1rem;
                padding: 0.75rem;
            }
        }

        /* Small Phones - Stack sliders vertically */
        @media (max-width: 480px) {
            .form-group.slider-layout {
                flex-direction: column;
                gap: 0.3rem;
            }

            .form-group.slider-layout > label {
                min-width: unset;
                padding-top: 0;
                margin-bottom: 0.15rem;
            }

            .slider-value-labels {
                font-size: 0.72rem;
                padding: 0 2px;
            }
        }

        /* Extra Small Phones */
        @media (max-width: 375px) {
            .splash-logo {
                font-size: 2.5rem;
            }

            .splash-card-suits {
                gap: 1rem;
            }

            .splash-card-suits .suit {
                width: 30px;
                height: 30px;
            }

            .dashboard-btn {
                min-height: 100px;
                padding: 1.5rem 1rem;
            }

            .dashboard-btn svg {
                width: 32px;
                height: 32px;
            }

            .dashboard-btn span {
                font-size: 0.95rem;
            }

            .combo-lock-frame {
                width: 100%;
            }
            .combo-lock-frame .apple-picker-container {
                height: 200px;
            }

            .btn-metallic {
                width: 48px;
                height: 48px;
                min-width: 48px;
                min-height: 48px;
            }

            .slider-layout label {
                min-width: 80px !important;
                font-size: 0.78rem;
            }

            .slider-value-labels {
                font-size: 0.65rem !important;
                padding: 0 2px !important;
            }

            .desc-chip {
                font-size: 0.68rem;
                padding: 0.25rem 0.05rem;
            }

            .desc-selector {
                gap: 0.35rem;
            }
        }

        /* Landscape Phones */
        @media (max-width: 768px) and (orientation: landscape) {
            .splash-metal-sheet {
                padding: 2rem;
            }

            .splash-logo {
                font-size: 2.5rem;
                margin-bottom: 1rem;
            }

            .splash-card-suits {
                margin-bottom: 2rem;
            }

            .combo-lock-frame .apple-picker-container {
                height: 180px;
            }

            .dashboard-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Touch Improvements */
        @media (hover: none) and (pointer: coarse) {
            /* Larger tap targets for touch devices */
            .btn,
            .dashboard-btn,
            .btn-metallic,
            .exit-btn,
            .apple-picker-item {
                -webkit-tap-highlight-color: rgba(168, 85, 247, 0.2);
            }

            /* Remove hover states on touch */
            .btn:hover,
            .dashboard-btn:hover,
            .btn-metallic:hover {
                transform: none;
            }

            /* Active states for touch feedback */
            .btn:active,
            .dashboard-btn:active {
                transform: scale(0.98);
            }

            .btn-metallic:active {
                transform: translateY(1px);
            }
        }

        /* Tablet Portrait */
        @media (min-width: 769px) and (max-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1.5rem;
            }

            .combo-lock-frame {
                width: 100%;
            }
        }

        .brief-player {
            background: rgba(0, 0, 0, 0.3);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 4px solid var(--blue-accent);
        }

        .brief-player-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--orange-primary);
            margin-bottom: 0.5rem;
        }

        .brief-section {
            margin-top: 1rem;
        }

        .brief-section-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--blue-accent);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
        }

        .brief-list {
            list-style: none;
            padding-left: 0;
        }

        .brief-list li {
            padding: 0.25rem 0;
            padding-left: 1.5rem;
            position: relative;
        }

        .brief-list li:before {
            content: "✓";
            position: absolute;
            left: 0;
            color: var(--orange-primary);
        }

        .brief-list.warnings li:before {
            content: "⚠";
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            margin-bottom: 1rem;
            padding: 0.75rem 1rem;
            background: rgba(26, 31, 58, 0.3);
            border-radius: 8px;
            border: 1px solid rgba(168, 85, 247, 0.1);
            transition: all 0.2s ease;
        }

        .checkbox-group:hover {
            background: rgba(26, 31, 58, 0.5);
            border-color: rgba(168, 85, 247, 0.2);
        }

        .toggle-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
        }

        /* Toggle switch styling */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 56px;
            height: 28px;
        }

        .toggle-switch input[type="checkbox"] {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #6a6e76 0%, #4a4e56 100%);
            border-radius: 28px;
            transition: all 0.3s ease;
            border: 2px solid #5a5e66;
            box-shadow: 
                inset 0 2px 4px rgba(0, 0, 0, 0.3),
                0 1px 2px rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 8px;
        }

        /* Y letter on LEFT - revealed when slider moves RIGHT */
        .toggle-slider::before {
            content: 'Y';
            font-size: 0.75rem;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            z-index: 0;
        }

        /* N letter on RIGHT - revealed when slider is LEFT */
        .toggle-slider::after {
            content: 'N';
            font-size: 0.75rem;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.5);
            transition: all 0.3s ease;
            z-index: 0;
        }

        /* Slider knob */
        .toggle-knob {
            position: absolute;
            height: 20px;
            width: 20px;
            left: 2px;
            top: 2px;
            background: 
                repeating-linear-gradient(
                    90deg,
                    #e0e4ec 0px,
                    #f0f4fc 0.5px,
                    #e0e4ec 1px
                ),
                linear-gradient(180deg, #d8dce4 0%, #c8ccd4 100%);
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: 
                0 2px 4px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
            z-index: 1;
        }

        .toggle-switch input:checked + .toggle-slider {
            background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%);
            border-color: #a855f7;
            box-shadow: 
                inset 0 2px 4px rgba(0, 0, 0, 0.2),
                0 0 12px rgba(168, 85, 247, 0.4);
        }

        /* Brighten Y when checked (slider RIGHT, revealing LEFT) */
        .toggle-switch input:checked + .toggle-slider::before {
            color: rgba(255, 255, 255, 0.8);
        }

        /* Dim N when checked */
        .toggle-switch input:checked + .toggle-slider::after {
            color: rgba(255, 255, 255, 0.2);
        }

        /* Move knob when checked */
        .toggle-switch input:checked + .toggle-slider .toggle-knob {
            transform: translateX(28px);
            background: 
                repeating-linear-gradient(
                    90deg,
                    #f8f9fa 0px,
                    #ffffff 0.5px,
                    #f8f9fa 1px
                ),
                linear-gradient(180deg, #e8ecf4 0%, #d8dce4 100%);
        }

        .toggle-label {
            margin: 0;
            cursor: pointer;
            font-size: 1.0rem;
            font-weight: 600;
            color: transparent;
            background: linear-gradient(135deg, #5a5e66 0%, #3a3e46 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 
                0 1px 0 rgba(255, 255, 255, 0.3),
                0 -1px 1px rgba(0, 0, 0, 0.6),
                1px 0 0 rgba(255, 255, 255, 0.15),
                -1px 0 1px rgba(0, 0, 0, 0.4);
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
            letter-spacing: 1px;
            font-variant: small-caps;
        }

        .toggle-status {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #6a6e76;
            text-align: center;
        }

        .toggle-switch input:checked ~ .toggle-status {
            color: #a855f7;
        }

        /* Old checkbox styling - keep for other sections */
        .checkbox-group input[type="checkbox"]:not(.toggle-switch input) {
            width: 20px;
            height: 20px;
            cursor: pointer;
            appearance: none;
            -webkit-appearance: none;
            border: 2px solid rgba(168, 85, 247, 0.4);
            border-radius: 4px;
            background: rgba(26, 31, 58, 0.6);
            transition: all 0.2s ease;
            position: relative;
        }

        .checkbox-group input[type="checkbox"]:not(.toggle-switch input):checked {
            background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%);
            border-color: #a855f7;
        }

        .checkbox-group input[type="checkbox"]:not(.toggle-switch input):checked::after {
            content: '✓';
            position: absolute;
            color: white;
            font-size: 14px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .checkbox-group label {
            margin: 0;
            cursor: pointer;
            font-size: 1.0rem;
            font-weight: 600;
            color: transparent;
            background: linear-gradient(135deg, #5a5e66 0%, #3a3e46 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 
                0 1px 0 rgba(255, 255, 255, 0.3),
                0 -1px 1px rgba(0, 0, 0, 0.6),
                1px 0 0 rgba(255, 255, 255, 0.15),
                -1px 0 1px rgba(0, 0, 0, 0.4);
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
            letter-spacing: 1px;
            font-variant: small-caps;
        }

        /* Inline radio/checkbox labels inside form groups */
        .inline-label {
            margin: 0;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            color: transparent;
            background: linear-gradient(135deg, #5a5e66 0%, #3a3e46 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 
                0 1px 0 rgba(255, 255, 255, 0.3),
                0 -1px 1px rgba(0, 0, 0, 0.6),
                1px 0 0 rgba(255, 255, 255, 0.15),
                -1px 0 1px rgba(0, 0, 0, 0.4);
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
            letter-spacing: 0.5px;
            font-variant: small-caps;
        }

        /* Modern radio button styling */
        input[type="radio"] {
            appearance: none;
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(168, 85, 247, 0.4);
            border-radius: 50%;
            background: rgba(26, 31, 58, 0.6);
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        /* SLIDER CONTROLS - Replacing radio buttons for Low/Med/High */
        .slider-control-group {
            margin-top: 0.5rem;
        }

        /* Form group with slider - label on left, slider on right */
        .form-group.slider-layout {
            display: flex;
            align-items: flex-start;
            gap: 2rem;
        }

        .form-group.slider-layout > label {
            min-width: 180px;
            margin-bottom: 0;
            padding-top: 0.5rem;
        }

        .form-group.slider-layout .slider-control-group {
            flex: 1;
            margin-top: 0;
        }

        .slider-value-labels {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.75rem;
            padding: 0 10px;
        }

        .slider-value-label {
            font-size: 0.8rem;
            font-weight: 700;
            color: transparent;
            background: linear-gradient(135deg, #5a5e66 0%, #3a3e46 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 
                0 1px 0 rgba(255, 255, 255, 0.3),
                0 -1px 1px rgba(0, 0, 0, 0.6);
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
            font-variant: small-caps;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
        }

        .slider-value-label.active {
            background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 0 0 8px rgba(168, 85, 247, 0.6);
            filter: drop-shadow(0 0 4px rgba(168, 85, 247, 0.4));
        }

        .slider-etched-line {
            position: relative;
            height: 8px;
            /* Recessed metallic channel */
            background:
                repeating-linear-gradient(
                    90deg,
                    #a0a4ac 0px,
                    #b0b4bc 0.5px,
                    #a0a4ac 1px
                ),
                linear-gradient(180deg, #909498 0%, #b8bcc4 50%, #909498 100%);
            border-radius: 4px;
            border-top: 1px solid rgba(0, 0, 0, 0.35);
            border-bottom: 1px solid rgba(255, 255, 255, 0.45);
            box-shadow:
                inset 0 2px 4px rgba(0, 0, 0, 0.3),
                inset 0 -1px 2px rgba(255, 255, 255, 0.15),
                0 1px 0 rgba(255, 255, 255, 0.3);
            margin: 0 10px;
        }

        /* Notch marks at the three positions */
        .slider-etched-line::before {
            content: '';
            position: absolute;
            top: -3px;
            bottom: -3px;
            left: 50%;
            width: 2px;
            transform: translateX(-50%);
            background: linear-gradient(180deg, rgba(0,0,0,0.25) 0%, rgba(255,255,255,0.2) 100%);
            border-radius: 1px;
        }

        .range-slider {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: transparent;
            outline: none;
            cursor: pointer;
            position: relative;
            top: -8px;
            margin: 0;
            padding: 0;
        }

        /* Track — invisible, the etched-line is the visual track */
        .range-slider::-webkit-slider-runnable-track {
            height: 8px;
            background: transparent;
            border-radius: 4px;
        }

        .range-slider::-moz-range-track {
            height: 8px;
            background: transparent;
            border: none;
            border-radius: 4px;
        }

        /* Thumb — machined metal knob */
        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 22px;
            height: 28px;
            border-radius: 4px;
            cursor: pointer;
            position: relative;
            margin-top: -10px;
            /* Brushed steel knob */
            background:
                repeating-linear-gradient(
                    180deg,
                    #d8dce4 0px,
                    #e8ecf4 1px,
                    #d8dce4 2px
                ),
                linear-gradient(90deg, #b8bcc4 0%, #d8dce4 30%, #e8ecf4 50%, #d8dce4 70%, #b8bcc4 100%);
            border: 1.5px solid #8a8e96;
            box-shadow:
                0 3px 8px rgba(0, 0, 0, 0.35),
                0 1px 3px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.7),
                inset 0 -1px 0 rgba(0, 0, 0, 0.2),
                inset 1px 0 0 rgba(255, 255, 255, 0.35),
                inset -1px 0 0 rgba(0, 0, 0, 0.15);
            transition: box-shadow 0.15s ease;
        }

        .range-slider::-moz-range-thumb {
            width: 22px;
            height: 28px;
            border-radius: 4px;
            cursor: pointer;
            background:
                repeating-linear-gradient(
                    180deg,
                    #d8dce4 0px,
                    #e8ecf4 1px,
                    #d8dce4 2px
                ),
                linear-gradient(90deg, #b8bcc4 0%, #d8dce4 30%, #e8ecf4 50%, #d8dce4 70%, #b8bcc4 100%);
            border: 1.5px solid #8a8e96;
            box-shadow:
                0 3px 8px rgba(0, 0, 0, 0.35),
                0 1px 3px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.7),
                inset 0 -1px 0 rgba(0, 0, 0, 0.2),
                inset 1px 0 0 rgba(255, 255, 255, 0.35),
                inset -1px 0 0 rgba(0, 0, 0, 0.15);
            transition: box-shadow 0.15s ease;
        }

        /* Hover — lift effect */
        .range-slider::-webkit-slider-thumb:hover {
            box-shadow:
                0 5px 12px rgba(0, 0, 0, 0.4),
                0 2px 5px rgba(0, 0, 0, 0.25),
                inset 0 1px 0 rgba(255, 255, 255, 0.8),
                inset 0 -1px 0 rgba(0, 0, 0, 0.2),
                inset 1px 0 0 rgba(255, 255, 255, 0.4),
                inset -1px 0 0 rgba(0, 0, 0, 0.15),
                0 0 8px rgba(168, 85, 247, 0.15);
        }

        .range-slider::-moz-range-thumb:hover {
            box-shadow:
                0 5px 12px rgba(0, 0, 0, 0.4),
                0 2px 5px rgba(0, 0, 0, 0.25),
                inset 0 1px 0 rgba(255, 255, 255, 0.8),
                inset 0 -1px 0 rgba(0, 0, 0, 0.2),
                inset 1px 0 0 rgba(255, 255, 255, 0.4),
                inset -1px 0 0 rgba(0, 0, 0, 0.15),
                0 0 8px rgba(168, 85, 247, 0.15);
        }

        /* Active — pressed down */
        .range-slider::-webkit-slider-thumb:active {
            box-shadow:
                0 1px 4px rgba(0, 0, 0, 0.3),
                inset 0 2px 4px rgba(0, 0, 0, 0.15),
                inset 0 -1px 0 rgba(255, 255, 255, 0.4),
                0 0 12px rgba(168, 85, 247, 0.2);
        }

        .range-slider::-moz-range-thumb:active {
            box-shadow:
                0 1px 4px rgba(0, 0, 0, 0.3),
                inset 0 2px 4px rgba(0, 0, 0, 0.15),
                inset 0 -1px 0 rgba(255, 255, 255, 0.4),
                0 0 12px rgba(168, 85, 247, 0.2);
        }

        /* Purple position indicator — sits inside the track */
        .slider-container {
            position: relative;
        }

        .slider-container::after {
            content: '';
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: radial-gradient(circle at 40% 40%, #c084fc 0%, #9333ea 60%, #7928c9 100%);
            pointer-events: none;
            box-shadow:
                0 0 4px rgba(168, 85, 247, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            transition: left 0.1s ease;
        }

        /* ============================================
           COMBINATION LOCK DRUM PICKER
           ============================================ */

        /* Outer frame — the lock housing bolted to the case */
        .combo-lock-frame {
            position: relative;
            width: 100%;
            margin: 0 auto;
            padding: 14px 18px;
            background:
                /* Brushed steel horizontal grain */
                repeating-linear-gradient(
                    0deg,
                    #b0b4bc 0px,
                    #bfc3cb 1px,
                    #cdd1d9 2px,
                    #bfc3cb 3px,
                    #b0b4bc 4px
                ),
                linear-gradient(90deg, #a8acb4 0%, #c0c4cc 50%, #a8acb4 100%);
            border-radius: 10px;
            border: 2px solid #8a8e96;
            box-shadow:
                /* Raised off the surface */
                0 6px 20px rgba(0, 0, 0, 0.5),
                0 2px 8px rgba(0, 0, 0, 0.3),
                /* Beveled top edge */
                inset 0 2px 0 rgba(255, 255, 255, 0.55),
                /* Beveled bottom shadow */
                inset 0 -2px 0 rgba(0, 0, 0, 0.25),
                /* Side bevels */
                inset 2px 0 0 rgba(255, 255, 255, 0.25),
                inset -2px 0 0 rgba(0, 0, 0, 0.15);
        }

        /* Mounting bolts */
        .combo-bolt {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            z-index: 20;
        }
        .combo-bolt-left { left: -4px; }
        .combo-bolt-right { right: -4px; }

        .combo-bolt-head {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background:
                radial-gradient(circle at 35% 35%, #e8ecf4 0%, #c8ccd4 40%, #9a9ea6 100%);
            border: 1.5px solid #7a7e86;
            box-shadow:
                0 2px 4px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.6);
            position: relative;
        }

        /* Phillips-head screw cross */
        .combo-bolt-head::before,
        .combo-bolt-head::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            background: linear-gradient(180deg, rgba(0,0,0,0.4) 0%, rgba(0,0,0,0.15) 100%);
            border-radius: 1px;
        }
        .combo-bolt-head::before {
            width: 7px;
            height: 1.5px;
            transform: translate(-50%, -50%);
        }
        .combo-bolt-head::after {
            width: 1.5px;
            height: 7px;
            transform: translate(-50%, -50%);
        }

        /* The drum window — recessed slot in the housing */
        .combo-lock-frame .apple-picker-container {
            position: relative;
            height: 260px;
            width: 100%;
            max-width: none;
            margin: 0;
            overflow: hidden;
            border-radius: 6px;
            /* Recessed channel in the metal */
            background:
                /* Vertical brushed aluminum on the drum */
                repeating-linear-gradient(
                    90deg,
                    #d0d4dc 0px,
                    #dce0e8 0.5px,
                    #e8ecf4 1px,
                    #dce0e8 1.5px,
                    #d0d4dc 2px
                ),
                linear-gradient(180deg, #c8ccd4 0%, #d8dce4 50%, #c8ccd4 100%);
            border: 2px solid #888c94;
            box-shadow:
                /* Sunk into the frame */
                inset 0 4px 8px rgba(0, 0, 0, 0.35),
                inset 0 -4px 8px rgba(0, 0, 0, 0.2),
                inset 4px 0 8px rgba(0, 0, 0, 0.15),
                inset -4px 0 8px rgba(0, 0, 0, 0.15),
                /* Subtle outer lip highlight */
                0 1px 0 rgba(255, 255, 255, 0.3);
            cursor: grab;
            user-select: none;
            -webkit-user-select: none;
            touch-action: none;
        }

        .combo-lock-frame .apple-picker-container:active {
            cursor: grabbing;
        }

        /* Grip ridges on drum sides */
        .drum-ridge {
            position: absolute;
            top: 10%;
            bottom: 10%;
            width: 6px;
            z-index: 12;
            pointer-events: none;
        }
        .drum-ridge-left { left: 0; }
        .drum-ridge-right { right: 0; }

        .drum-ridge::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                repeating-linear-gradient(
                    180deg,
                    transparent 0px,
                    rgba(0, 0, 0, 0.12) 2px,
                    rgba(255, 255, 255, 0.15) 3px,
                    transparent 4px
                );
        }

        /* Top curvature shadow — drum rolling away from viewer */
        .combo-lock-frame .apple-picker-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 44%;
            background: linear-gradient(
                180deg,
                rgba(140, 144, 152, 0.98) 0%,
                rgba(160, 164, 172, 0.88) 20%,
                rgba(180, 184, 192, 0.55) 50%,
                transparent 100%
            );
            pointer-events: none;
            z-index: 10;
            border-radius: 6px 6px 0 0;
        }

        /* Bottom curvature shadow */
        .combo-lock-frame .apple-picker-container::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 44%;
            background: linear-gradient(
                0deg,
                rgba(130, 134, 142, 0.98) 0%,
                rgba(150, 154, 162, 0.88) 20%,
                rgba(170, 174, 182, 0.55) 50%,
                transparent 100%
            );
            pointer-events: none;
            z-index: 10;
            border-radius: 0 0 6px 6px;
        }

        /* Selection window — the reading notch */
        .apple-picker-selection-bar {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 44px;
            transform: translateY(-50%);
            pointer-events: none;
            z-index: 11;
            border-top: none;
            border-bottom: none;
            background: none;
            box-shadow: none;
        }

        /* Left & right selection arrows / indicator marks */
        .apple-picker-selection-bar::before,
        .apple-picker-selection-bar::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 0;
            height: 0;
            transform: translateY(-50%);
        }
        .apple-picker-selection-bar::before {
            left: -1px;
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
            border-left: 8px solid rgba(100, 100, 110, 0.6);
            filter: drop-shadow(1px 0 1px rgba(255,255,255,0.3));
        }
        .apple-picker-selection-bar::after {
            right: -1px;
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
            border-right: 8px solid rgba(100, 100, 110, 0.6);
            filter: drop-shadow(-1px 0 1px rgba(255,255,255,0.3));
        }

        /* Touch capture overlay — invisible, sits on top of everything in the drum */
        .drum-touch-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 20;
            touch-action: none;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        /* Scroll area */
        .apple-picker-scroll {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: hidden;
            touch-action: none;
        }

        /* The moving list */
        .drum-cylinder {
            position: absolute;
            width: 100%;
            left: 0;
            will-change: transform;
            touch-action: none;
        }

        /* Individual drum plate — etched into the cylinder surface */
        .apple-picker-item {
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            font-weight: 600;
            touch-action: none;
            /* Laser-etched text — matching app style, softer */
            color: transparent;
            background: linear-gradient(135deg, #6a6e76 0%, #4a4e56 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow:
                0 1px 0 rgba(255, 255, 255, 0.25),
                0 -1px 1px rgba(0, 0, 0, 0.4);
            filter: drop-shadow(0 1px 1px rgba(0, 0, 0, 0.15));
            font-variant: small-caps;
            letter-spacing: 0.8px;
            cursor: pointer;
            padding: 0 2rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: filter 0.12s;
            /* Groove between plates */
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            border-top: 1px solid rgba(255, 255, 255, 0.18);
            position: relative;
        }

        /* Alternating subtle tint for depth */
        .apple-picker-item:nth-child(even) {
            background-image:
                linear-gradient(
                    180deg,
                    rgba(0, 0, 0, 0.015) 0%,
                    rgba(0, 0, 0, 0.03) 50%,
                    rgba(0, 0, 0, 0.015) 100%
                ),
                linear-gradient(135deg, #6a6e76 0%, #4a4e56 100%);
        }

        /* Selected item — deeper etch, bolder */
        .apple-picker-item.selected {
            font-size: 1.1rem;
            font-weight: 800;
            letter-spacing: 1.2px;
            background: linear-gradient(135deg, #4a4e56 0%, #2a2e36 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow:
                0 1px 0 rgba(255, 255, 255, 0.35),
                0 -1px 1px rgba(0, 0, 0, 0.55),
                1px 0 0 rgba(255, 255, 255, 0.12),
                -1px 0 1px rgba(0, 0, 0, 0.3);
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.25));
        }

        .apple-picker-overlay-top,
        .apple-picker-overlay-bottom {
            display: none;
        }

        /* Inline edit input inside drum item */
        .drum-inline-edit {
            width: 85%;
            height: 34px;
            border: none;
            border-bottom: 2px solid rgba(168, 85, 247, 0.6);
            background: rgba(255, 255, 255, 0.15);
            color: #1a1e26;
            font-family: 'Inter', sans-serif;
            font-size: 1.05rem;
            font-weight: 700;
            text-align: center;
            letter-spacing: 0.8px;
            font-variant: small-caps;
            outline: none;
            border-radius: 3px 3px 0 0;
            box-shadow:
                inset 0 1px 3px rgba(0, 0, 0, 0.15),
                0 0 8px rgba(168, 85, 247, 0.15);
        }

        .drum-inline-edit:focus {
            border-bottom-color: rgba(168, 85, 247, 0.9);
            background: rgba(255, 255, 255, 0.25);
            box-shadow:
                inset 0 1px 3px rgba(0, 0, 0, 0.15),
                0 0 12px rgba(168, 85, 247, 0.25);
        }

        .apple-picker-item.editing {
            background: rgba(168, 85, 247, 0.04) !important;
        }

        /* ============================================
           DESCRIPTOR CHIPS — Tap to Select (text only)
           ============================================ */
        .desc-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 0.6rem;
            flex: 1;
            padding-top: 0.35rem;
        }

        .desc-chip {
            padding: 0.2rem 0.1rem;
            border: none;
            border-radius: 0;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            font-size: 0.8rem;
            font-weight: 700;
            font-variant: small-caps;
            letter-spacing: 0.5px;
            background: none;
            transition: all 0.3s ease;
            /* Unselected — etched metal text */
            color: transparent;
            background: linear-gradient(135deg, #5a5e66 0%, #3a3e46 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow:
                0 1px 0 rgba(255, 255, 255, 0.3),
                0 -1px 1px rgba(0, 0, 0, 0.6);
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
            box-shadow: none;
        }

        .desc-chip:hover {
            filter: drop-shadow(0 0 3px rgba(168, 85, 247, 0.3));
        }

        .desc-chip:active {
            transform: none;
        }

        /* Selected — purple glow text */
        .desc-chip.active {
            background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 8px rgba(168, 85, 247, 0.6);
            filter: drop-shadow(0 0 4px rgba(168, 85, 247, 0.4));
            box-shadow: none;
            border: none;
        }

        .desc-chip.active:hover {
            background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%);
            -webkit-background-clip: text;
            background-clip: text;
        }

        /* ============================================
           KEY WEAKNESSES — Input + Etched Plates
           ============================================ */
        .weakness-input {
            width: 100%;
            padding: 0.5rem 0.6rem;
            background: rgba(26, 31, 58, 0.6);
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 6px;
            color: var(--white);
            font-family: 'Inter', sans-serif;
            font-size: 0.82rem;
            transition: all 0.3s ease;
        }

        .weakness-input:focus {
            outline: none;
            border-color: var(--purple-primary);
            background: rgba(26, 31, 58, 0.8);
            box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.1);
        }

        /* ============================================
           NOTECARD LAYOUT — Read-only + Pen Edit
           ============================================ */
        .notecard-section {
            min-height: 100px;
        }

        .notecard-layout {
            min-height: 80px;
        }

        .notecard-display {
            display: flex;
            flex-direction: column;
            min-height: 80px;
        }

        .notecard-entries {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
        }

        /* Read-only etched entry */
        .notecard-entry {
            display: flex;
            align-items: center;
            font-family: 'Inter', sans-serif;
            font-size: 0.82rem;
            font-weight: 600;
            line-height: 1.5;
            color: transparent;
            background: linear-gradient(135deg, #6a6e76 0%, #4a4e56 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow:
                0 1px 0 rgba(255, 255, 255, 0.25),
                0 -1px 1px rgba(0, 0, 0, 0.4);
            filter: drop-shadow(0 1px 1px rgba(0, 0, 0, 0.15));
            padding: 0.15rem 0;
        }

        .notecard-entry-text::before {
            content: '• ';
            opacity: 0.4;
        }

        .notecard-entry-text {
            flex: 1;
        }

        /* Delete × shown only in edit mode */
        .notecard-entry-delete {
            display: none;
            width: 18px;
            height: 18px;
            border: none;
            background: none;
            cursor: pointer;
            padding: 0;
            align-items: center;
            justify-content: center;
            opacity: 0.4;
            transition: opacity 0.2s;
            flex-shrink: 0;
            margin-left: 0.5rem;
        }

        .notecard-entry-delete:hover {
            opacity: 0.8;
        }

        .notecard-entry-delete svg {
            stroke: #dc2626;
        }

        /* Edit mode — show delete buttons */
        .notecard-entries.editing .notecard-entry-delete {
            display: flex;
        }

        .notecard-entries.editing .notecard-entry {
            /* Subtle background hint when editable */
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            background: linear-gradient(135deg, #6a6e76 0%, #4a4e56 100%);
            -webkit-background-clip: text;
            background-clip: text;
        }

        /* Inline add input (appears in the entries list) */
        .notecard-inline-input {
            width: 100%;
            padding: 0.3rem 0.4rem;
            background: rgba(26, 31, 58, 0.5);
            border: 1px solid rgba(168, 85, 247, 0.35);
            border-radius: 4px;
            color: var(--white);
            font-family: 'Inter', sans-serif;
            font-size: 0.82rem;
            outline: none;
            margin-top: 0.2rem;
        }

        .notecard-inline-input:focus {
            border-color: var(--purple-primary);
            box-shadow: 0 0 0 2px rgba(168, 85, 247, 0.1);
        }

        .notecard-empty {
            font-family: 'Inter', sans-serif;
            font-size: 0.8rem;
            font-style: italic;
            opacity: 0.3;
            color: #8a8e96;
            padding: 0.5rem 0;
        }

        /* Bottom actions row */
        .notecard-actions {
            display: flex;
            justify-content: flex-end;
            gap: 0.3rem;
            margin-top: 0.5rem;
        }

        .notecard-edit-btn,
        .notecard-add-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.3rem;
            opacity: 0.35;
            transition: all 0.2s ease;
        }

        .notecard-edit-btn svg,
        .notecard-add-btn svg {
            stroke: #8a8e96;
            filter: drop-shadow(0 1px 0 rgba(255, 255, 255, 0.3));
        }

        .notecard-edit-btn:hover,
        .notecard-add-btn:hover {
            opacity: 0.7;
        }

        .notecard-edit-btn.active {
            opacity: 0.9;
        }

        .notecard-edit-btn.active svg {
            stroke: #a855f7;
            filter: drop-shadow(0 0 4px rgba(168, 85, 247, 0.4));
        }

        .notecard-add-btn {
            display: inline-flex;
        }

        input[type="radio"]:checked {
            border-color: #a855f7;
            background: rgba(26, 31, 58, 0.8);
        }

        input[type="radio"]:checked::after {
            content: '';
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        input[type="radio"]:hover {
            border-color: rgba(168, 85, 247, 0.6);
        }

        /* Radio group container */
        .radio-group-container {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            margin-top: 0.5rem;
        }

        .radio-option-modern {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.625rem 1.25rem;
            background: rgba(26, 31, 58, 0.3);
            border: 1px solid rgba(168, 85, 247, 0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .radio-option-modern:hover {
            background: rgba(26, 31, 58, 0.5);
            border-color: rgba(168, 85, 247, 0.3);
        }

        .radio-option-modern input[type="radio"]:checked ~ label,
        .radio-option-modern:has(input[type="radio"]:checked) {
            background: rgba(168, 85, 247, 0.15);
            border-color: rgba(168, 85, 247, 0.4);
        }

        .radio-option-modern label {
            margin: 0;
            cursor: pointer;
            font-size: 0.9rem;
            color: transparent;
            background: linear-gradient(135deg, #5a5e66 0%, #3a3e46 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 
                0 1px 0 rgba(255, 255, 255, 0.3),
                0 -1px 1px rgba(0, 0, 0, 0.6),
                1px 0 0 rgba(255, 255, 255, 0.15),
                -1px 0 1px rgba(0, 0, 0, 0.4);
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
            font-variant: small-caps;
        }

        /* Section dividers and contrast */
        .form-section-divider {
            margin: 3rem 0 2rem 0;
            padding: 1.5rem;
            background: 
                repeating-linear-gradient(
                    90deg,
                    #a8acb4 0px,
                    #b8bcc4 0.5px,
                    #c8ccd4 1px,
                    #b8bcc4 1.5px,
                    #a8acb4 2px
                ),
                linear-gradient(180deg, #9ea2aa 0%, #b8bcc4 50%, #9ea2aa 100%);
            border-left: 4px solid var(--purple-primary);
            border-radius: 12px;
            position: relative;
            box-shadow: 
                0 6px 20px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                inset 0 -1px 0 rgba(0, 0, 0, 0.2);
        }

        .form-section-divider::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(180deg, #a855f7 0%, #22d3ee 100%);
            border-radius: 4px 0 0 4px;
            box-shadow: 0 0 16px rgba(168, 85, 247, 0.6);
        }

        .form-section-header {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.5rem;
            color: #1a1f3a;
            margin: 0;
            letter-spacing: -0.5px;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.5);
        }

        .form-section-header::before {
            content: '';
            width: 4px;
            height: 24px;
            background: linear-gradient(180deg, var(--purple-primary) 0%, var(--cyan-accent) 100%);
            border-radius: 2px;
            box-shadow: 0 0 12px var(--purple-primary);
        }

        /* Alternating subsection backgrounds */
        .form-subsection {
            margin: 1.5rem 0;
            padding: 1.5rem;
            background: 
                /* Brushed nickel */
                repeating-linear-gradient(
                    90deg,
                    #c8ccd4 0px,
                    #d8dce4 0.5px,
                    #e8ecf4 1px,
                    #d8dce4 1.5px,
                    #c8ccd4 2px
                ),
                linear-gradient(180deg, #bfc3cb 0%, #d4d8e0 50%, #bfc3cb 100%);
            border-radius: 10px;
            border: 2px solid #a8acb4;
            box-shadow: 
                0 8px 24px rgba(0, 0, 0, 0.4),
                inset 0 2px 0 rgba(255, 255, 255, 0.6),
                inset 0 -2px 0 rgba(0, 0, 0, 0.3),
                inset 2px 0 0 rgba(255, 255, 255, 0.3),
                inset -2px 0 0 rgba(0, 0, 0, 0.2);
        }

        .form-subsection:nth-child(even) {
            /* Same style for all cards */
        }

        .form-subsection-header {
            font-family: 'Inter', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            color: transparent;
            background: linear-gradient(135deg, #5a5e66 0%, #3a3e46 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 
                0 1px 0 rgba(255, 255, 255, 0.3),
                0 -1px 1px rgba(0, 0, 0, 0.6),
                1px 0 0 rgba(255, 255, 255, 0.15),
                -1px 0 1px rgba(0, 0, 0, 0.4);
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
            margin-bottom: 1.25rem;
            padding-bottom: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            border-bottom: 2px solid rgba(168, 85, 247, 0.4);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-variant: small-caps;
            white-space: nowrap;
        }

        .form-subsection-header::before {
            content: '';
            width: 24px;
            height: 2px;
            background: linear-gradient(90deg, rgba(168, 85, 247, 0.8) 0%, transparent 100%);
        }

        .import-export {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: 
                linear-gradient(135deg, rgba(139, 146, 168, 0.1) 0%, rgba(90, 98, 120, 0.08) 100%),
                repeating-linear-gradient(
                    45deg,
                    rgba(255, 255, 255, 0.02) 0px,
                    transparent 1px,
                    rgba(255, 255, 255, 0.02) 2px,
                    transparent 3px
                ),
                rgba(26, 31, 58, 0.5);
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(139, 146, 168, 0.25);
            box-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--orange-primary);
            font-family: 'Orbitron', sans-serif;
        }

        .stat-label {
            font-size: 0.85rem;
            opacity: 0.7;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 0.5rem;
        }

        .search-box {
            margin-bottom: 1rem;
        }

        .search-box input {
            width: 100%;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(82, 115, 163, 0.4);
            border-radius: 8px;
            color: var(--white);
            font-family: 'JetBrains Mono', monospace;
            font-size: 1rem;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--blue-accent);
            box-shadow: 0 0 20px rgba(82, 115, 163, 0.3);
        }

        /* Session Info Inputs */
        .session-info-input {
            width: 100%;
            padding: 0.75rem 1rem;
            background: rgba(26, 31, 58, 0.6);
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 10px;
            color: var(--white);
            font-family: 'Inter', sans-serif;
            font-size: 0.9375rem;
            transition: all 0.3s ease;
        }

        .session-info-input:focus {
            outline: none;
            border-color: var(--purple-primary);
            background: rgba(26, 31, 58, 0.8);
            box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.1);
        }

        .session-info-input.hidden {
            display: none;
        }

        .session-info-display {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            color: transparent;
            background: linear-gradient(135deg, #5a5e66 0%, #3a3e46 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 
                0 1px 0 rgba(255, 255, 255, 0.3),
                0 -1px 1px rgba(0, 0, 0, 0.6);
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
            cursor: pointer;
            padding: 0.5rem 0;
            letter-spacing: 0.5px;
        }

        .session-info-display:hover {
            filter: drop-shadow(0 0 3px rgba(168, 85, 247, 0.3));
        }

        .session-info-display.hidden {
            display: none;
        }

        .session-info-placeholder {
            font-family: 'Inter', sans-serif;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            padding: 0.5rem 0;
        }

        .session-info-placeholder:hover {
            color: rgba(255, 255, 255, 0.7);
        }

        .session-info-placeholder.hidden {
            display: none;
        }

        /* Table Setup Sections */
        .table-setup-section {
            margin-bottom: 1.25rem;
        }

        .table-setup-section:last-child {
            margin-bottom: 0;
        }

        .table-setup-label {
            font-family: 'Inter', sans-serif;
            font-size: 0.72rem;
            font-weight: 800;
            color: #5a5e66;
            text-align: left;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .session-info-unit {
            font-size: 0.85rem;
            font-weight: 600;
            color: transparent;
            background: linear-gradient(135deg, #6a6e76 0%, #4a4e56 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 0 1px 0 rgba(255, 255, 255, 0.3);
            white-space: nowrap;
        }

        .form-group.slider-layout.session-format-row {
            flex-direction: row !important;
            align-items: center !important;
            gap: 2rem !important;
        }

        .form-group.slider-layout.session-format-row > label {
            min-width: 180px !important;
            padding-top: 0 !important;
        }

        /* Session Player Selection */
        .session-players-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .session-player-slot {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            position: relative;
        }

        .session-player-seat {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 0.7rem;
            font-weight: 700;
            color: transparent;
            background: linear-gradient(135deg, #5a5e66 0%, #3a3e46 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow:
                0 1px 0 rgba(255, 255, 255, 0.3),
                0 -1px 1px rgba(0, 0, 0, 0.6);
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
            text-shadow: 0 1px 0 rgba(255, 255, 255, 0.3);
            min-width: 18px;
            text-align: center;
        }

        .session-player-input-wrap {
            flex: 1;
            position: relative;
        }

        .session-player-input {
            width: 100%;
            padding: 0.5rem 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(82, 115, 163, 0.3);
            border-radius: 6px;
            color: var(--white);
            font-family: 'Inter', sans-serif;
            font-size: 0.85rem;
        }

        .session-player-input:focus {
            outline: none;
            border-color: var(--purple-primary);
            box-shadow: 0 0 8px rgba(168, 85, 247, 0.2);
        }

        .session-player-input.has-player {
            background: transparent;
            border-color: transparent;
            font-weight: 700;
            color: transparent;
            background: linear-gradient(135deg, #5a5e66 0%, #3a3e46 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 
                0 1px 0 rgba(255, 255, 255, 0.3),
                0 -1px 1px rgba(0, 0, 0, 0.6),
                1px 0 0 rgba(255, 255, 255, 0.15),
                -1px 0 1px rgba(0, 0, 0, 0.4);
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
            cursor: pointer;
            padding-left: 0.25rem;
        }

        .session-player-input.has-player.tracked {
            background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%);
            -webkit-background-clip: text;
            background-clip: text;
            filter: drop-shadow(0 0 4px rgba(168, 85, 247, 0.6)) 
                    drop-shadow(0 0 8px rgba(168, 85, 247, 0.4))
                    drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
        }

        .session-player-input.has-player:focus {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--purple-primary);
            box-shadow: 0 0 8px rgba(168, 85, 247, 0.2);
            color: var(--white);
            font-weight: 400;
            padding-left: 0.75rem;
        }

        .session-player-position {
            padding: 0.35rem 18px 0.35rem 0.5rem;
            background: rgba(255, 255, 255, 0.35);
            border: 1.5px solid #a8acb4;
            border-radius: 4px;
            color: #3a3e46;
            font-family: 'Inter', sans-serif;
            font-size: 0.7rem;
            font-weight: 700;
            appearance: none;
            -webkit-appearance: none;
            cursor: pointer;
            min-width: 50px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8' viewBox='0 0 24 24' fill='none' stroke='%235a5e66' stroke-width='3'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 4px center;
        }

        .session-player-position.has-position {
            background: transparent;
            border-color: transparent;
            font-weight: 700;
            color: #5a5e66;
            cursor: pointer;
            padding-left: 0.25rem;
            background-image: none;
        }

        .session-player-position.has-position.tracked {
            color: #9333ea;
        }

        .session-player-position:focus {
            outline: none;
            border-color: #9333ea;
            box-shadow: 0 0 0 2px rgba(147, 51, 234, 0.15);
        }

        .session-player-position.hidden {
            display: none;
        }

        .session-player-position option {
            background: #d8dce4;
            color: #3a3e46;
        }

        .session-player-track {
            display: flex;
            align-items: center;
            cursor: pointer;
            user-select: none;
        }

        .session-player-track.hidden {
            display: none;
        }

        .session-player-track input[type="checkbox"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        .session-player-track .track-icon {
            stroke: #9ca3af;
            opacity: 0.5;
            transition: all 0.2s;
        }

        .session-player-track input[type="checkbox"]:checked + .track-icon {
            stroke: #9333ea;
            opacity: 1;
        }

        .session-player-track input[type="checkbox"]:disabled + .track-icon {
            stroke: #9ca3af;
            opacity: 0.2;
            cursor: not-allowed;
        }

        .session-player-track:hover .track-icon {
            opacity: 0.8;
        }

        .session-player-track input[type="checkbox"]:checked:hover + .track-icon {
            opacity: 1;
        }

        /* COMMENTED OUT - Red X remove button (may revive later)
        .session-player-remove {
            width: 28px;
            height: 28px;
            min-width: 28px;
            border: none;
            background: none;
            cursor: pointer;
            color: #ef4444;
            opacity: 0.6;
            transition: opacity 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .session-player-remove:hover {
            opacity: 1;
        }
        */

        .session-player-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: 
                linear-gradient(135deg, #2a2f4a 0%, #1a1f3a 100%);
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 6px;
            max-height: 200px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            z-index: 100;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
            display: none;
            overscroll-behavior: contain;
        }

        .session-player-dropdown.open {
            display: block;
        }

        .session-player-dropdown-item {
            padding: 0.5rem 0.75rem;
            cursor: pointer;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.9);
            transition: background 0.15s;
        }

        .session-player-dropdown-item:hover {
            background: rgba(168, 85, 247, 0.2);
            color: var(--white);
        }

        .session-player-dropdown-item.already-selected {
            opacity: 0.35;
            pointer-events: none;
        }

        .session-player-dropdown-empty {
            padding: 0.5rem 0.75rem;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.55);
            font-style: italic;
        }

        .session-player-new-option {
            border-top: 1px solid rgba(168, 85, 247, 0.2);
            color: var(--purple-light) !important;
            font-weight: 600;
            position: sticky;
            bottom: 0;
            background: linear-gradient(135deg, #2a2f4a 0%, #1a1f3a 100%);
        }

        .session-player-add-row {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .btn-add-player-slot {
            width: 36px;
            height: 36px;
            min-width: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #d8dde5 0%, #c8ccd4 50%, #b8bdc5 100%);
            border: 2px solid #a8acb4;
            box-shadow: 
                0 3px 8px rgba(0, 0, 0, 0.3),
                inset 0 1px 2px rgba(255, 255, 255, 0.5),
                inset 0 -1px 2px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-add-player-slot svg {
            color: #9333ea;
            filter: drop-shadow(0 1px 1px rgba(255, 255, 255, 0.4))
                    drop-shadow(0 -1px 1px rgba(0, 0, 0, 0.4));
        }

        .btn-add-player-slot:hover {
            transform: translateY(-1px);
        }

        .btn-add-player-slot:active {
            transform: translateY(0);
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.2), inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .btn-add-player-slot:disabled {
            opacity: 0.35;
            pointer-events: none;
        }

        .session-player-count {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 0.75rem;
            font-weight: 700;
            color: transparent;
            background: linear-gradient(135deg, #6a6e76 0%, #4a4e56 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 0 1px 0 rgba(255, 255, 255, 0.3);
            letter-spacing: 1px;
        }


        /* ===== HAND HISTORY GRID ===== */
        .hh-card-inner { margin-bottom: 0.5rem; }
        .hh-header {
        display: flex;
        align-items: center;
        justify-content: flex-end;
        gap: 0.5rem;
        margin-bottom: 1rem;
        }
        .hh-title {
        font-size: 1.1rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 1.5px;
        font-variant: small-caps;
        color: transparent;
        background: linear-gradient(135deg, #5a5e66, #3a3e46);
        -webkit-background-clip: text;
        background-clip: text;
        text-shadow: 0 1px 0 rgba(255,255,255,0.3), 0 -1px 1px rgba(0,0,0,0.6);
        filter: drop-shadow(0 1px 2px rgba(0,0,0,0.3));
        }
        .hh-label {
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: transparent;
        background: linear-gradient(135deg, #5a5e66, #3a3e46);
        -webkit-background-clip: text;
        background-clip: text;
        text-shadow: 0 1px 0 rgba(255,255,255,0.3), 0 -1px 1px rgba(0,0,0,0.6);
        filter: drop-shadow(0 1px 2px rgba(0,0,0,0.3));
        }
        /* ===== PLAYER & POSITION SELECT ===== */
        .hh-player-select-row {
            margin-bottom: 1rem;
        }
        .hh-player-dropdown {
            width: 100%;
            padding: 0.75rem 1rem;
            background: rgba(26, 31, 58, 0.6);
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 10px;
            color: var(--white);
            font-family: 'Inter', sans-serif;
            font-size: 0.9375rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .hh-player-dropdown:focus {
            outline: none;
            border-color: var(--purple-primary);
            background: rgba(26, 31, 58, 0.8);
            box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.1);
        }
        .hh-player-dropdown option {
            background: #1a1f3a;
            color: var(--white);
        }
        .hh-player-dropdown.hidden {
            display: none;
        }
        
        .hh-selection-inputs {
            display: block;
        }
        
        .hh-selection-inputs.hidden {
            display: none;
        }
        
        .hh-selection-display {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 0;
            margin-bottom: 1rem;
            cursor: pointer;
        }
        
        .hh-selection-display.hidden {
            display: none;
        }
        
        .hh-selection-display:hover {
            opacity: 0.7;
        }
        
        .hh-player-display,
        .hh-position-display {
            font-family: 'Inter', sans-serif;
            font-size: 0.72rem;
            font-weight: 800;
            color: #5a5e66;
            text-align: center;
            text-shadow: 
                0 1px 0 rgba(255, 255, 255, 0.3),
                0 -1px 1px rgba(0, 0, 0, 0.6),
                1px 0 0 rgba(255, 255, 255, 0.15),
                -1px 0 1px rgba(0, 0, 0, 0.4);
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
        }
        
        .hh-display-separator {
            font-family: 'Inter', sans-serif;
            font-size: 0.6rem;
            font-weight: 800;
            color: #5a5e66;
            opacity: 0.5;
        }
        
        .hh-positions {
            display: flex;
            gap: 0.4rem;
            flex-wrap: wrap;
        }
        
        .hh-positions.hidden {
            display: none;
        }
        
        .hh-pos-chip {
            padding: 0.4rem 0.75rem;
            background: linear-gradient(135deg, #d8dde5 0%, #c8ccd4 50%, #b8bdc5 100%);
            border: 2px solid #a8acb4;
            border-radius: 6px;
            font-family: 'Inter', sans-serif;
            font-size: 0.75rem;
            font-weight: 700;
            color: #5a5e66;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 
                0 2px 6px rgba(0, 0, 0, 0.2),
                inset 0 1px 2px rgba(255, 255, 255, 0.4),
                inset 0 -1px 2px rgba(0, 0, 0, 0.15);
        }
        
        .hh-pos-chip:hover {
            background: linear-gradient(135deg, #e8ecf0 0%, #d8dce4 50%, #c8ccd4 100%);
            transform: translateY(-1px);
        }
        
        .hh-pos-chip:active,
        .hh-pos-chip.active {
            background: linear-gradient(135deg, #c8ccd4 0%, #b8bdc5 50%, #a8acb4 100%);
            transform: translateY(0px);
            box-shadow: 
                0 1px 3px rgba(0, 0, 0, 0.2),
                inset 0 1px 3px rgba(0, 0, 0, 0.2);
        }
        
        /* ===== HAND HISTORY TABLE ===== */
        .hh-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1rem;
        }
        
        .hh-table thead {
            border-bottom: 2px solid rgba(168, 85, 247, 0.4);
        }
        
        .hh-table th {
            font-family: 'Inter', sans-serif;
            font-size: 0.72rem;
            font-weight: 800;
            color: #5a5e66;
            text-align: center;
            padding: 0.5rem 0.25rem;
            text-shadow: 
                0 1px 0 rgba(255, 255, 255, 0.3),
                0 -1px 1px rgba(0, 0, 0, 0.6);
        }
        
        .hh-th-street {
            width: 60px;
        }
        
        .hh-th-cards {
            width: 120px;
        }
        
        .hh-th-actions {
            width: auto;
        }
        
        .hh-table-row {
            border-bottom: 1px solid rgba(168, 85, 247, 0.15);
            transition: opacity 0.2s;
        }
        
        .hh-table-row.hh-street-disabled {
            opacity: 0.3;
            pointer-events: none;
        }
        
        .hh-table-row:last-child {
            border-bottom: none;
        }
        
        .hh-td-street {
            font-family: 'Inter', sans-serif;
            font-size: 0.75rem;
            font-weight: 900;
            color: #7a47c4;
            text-align: center;
            padding: 0.6rem 0.35rem;
            vertical-align: top;
            text-transform: uppercase;
            letter-spacing: 0.03em;
            background: rgba(168, 85, 247, 0.04);
        }
        
        .hh-td-cards {
            padding: 0.5rem 0.5rem;
            vertical-align: top;
        }
        
        .hh-td-actions {
            padding: 0.5rem 0.5rem;
            vertical-align: top;
        }
        
        .hh-td-actions {
            display: flex;
            align-items: flex-start;
            gap: 0.3rem;
        }
        
        .hh-street-actions {
            display: flex;
            align-items: center;
            gap: 0;
            flex: 1;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            padding: 2px 0;
        }
        
        .hh-add-action {
            width: 24px;
            height: 24px;
            flex-shrink: 0;
            border-radius: 4px;
            background: linear-gradient(135deg, #d8dde5 0%, #c8ccd4 50%, #b8bdc5 100%);
            border: 2px solid #a8acb4;
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            font-weight: 700;
            color: #5a5e66;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 
                0 1px 3px rgba(0, 0, 0, 0.2),
                inset 0 1px 1px rgba(255, 255, 255, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }
        
        .hh-add-action:hover {
            background: linear-gradient(135deg, #e8ecf0 0%, #d8dce4 50%, #c8ccd4 100%);
            transform: translateY(-1px);
        }
        
        .hh-add-action:active {
            transform: translateY(0px);
            box-shadow: 
                0 1px 2px rgba(0, 0, 0, 0.2),
                inset 0 1px 2px rgba(0, 0, 0, 0.15);
        }
        
        .hh-cc-input,
        .hh-pf-note {
            width: 100%;
            padding: 0.4rem 0.5rem;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 6px;
            color: #ffffff;
            font-family: 'Inter', sans-serif;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .hh-cc-input:focus,
        .hh-pf-note:focus {
            outline: none;
            border-color: var(--purple-primary);
            background: rgba(0, 0, 0, 0.5);
            box-shadow: 0 0 0 2px rgba(168, 85, 247, 0.1);
            color: #ffffff;
        }
        
        .hh-cc-input::placeholder,
        .hh-pf-note::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }
        
        #pf-note-wrap,
        #cc-wrap-flop,
        #cc-wrap-turn,
        #cc-wrap-river {
            font-family: 'Inter', sans-serif;
            font-size: 0.72rem;
            font-weight: 800;
            color: #5a5e66;
        }
        
        .hh-street-label {
        width: 22px;
        flex-shrink: 0;
        font-family: 'Inter', sans-serif;
        font-size: 0.7rem;
        font-weight: 800;
        color: #5a5e66;
        text-align: right;
        }
        .hh-street-actions {
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        gap: 0;
        flex: 1;
        padding: 2px 0;
        }
        
        .hh-two-column-layout {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.75rem;
        width: 100%;
        padding: 0.25rem 0;
        }
        
        .hh-player-column {
        display: flex;
        flex-direction: column;
        gap: 0.35rem;
        background: rgba(168, 85, 247, 0.02);
        padding: 0.5rem;
        border-radius: 4px;
        border: 1px solid rgba(168, 85, 247, 0.1);
        }
        
        .hh-player-column-header {
        font-family: 'Inter', sans-serif;
        font-size: 0.72rem;
        font-weight: 800;
        color: #7a47c4;
        text-align: center;
        padding: 0.3rem 0;
        background: rgba(168, 85, 247, 0.08);
        border-radius: 3px;
        margin-bottom: 0.15rem;
        text-transform: uppercase;
        letter-spacing: 0.02em;
        }
        
        .hh-action-cell {
        display: flex;
        align-items: center;
        flex-shrink: 0;
        gap: 4px;
        min-height: 32px;
        }
        .hh-action-cell .hh-dash {
        color: #6a6e76;
        font-size: 0.6rem;
        padding: 0 0.15rem;
        user-select: none;
        }
        .hh-action-select {
        padding: 0.25rem 14px 0.25rem 0.3rem;
        background: rgba(255,255,255,0.35);
        border: 1.5px solid #a8acb4;
        border-radius: 4px;
        color: #3a3e46;
        font-family: 'Inter', sans-serif;
        font-size: 0.68rem;
        font-weight: 600;
        appearance: none;
        -webkit-appearance: none;
        cursor: pointer;
        min-width: 52px;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8' viewBox='0 0 24 24' fill='none' stroke='%235a5e66' stroke-width='3'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 3px center;
        }
        .hh-action-select:focus { outline: none; border-color: #9333ea; box-shadow: 0 0 0 2px rgba(147,51,234,0.15); }
        .hh-action-select.has-value {
        border-color: rgba(168,85,247,0.5);
        background-color: rgba(168,85,247,0.08);
        font-weight: 700;
        }
        .hh-action-select option { background: #d8dce4; color: #3a3e46; }
        .hh-action-select optgroup { 
            font-weight: 700; 
            color: #5a5e66;
            font-style: normal;
        }
        
        .hh-player-select {
        padding: 0.25rem 14px 0.25rem 0.3rem;
        background: rgba(255,255,255,0.35);
        border: 1.5px solid #a8acb4;
        border-radius: 4px;
        color: #3a3e46;
        font-family: 'Inter', sans-serif;
        font-size: 0.68rem;
        font-weight: 600;
        appearance: none;
        -webkit-appearance: none;
        cursor: pointer;
        min-width: 80px;
        margin-right: 4px;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8' viewBox='0 0 24 24' fill='none' stroke='%235a5e66' stroke-width='3'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 3px center;
        }
        .hh-player-select:focus { outline: none; border-color: #9333ea; box-shadow: 0 0 0 2px rgba(147,51,234,0.15); }
        .hh-player-select option { background: #d8dce4; color: #3a3e46; }
        
        .hh-player-label {
        font-family: 'Inter', sans-serif;
        font-size: 0.68rem;
        font-weight: 600;
        color: #5a5e66;
        margin-right: 4px;
        padding: 0.25rem 0.3rem;
        }
        
        .hh-action-display {
        font-family: 'Inter', sans-serif;
        font-size: 0.73rem;
        font-weight: 600;
        color: #3a3e46;
        padding: 0.35rem 0.5rem;
        cursor: pointer;
        border-radius: 4px;
        background: rgba(255, 255, 255, 0.4);
        border: 1px solid rgba(168, 85, 247, 0.15);
        transition: all 0.15s;
        display: flex;
        align-items: center;
        justify-content: space-between;
        min-height: 32px;
        }
        
        .hh-action-display:hover {
        background: rgba(168, 85, 247, 0.1);
        border-color: rgba(168, 85, 247, 0.3);
        transform: translateY(-1px);
        }
        
        .hh-player-name {
        font-family: 'Inter', sans-serif;
        font-size: 0.68rem;
        font-weight: 600;
        color: #5a5e66;
        margin-right: 2px;
        }
        
        .hh-action-amt {
        width: 48px;
        padding: 0.25rem 0.25rem;
        background: rgba(255,255,255,0.35);
        border: 1.5px solid #a8acb4;
        border-radius: 4px;
        color: #3a3e46;
        font-family: 'Space Grotesk', sans-serif;
        font-size: 0.68rem;
        font-weight: 600;
        display: none;
        margin-left: 2px;
        }
        .hh-action-amt.visible { display: block; }
        .hh-action-amt:focus { outline: none; border-color: #9333ea; box-shadow: 0 0 0 2px rgba(147,51,234,0.15); }
        .hh-action-note {
        width: 44px;
        padding: 0.25rem 0.2rem;
        background: none;
        border: none;
        border-bottom: 1px solid #a8acb4;
        border-radius: 0;
        color: #5a5e66;
        font-family: 'Inter', sans-serif;
        font-size: 0.58rem;
        font-weight: 600;
        font-style: italic;
        margin-left: 1px;
        }
        .hh-action-note:focus { outline: none; border-bottom-color: #9333ea; }
        .hh-action-note::placeholder { color: #6a6e76; font-weight: 500; }
        .hh-at-note {
        font-family: 'Inter', sans-serif;
        font-size: 0.58rem;
        font-weight: 600;
        font-style: italic;
        color: #5a5e66;
        }
        .hh-action-x {
        border: none;
        background: none;
        color: #dc2626;
        font-size: 0.55rem;
        cursor: pointer;
        opacity: 0;
        padding: 0 0.1rem;
        transition: opacity 0.15s;
        margin-left: 1px;
        }
        .hh-action-cell:hover .hh-action-x { opacity: 0.5; }
        .hh-action-x:hover { opacity: 1 !important; }
        .hh-add-action {
        width: 28px;
        height: 28px;
        min-width: 28px;
        border-radius: 50%;
        border: 2px solid #a855f7;
        background: linear-gradient(135deg, rgba(168,85,247,0.1) 0%, rgba(147,51,234,0.1) 100%);
        color: #9333ea;
        font-size: 1rem;
        font-weight: 700;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
        flex-shrink: 0;
        box-shadow: 0 1px 3px rgba(168,85,247,0.2);
        }
        .hh-add-action:hover { 
            border-color: #9333ea; 
            background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%);
            color: white;
            transform: scale(1.1);
            box-shadow: 0 2px 6px rgba(168,85,247,0.4);
        }
        .hh-add-action:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            pointer-events: none;
        }
        .hh-add-action:active {
            transform: scale(0.95);
        }
        /* Players count - borderless */
        .hh-players-count {
        width: 28px;
        min-width: 28px;
        flex-shrink: 0;
        padding: 0.2rem 0;
        background: none;
        border: none;
        color: #3a3e46;
        font-family: 'Space Grotesk', sans-serif;
        font-size: 0.68rem;
        font-weight: 700;
        text-align: center;
        appearance: none;
        -webkit-appearance: none;
        cursor: pointer;
        }
        .hh-players-count:focus { outline: none; }
        .hh-players-count option { background: #d8dce4; color: #3a3e46; }
        /* Column header row */
        .hh-grid-header {
        display: flex;
        align-items: center;
        margin-bottom: 0.15rem;
        padding-bottom: 0.15rem;
        }
        .hh-grid-header-spacer {
        /* Label + add button width */
        width: 52px;
        flex-shrink: 0;
        }
        .hh-grid-header-actions {
        flex: 1;
        }
        .hh-grid-header-cc {
        width: 56px;
        min-width: 56px;
        flex-shrink: 0;
        text-align: center;
        font-family: 'Inter', sans-serif;
        font-size: 0.6rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: #6a6e76;
        }
        .hh-grid-header-players {
        width: 28px;
        min-width: 28px;
        flex-shrink: 0;
        display: flex;
        justify-content: center;
        color: #6a6e76;
        }
        .hh-grid-header-players svg {
        opacity: 0.6;
        }
        /* Read-only mode */
        .hh-card-inner.readonly .hh-seat { pointer-events: none; }
        .hh-card-inner.readonly .hh-pos-chip { pointer-events: none; }
        .hh-card-inner.readonly .hh-add-action { display: none; }
        .hh-card-inner.readonly .hh-action-x { display: none; }
        .hh-card-inner.readonly .hh-outcome-chip { pointer-events: none; }
        .hh-card-inner.readonly .hh-result-input { display: none; }
        .hh-card-inner.readonly .hh-players-count { pointer-events: none; }
        /* Plain text action (replaces dropdown in readonly) */
        .hh-action-text {
        font-family: 'Inter', sans-serif;
        font-size: 0.7rem;
        font-weight: 700;
        color: #3a3e46;
        white-space: nowrap;
        }
        .hh-action-text .hh-at-amt {
        font-family: 'Space Grotesk', sans-serif;
        color: #9333ea;
        }
        /* Hand number indicator */
        .hh-hand-number {
        font-family: 'Space Grotesk', sans-serif;
        font-size: 0.72rem;
        font-weight: 700;
        color: #9333ea;
        margin-left: auto;
        }
        /* Readonly shows value text */
        .hh-shows-text {
        font-family: 'Space Grotesk', sans-serif;
        font-size: 0.72rem;
        font-weight: 700;
        color: #9333ea;
        }
        /* Community cards input */
        .hh-cc-input {
        width: 70px;
        min-width: 70px;
        flex-shrink: 0;
        padding: 0.35rem 0.4rem;
        background: rgba(0, 0, 0, 0.4);
        border: 1.5px solid rgba(168, 85, 247, 0.3);
        border-radius: 4px;
        color: white;
        font-family: 'Space Grotesk', sans-serif;
        font-size: 0.55rem;
        font-weight: 600;
        text-align: center;
        text-transform: uppercase;
        transition: all 0.15s;
        }
        .hh-cc-input:focus {
        outline: none;
        border-color: #a855f7;
        background: rgba(0, 0, 0, 0.5);
        box-shadow: 0 0 0 2px rgba(168, 85, 247, 0.15);
        }
        .hh-cc-input::placeholder {
        color: rgba(255, 255, 255, 0.4);
        font-weight: 500;
        font-size: 0.5rem;
        text-transform: lowercase;
        }
        .hh-cc-text {
        width: 56px;
        min-width: 56px;
        flex-shrink: 0;
        text-align: center;
        font-family: 'Space Grotesk', sans-serif;
        font-size: 0.65rem;
        font-weight: 700;
        color: #9333ea;
        }
        .hh-card-inner.readonly .hh-cc-input { display: none; }
        /* Preflop inline note */
        .hh-pf-note {
        width: 88px;
        min-width: 88px;
        flex-shrink: 0;
        padding: 0.2rem 0.25rem;
        background: none;
        border: none;
        border-bottom: 1px solid #a8acb4;
        border-radius: 0;
        color: #3a3e46;
        font-family: 'Inter', sans-serif;
        font-size: 0.62rem;
        font-weight: 600;
        font-style: italic;
        }
        .hh-pf-note:focus { outline: none; border-bottom-color: #9333ea; }
        .hh-pf-note::placeholder { color: #6a6e76; font-weight: 500; }
        .hh-card-inner.readonly .hh-pf-note { display: none; }
        .hh-pf-note-text {
        min-width: 88px;
        flex-shrink: 0;
        font-family: 'Inter', sans-serif;
        font-size: 0.62rem;
        font-weight: 600;
        font-style: italic;
        color: #5a5e66;
        }
        /* Players count plain text */
        .hh-pc-text {
        width: 28px;
        min-width: 28px;
        flex-shrink: 0;
        text-align: center;
        font-family: 'Space Grotesk', sans-serif;
        font-size: 0.68rem;
        font-weight: 700;
        color: #3a3e46;
        }
        /* ===== OUTCOME ===== */
        .hh-showdown-section {
        margin-bottom: 0.8rem;
        padding: 0.75rem;
        background: rgba(168, 85, 247, 0.05);
        border: 1px solid rgba(168, 85, 247, 0.2);
        border-radius: 6px;
        }
        
        .hh-showdown-players {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        }
        
        .hh-showdown-player {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        }
        
        .hh-showdown-player-name {
        font-family: 'Inter', sans-serif;
        font-size: 0.75rem;
        font-weight: 700;
        color: #5a5e66;
        min-width: 60px;
        }
        
        .hh-showdown-cards-input {
        flex: 1;
        padding: 0.4rem 0.5rem;
        background: rgba(0, 0, 0, 0.4);
        border: 1.5px solid rgba(168, 85, 247, 0.3);
        border-radius: 4px;
        color: white;
        font-family: 'Space Grotesk', sans-serif;
        font-size: 0.6rem;
        font-weight: 600;
        text-transform: uppercase;
        text-align: center;
        transition: all 0.15s;
        }
        
        .hh-showdown-cards-input:focus {
        outline: none;
        border-color: #a855f7;
        background: rgba(0, 0, 0, 0.5);
        box-shadow: 0 0 0 2px rgba(168, 85, 247, 0.15);
        }
        
        .hh-showdown-cards-input::placeholder {
        color: rgba(255, 255, 255, 0.4);
        text-transform: none;
        font-size: 0.55rem;
        }
        
        /* ===== OUTCOME (1 player only) ===== */
        .hh-outcome-section {
        margin-bottom: 0.8rem;
        }
        
        .hh-outcome-input {
        width: 100%;
        padding: 0.45rem 0.5rem;
        background: rgba(255, 255, 255, 0.35);
        border: 1.5px solid #a8acb4;
        border-radius: 4px;
        color: #3a3e46;
        font-family: 'Inter', sans-serif;
        font-size: 0.75rem;
        font-weight: 600;
        text-align: center;
        }
        
        .hh-outcome-input:focus {
        outline: none;
        border-color: #9333ea;
        background: rgba(255, 255, 255, 0.5);
        }
        
        .hh-outcome-input::placeholder {
        color: #9a9ea6;
        font-weight: 500;
        }
        
        /* ===== NOTES ===== */
        .hh-notes-section { margin-bottom: 0.75rem; }
        .hh-notes-section .hh-label { margin-bottom: 0.3rem; }
        .hh-notes-textarea {
        width: 100%;
        padding: 0.4rem 0.5rem;
        background: rgba(255,255,255,0.35);
        border: 2px solid #a8acb4;
        border-radius: 6px;
        color: #3a3e46;
        font-family: 'Inter', sans-serif;
        font-size: 0.78rem;
        font-weight: 500;
        resize: vertical;
        min-height: 2rem;
        }
        .hh-notes-textarea:focus { outline: none; border-color: #9333ea; box-shadow: 0 0 0 3px rgba(147,51,234,0.15); }
        .hh-notes-textarea::placeholder { color: #6a6e76; }
        /* ===== NAV BUTTONS ===== */
        .hh-bottom {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.75rem;
        }
        
        .hh-save-next-btn {
        width: 100%;
        padding: 0.7rem 1rem;
        background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%);
        border: none;
        border-radius: 6px;
        color: white;
        font-family: 'Inter', sans-serif;
        font-size: 0.85rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.2s;
        box-shadow: 0 3px 8px rgba(168, 85, 247, 0.4);
        text-transform: uppercase;
        letter-spacing: 0.03em;
        }
        
        .hh-save-next-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(168, 85, 247, 0.5);
        background: linear-gradient(135deg, #b366f8 0%, #a347eb 100%);
        }
        
        .hh-save-next-btn:active {
        transform: translateY(0px);
        box-shadow: 0 2px 4px rgba(168, 85, 247, 0.4);
        }
        
        .hh-nav-group {
        display: flex;
        align-items: center;
        gap: 0.6rem;
        }
        
        .hh-nav-btn {
        width: 48px;
        height: 48px;
        padding: 0;
        border-radius: 6px;
        background: linear-gradient(180deg, #e4e6ea 0%, #d6d8dc 40%, #cbcdd1 100%);
        border: 1px solid #a0a2a6;
        border-bottom: 2px solid #909296;
        box-shadow:
        0 1px 0 rgba(255,255,255,0.6),
        0 2px 1px rgba(0,0,0,0.12),
        0 3px 2px rgba(0,0,0,0.08),
        inset 0 1px 0 rgba(255,255,255,0.65);
        cursor: pointer;
        transition: all 0.1s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #5a5e66;
        }
        .hh-nav-btn svg {
        filter: drop-shadow(0 1px 1px rgba(255,255,255,0.5))
        drop-shadow(0 -1px 1px rgba(0,0,0,0.3));
        opacity: 0.7;
        }
        .hh-nav-btn:hover {
        transform: translateY(-1px);
        background: linear-gradient(180deg, #eaecf0 0%, #dcdee2 40%, #d1d3d7 100%);
        box-shadow:
        0 1px 0 rgba(255,255,255,0.6),
        0 3px 2px rgba(0,0,0,0.15),
        0 5px 4px rgba(0,0,0,0.08),
        inset 0 1px 0 rgba(255,255,255,0.7);
        }
        .hh-nav-btn:active {
        transform: translateY(1px);
        background: linear-gradient(180deg, #c8cacf 0%, #cdcfd3 40%, #d2d4d8 100%);
        border-bottom: 1px solid #909296;
        box-shadow:
        0 0 0 rgba(0,0,0,0),
        inset 0 1px 3px rgba(0,0,0,0.15),
        inset 0 0 1px rgba(0,0,0,0.1);
        }
        .hh-nav-counter {
        font-family: 'Space Grotesk', sans-serif;
        font-size: 0.72rem;
        font-weight: 700;
        color: #5a5e66;
        min-width: 44px;
        user-select: none;
        }
        .hh-nav-counter .hh-nc-num {
        color: #9333ea;
        }
        /* ===== SAVED ===== */
        /* (saved hands rendered in-card) */

        /* ===== LIVE SESSION STYLES ===== */

        .session-timer-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.25rem 1.5rem;
            margin-bottom: 1.5rem;
            background: 
                repeating-linear-gradient(
                    90deg,
                    #a8acb4 0px,
                    #b8bcc4 0.5px,
                    #c8ccd4 1px,
                    #b8bcc4 1.5px,
                    #a8acb4 2px
                ),
                linear-gradient(180deg, #9ea2aa 0%, #b8bcc4 50%, #9ea2aa 100%);
            border-radius: 12px;
            border: 2px solid #a8acb4;
            box-shadow: 
                0 6px 20px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                inset 0 -1px 0 rgba(0, 0, 0, 0.2);
        }

        .session-timer-display {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .session-timer-clock {
            font-family: 'Space Grotesk', monospace;
            font-size: 2.2rem;
            font-weight: 700;
            color: transparent;
            background: linear-gradient(135deg, #5a5e66 0%, #3a3e46 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 
                0 2px 0 rgba(255, 255, 255, 0.4),
                0 -2px 2px rgba(0, 0, 0, 0.7);
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.4));
            letter-spacing: 2px;
        }

        .session-timer-clock.active {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            -webkit-background-clip: text;
            background-clip: text;
        }

        .session-timer-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: transparent;
            background: linear-gradient(135deg, #6a6e76 0%, #4a4e56 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 0 1px 0 rgba(255, 255, 255, 0.3);
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .session-timer-controls {
            display: flex;
            gap: 0.75rem;
        }

        .btn-session-start, .btn-session-stop {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #d8dde5 0%, #c8ccd4 50%, #b8bdc5 100%);
            border: 2px solid #a8acb4;
            box-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.3),
                inset 0 2px 3px rgba(255, 255, 255, 0.5),
                inset 0 -2px 3px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-session-start svg { color: #22c55e; }
        .btn-session-stop svg { color: #ef4444; }

        .btn-session-start:hover, .btn-session-stop:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 6px 16px rgba(0, 0, 0, 0.4),
                inset 0 2px 3px rgba(255, 255, 255, 0.5),
                inset 0 -2px 3px rgba(0, 0, 0, 0.2);
        }

        .btn-session-start:active, .btn-session-stop:active {
            transform: translateY(0);
            box-shadow: 
                0 2px 6px rgba(0, 0, 0, 0.2),
                inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        /* Blind Tracker */
        .blind-tracker {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .blind-display {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
        }

        .btn-blind-nav {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #d8dde5 0%, #c8ccd4 50%, #b8bdc5 100%);
            border: 2px solid #a8acb4;
            box-shadow: 
                0 3px 8px rgba(0, 0, 0, 0.3),
                inset 0 1px 2px rgba(255, 255, 255, 0.5),
                inset 0 -1px 2px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-blind-nav svg {
            width: 12px;
            height: 12px;
            color: #5a5e66;
            filter: drop-shadow(0 1px 1px rgba(255, 255, 255, 0.4))
                    drop-shadow(0 -1px 1px rgba(0, 0, 0, 0.4));
        }

        .btn-blind-nav:hover {
            transform: translateY(-1px);
        }

        .btn-blind-nav:active {
            transform: translateY(0);
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.2), inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .blind-level-info {
            text-align: center;
            min-width: 160px;
        }

        .blind-level-number {
            font-family: 'Inter', sans-serif;
            font-size: 0.65rem;
            font-weight: 700;
            color: transparent;
            background: linear-gradient(135deg, #5a5e66 0%, #3a3e46 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow:
                0 1px 0 rgba(255, 255, 255, 0.3),
                0 -1px 1px rgba(0, 0, 0, 0.6);
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
            letter-spacing: 1.5px;
            text-transform: uppercase;
            margin-bottom: 0.35rem;
        }

        .blind-level-values {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            color: transparent;
            background: linear-gradient(135deg, #5a5e66 0%, #3a3e46 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 
                0 1px 0 rgba(255, 255, 255, 0.4),
                0 -1px 1px rgba(0, 0, 0, 0.7);
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.4));
            letter-spacing: 0.5px;
            cursor: pointer;
            transition: filter 0.2s;
        }

        .blind-level-values:hover {
            filter: drop-shadow(0 0 3px rgba(168, 85, 247, 0.4));
        }

        .blind-level-edit-row {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            justify-content: center;
        }

        .blind-level-edit-row.hidden {
            display: none;
        }

        .blind-edit-input {
            width: 50px;
            padding: 0.3rem 0.4rem;
            background: rgba(255, 255, 255, 0.35);
            border: 1.5px solid #a8acb4;
            border-radius: 4px;
            color: #3a3e46;
            font-family: 'Space Grotesk', sans-serif;
            font-size: 0.9rem;
            font-weight: 600;
            text-align: center;
        }

        .blind-edit-input:focus {
            outline: none;
            border-color: #9333ea;
            box-shadow: 0 0 0 2px rgba(147, 51, 234, 0.15);
        }

        .blind-edit-slash {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 0.9rem;
            font-weight: 700;
            color: #5a5e66;
        }

        .blind-level-ante {
            display: none; /* Now included in blind-level-values */
        }
            font-family: 'Inter', sans-serif;
            font-size: 0.8rem;
            font-weight: 600;
            color: transparent;
            background: linear-gradient(135deg, #9333ea 0%, #7c3aed 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 0 1px 0 rgba(255, 255, 255, 0.2);
            margin-top: 0.2rem;
        }

        .blind-timer-row {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .blind-timer-label {
            font-size: 0.8rem;
            font-weight: 600;
            color: transparent;
            background: linear-gradient(135deg, #5a5e66 0%, #3a3e46 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .blind-interval-group {
            display: flex;
            align-items: center;
            gap: 0.35rem;
            transition: opacity 0.3s ease;
        }

        .blind-interval-input {
            width: 52px;
            padding: 0.35rem 0.5rem;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 6px;
            color: var(--white);
            font-family: 'Space Grotesk', sans-serif;
            font-size: 0.85rem;
            text-align: center;
        }

        .blind-interval-input:focus {
            outline: none;
            border-color: var(--purple-primary);
        }

        .blind-interval-unit {
            font-size: 0.75rem;
            color: transparent;
            background: linear-gradient(135deg, #6a6e76 0%, #4a4e56 100%);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .blind-countdown {
            font-family: 'Space Grotesk', monospace;
            font-size: 0.9rem;
            font-weight: 700;
            color: transparent;
            background: linear-gradient(135deg, #9333ea 0%, #7c3aed 100%);
            -webkit-background-clip: text;
            background-clip: text;
            min-width: 50px;
            text-align: center;
        }

        /* Note Entry */
        .note-entry {
            display: flex;
            gap: 0.75rem;
            align-items: flex-end;
        }

        .note-entry textarea {
            flex: 1;
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(82, 115, 163, 0.4);
            border-radius: 8px;
            color: var(--white);
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            resize: vertical;
            min-height: 48px;
        }

        .note-entry textarea:focus {
            outline: none;
            border-color: var(--purple-primary);
            box-shadow: 0 0 12px rgba(168, 85, 247, 0.2);
        }

        .btn-add-note {
            width: 48px;
            height: 48px;
            min-width: 48px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #d8dde5 0%, #c8ccd4 50%, #b8bdc5 100%);
            border: 2px solid #a8acb4;
            box-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.3),
                inset 0 2px 3px rgba(255, 255, 255, 0.5),
                inset 0 -2px 3px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-add-note svg {
            color: #9333ea;
            filter: drop-shadow(0 1px 1px rgba(255, 255, 255, 0.4))
                    drop-shadow(0 -1px 1px rgba(0, 0, 0, 0.4));
        }

        .btn-add-note:hover {
            transform: translateY(-2px);
        }

        .btn-add-note:active {
            transform: translateY(0);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2), inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        /* Notes Feed */
        .session-notes-feed {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            max-height: 500px;
            overflow-y: auto;
            padding-right: 0.5rem;
        }

        .session-note-card {
            padding: 0.75rem 1rem;
            background: rgba(26, 31, 58, 0.4);
            border: 1px solid rgba(168, 85, 247, 0.15);
            border-radius: 8px;
            position: relative;
            transition: all 0.2s ease;
        }

        .session-note-card:hover {
            border-color: rgba(168, 85, 247, 0.3);
            background: rgba(26, 31, 58, 0.55);
        }

        .session-note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.4rem;
        }

        .session-note-time {
            font-family: 'Space Grotesk', monospace;
            font-size: 0.7rem;
            font-weight: 700;
            color: var(--purple-primary);
            letter-spacing: 0.5px;
        }

        .session-note-blind {
            font-size: 0.65rem;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.6);
            letter-spacing: 0.5px;
        }

        .session-note-text {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.95);
            line-height: 1.5;
        }

        .session-note-delete {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            width: 20px;
            height: 20px;
            border: none;
            background: none;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s;
            color: #ef4444;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }

        .session-note-card:hover .session-note-delete {
            opacity: 0.8;
        }

        .session-note-delete:hover {
            opacity: 1 !important;
        }

        /* ===== HAND TRACKER ADDITIONS ===== */
        .hh-setup-card {
            margin-bottom: 1rem;
        }
        
        .hh-setup-row {
            margin-bottom: 0.75rem;
        }
        
        .hh-select {
            width: 100%;
            padding: 0.75rem;
            background: linear-gradient(135deg, #d8dde5 0%, #c8ccd4 50%, #b8bdc5 100%);
            border: 2px solid #a8acb4;
            border-radius: 6px;
            font-family: 'Inter', sans-serif;
            font-size: 0.875rem;
            font-weight: 600;
            color: #3a3e46;
            cursor: pointer;
            box-shadow: 
                0 2px 6px rgba(0, 0, 0, 0.2),
                inset 0 1px 2px rgba(255, 255, 255, 0.4),
                inset 0 -1px 2px rgba(0, 0, 0, 0.15);
            appearance: auto;
            -webkit-appearance: menulist;
            -moz-appearance: menulist;
        }
        
        .hh-select option {
            background: white;
            color: #3a3e46;
            padding: 0.5rem;
        }
        
        .hh-select:focus {
            outline: none;
            border-color: var(--purple-primary);
        }
        
        .hh-pos-chips {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
        }
        
        .hh-position-toggle {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
        }
        
        .hh-toggle-btn {
            padding: 0.75rem;
            background: linear-gradient(135deg, #d8dde5 0%, #c8ccd4 50%, #b8bdc5 100%);
            border: 2px solid #a8acb4;
            border-radius: 6px;
            font-family: 'Inter', sans-serif;
            font-size: 0.875rem;
            font-weight: 700;
            color: #5a5e66;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            box-shadow: 
                0 2px 6px rgba(0, 0, 0, 0.2),
                inset 0 1px 2px rgba(255, 255, 255, 0.4),
                inset 0 -1px 2px rgba(0, 0, 0, 0.15);
        }
        
        .hh-toggle-btn:active,
        .hh-toggle-btn.active {
            background: linear-gradient(135deg, var(--purple-primary) 0%, #9333ea 100%);
            border-color: #7e22ce;
            color: white;
            transform: translateY(0px);
            box-shadow: 
                0 1px 3px rgba(0, 0, 0, 0.2),
                inset 0 1px 3px rgba(0, 0, 0, 0.2);
        }
        
        .hh-street-card {
            background: rgba(10, 14, 39, 0.3);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid rgba(168, 85, 247, 0.2);
        }
        
        .hh-street-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.875rem;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .hh-actor-name {
            font-size: 1rem;
            font-weight: 800;
            margin-left: 0.5rem;
        }
        
        .hh-actor-name.hero {
            color: #4db8a8;
        }
        
        .hh-actor-name.villain {
            color: #ffa726;
        }
        
        @keyframes hh-rapid-blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.2; }
        }
        
        .hh-actor-name.active {
            animation: hh-rapid-blink 0.15s ease-in-out 3;
        }
        
        .hh-skip-street {
            padding: 0.5rem 1rem;
            background: linear-gradient(135deg, #d8dde5 0%, #c8ccd4 50%, #b8bdc5 100%);
            border: 2px solid #a8acb4;
            border-radius: 6px;
            font-size: 1.125rem;
            font-weight: 700;
            color: #5a5e66;
            cursor: pointer;
            box-shadow: 
                0 2px 6px rgba(0, 0, 0, 0.2),
                inset 0 1px 2px rgba(255, 255, 255, 0.4);
        }
        
        .hh-skip-street:active {
            transform: scale(0.95);
        }
        
        .hh-cards-input {
            width: 100%;
            padding: 0.625rem;
            border: 2px solid #a8acb4;
            border-radius: 6px;
            background: rgba(0, 0, 0, 0.3);
            font-family: 'Inter', sans-serif;
            font-size: 0.875rem;
            font-weight: 600;
            color: white;
            margin-bottom: 0.75rem;
        }
        
        .hh-cards-input:focus {
            outline: none;
            border-color: var(--purple-primary);
        }
        
        .hh-cards-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }
        
        .hh-action-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }
        
        .hh-action-btn {
            padding: 0.875rem 0.5rem;
            background: linear-gradient(135deg, #d8dde5 0%, #c8ccd4 50%, #b8bdc5 100%);
            border: 2px solid #a8acb4;
            border-radius: 6px;
            font-family: 'Inter', sans-serif;
            font-size: 0.8125rem;
            font-weight: 700;
            color: #3a3e46;
            cursor: pointer;
            transition: all 0.1s;
            box-shadow: 
                0 2px 6px rgba(0, 0, 0, 0.2),
                inset 0 1px 2px rgba(255, 255, 255, 0.4);
        }
        
        .hh-action-btn:active {
            transform: scale(0.95);
            background: linear-gradient(135deg, #c8ccd4 0%, #b8bdc5 50%, #a8acb4 100%);
        }
        
        .hh-amount-row {
            display: none;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }
        
        .hh-amount-row.visible {
            display: flex;
        }
        
        .hh-amount-input {
            flex: 2;
            padding: 0.625rem;
            border: 2px solid #a8acb4;
            border-radius: 6px;
            background: rgba(0, 0, 0, 0.3);
            font-family: 'Inter', sans-serif;
            font-size: 0.875rem;
            font-weight: 600;
            color: white;
        }
        
        .hh-amount-input:focus {
            outline: none;
            border-color: var(--purple-primary);
        }
        
        .hh-amount-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }
        
        .hh-next-btn {
            flex: 0 0 60px;
            padding: 0.625rem;
            background: linear-gradient(135deg, #d8dde5 0%, #c8ccd4 50%, #b8bdc5 100%);
            border: 2px solid #a8acb4;
            border-radius: 6px;
            font-family: 'Inter', sans-serif;
            font-size: 1.125rem;
            font-weight: 700;
            color: #5a5e66;
            cursor: pointer;
            box-shadow: 
                0 2px 6px rgba(0, 0, 0, 0.2),
                inset 0 1px 2px rgba(255, 255, 255, 0.4);
        }
        
        .hh-next-btn:active {
            transform: scale(0.95);
        }
        
        .hh-action-history {
            margin-top: 0.75rem;
        }
        
        .hh-action-item {
            padding: 0.375rem 0;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        .hh-action-item.hero {
            color: var(--purple-primary);
        }
        
        .hh-action-item.villain {
            color: var(--orange-accent);
        }
        
        .hh-hand-summary {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .hh-summary-street {
            margin-bottom: 0.75rem;
        }
        
        .hh-summary-street:last-child {
            margin-bottom: 0;
        }
        
        .hh-summary-street-name {
            font-size: 0.75rem;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 0.25rem;
        }
        
        .hh-summary-action {
            font-size: 0.8125rem;
            font-weight: 600;
            padding: 0.125rem 0;
        }
        
        .hh-summary-action.hero {
            color: var(--purple-primary);
        }
        
        .hh-summary-action.villain {
            color: var(--orange-accent);
        }
        }
    </style>
</head>
<body>
    <!-- Splash Screen -->
    <div id="splash-screen" onclick="hideSplash()">
        <div class="splash-metal-sheet">
            <div class="splash-logo">NitWiz</div>
            <div class="splash-subtitle">LIVE MTT TRAINER</div>
            <div class="splash-logo-icon">
                <svg width="120" height="94" viewBox="0 0 64 52" fill="none" stroke="#3a3e46" stroke-width="0.8" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M4 6l40 4"/>
                    <path d="M44 10l-0.5 2-1-0.5-0.5 2-1-0.5-0.5 2-1-0.5-0.5 2-1-0.5-0.5 2-1-0.5-0.5 2-1-0.5-0.5 2-1-0.5-0.5 2-1-0.5-0.5 2-1-0.5-0.5 2-1-0.5"/>
                    <path d="M29 25l0.5 1.5 1.5-0.5 0.5 1.5 1.5-0.5 0.5 1.5 1.5-0.5 0.5 1.5 1.5-0.5 0.5 1.5 1.5-0.5"/>
                    <path d="M39 30l-16 8"/>
                    <circle cx="34" cy="16" r="1.6" fill="#3a3e46" stroke="none"/>
                    <path d="M46.5 15.5l3 1.5-3 1.5 M46.5 15.5l-3 1.5 3 1.5" stroke-width="0.5" fill="none"/>
                    <path d="M43.5 17l-1.5-1.5 M43.5 17l-1.5 1.5" stroke-width="0.5"/>
                    <circle cx="48" cy="16.5" r="0.6" fill="#3a3e46" stroke="none"/>
                    <path d="M47.3 17.8l1.4-0.5" stroke-width="0.7"/>
                    <path d="M44 21.5l2.2 1.2-2.2 1.2 M44 21.5l-2.2 1.2 2.2 1.2" stroke-width="0.4" fill="none"/>
                    <path d="M41.8 22.7l-1-1 M41.8 22.7l-1 1" stroke-width="0.4"/>
                    <circle cx="45.2" cy="22.2" r="0.45" fill="#3a3e46" stroke="none"/>
                    <path d="M44.6 23.2l1-0.4" stroke-width="0.55"/>
                </svg>
            </div>
            <div class="splash-suits-metal">♠ ♣ ♥ ♦</div>
            <div class="splash-copyright">© 2025 NitWiz. All rights reserved.</div>
        </div>
    </div>

    <div class="container" id="main-container" style="display: none;">
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="dashboard-grid">
                <button class="dashboard-btn" onclick="switchTab('archetype-builder')">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                        <path d="M2 17l10 5 10-5"></path>
                        <path d="M2 12l10 5 10-5"></path>
                    </svg>
                    <span>Archetype Definitions</span>
                </button>
                
                <button class="dashboard-btn" onclick="switchTab('archetypes')">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    <span>Archetypes</span>
                </button>
                
                <button class="dashboard-btn" onclick="switchTab('players')">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    <span>Players</span>
                </button>
                
                <button class="dashboard-btn" onclick="switchTab('brief')">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                        <polyline points="10 9 9 9 8 9"></polyline>
                    </svg>
                    <span>Pre-Game Brief</span>
                </button>
                
                <button class="dashboard-btn" onclick="switchTab('data')">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
                        <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path>
                        <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>
                    </svg>
                    <span>Data</span>
                </button>
                
                <button class="dashboard-btn" onclick="switchTab('live-session')">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    <span>Live Session Notes</span>
                </button>
            </div>
            
            <!-- Exit Button -->
            <div style="display: flex; justify-content: center; margin-top: 3rem;">
                <button class="exit-btn" onclick="exitApp()" title="Exit NitWiz" style="position: static; transform: none;">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16 17 21 12 16 7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Archetype Definition Tab -->
        <div id="archetype-builder" class="tab-content">
            <div class="section">
                <div class="section-title">⚡ Build New Archetype</div>
                <form id="full-archetype-form">
                    <!-- Basic Info -->
                    <div class="form-group">
                        <label>Archetype Name *</label>
                        <input type="text" id="builder-name" placeholder="e.g., Scared Money, Calling Station" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="builder-description" placeholder="Brief description of this player type..."></textarea>
                    </div>

                    <!-- Play Style Attributes -->
                    <div class="form-section-divider">
                        <div class="form-section-header">Play Style Attributes</div>
                    </div>

                    <div class="form-subsection">
                        <h4 class="form-subsection-header">Pre-flop</h4>
                        
                        <div class="form-group slider-layout">
                            <label>VPIP</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label active" data-slider="vpip" data-value="0">Low</span>
                                    <span class="slider-value-label" data-slider="vpip" data-value="1">Med</span>
                                    <span class="slider-value-label" data-slider="vpip" data-value="2">High</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="0" step="1" class="range-slider" id="vpip" name="vpip">
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Pre-flop Aggression</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label active" data-slider="pfr-aggression" data-value="0">Low</span>
                                    <span class="slider-value-label" data-slider="pfr-aggression" data-value="1">Med</span>
                                    <span class="slider-value-label" data-slider="pfr-aggression" data-value="2">High</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="0" step="1" class="range-slider" id="pfr-aggression" name="pfr-aggression">
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Defense vs 3-bet</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label" data-slider="fold3bet" data-value="0">Rarely</span>
                                    <span class="slider-value-label" data-slider="fold3bet" data-value="1">Sometimes</span>
                                    <span class="slider-value-label active" data-slider="fold3bet" data-value="2">Often</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="2" step="1" class="range-slider" id="fold3bet" name="fold3bet">
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Cold Call Freq</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label active" data-slider="coldcall" data-value="0">Low</span>
                                    <span class="slider-value-label" data-slider="coldcall" data-value="1">Med</span>
                                    <span class="slider-value-label" data-slider="coldcall" data-value="2">High</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="0" step="1" class="range-slider" id="coldcall" name="coldcall">
                            </div>
                        </div>
                    </div>

                    <div class="form-subsection">
                        <h4 class="form-subsection-header">Post-flop</h4>
                        
                        <div class="form-group slider-layout">
                            <label>Post-flop Aggression</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label" data-slider="postflop-aggression" data-value="0">Low</span>
                                    <span class="slider-value-label" data-slider="postflop-aggression" data-value="1">Med</span>
                                    <span class="slider-value-label active" data-slider="postflop-aggression" data-value="2">High</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="2" step="1" class="range-slider" id="postflop-aggression" name="postflop-aggression">
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Folds to C-bet</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label" data-slider="foldcbet" data-value="0">Never</span>
                                    <span class="slider-value-label" data-slider="foldcbet" data-value="1">Sometimes</span>
                                    <span class="slider-value-label active" data-slider="foldcbet" data-value="2">Often</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="2" step="1" class="range-slider" id="foldcbet" name="foldcbet">
                            </div>
                        </div>
                    </div>

                    <div class="form-subsection">
                        <h4 class="form-subsection-header">Overall Style</h4>
                        
                        <div class="checkbox-group" style="background: transparent; border: none; padding: 0.5rem 0;">
                            <label for="builder-chases-draws" class="toggle-label">Chases draws</label>
                            <div class="toggle-container">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="builder-chases-draws">
                                    <span class="toggle-slider">
                                        <span class="toggle-knob"></span>
                                    </span>
                                </label>
                            </div>
                        </div>

                        <div class="checkbox-group" style="background: transparent; border: none; padding: 0.5rem 0;">
                            <label for="builder-any-two" class="toggle-label">Limps/cold calls with any two cards</label>
                            <div class="toggle-container">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="builder-any-two">
                                    <span class="toggle-slider">
                                        <span class="toggle-knob"></span>
                                    </span>
                                </label>
                            </div>
                        </div>

                        <div class="checkbox-group" style="background: transparent; border: none; padding: 0.5rem 0;">
                            <label for="builder-loves-faces" class="toggle-label">Loves face cards / any ace</label>
                            <div class="toggle-container">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="builder-loves-faces">
                                    <span class="toggle-slider">
                                        <span class="toggle-knob"></span>
                                    </span>
                                </label>
                            </div>
                        </div>

                        <div class="checkbox-group" style="background: transparent; border: none; padding: 0.5rem 0;">
                            <label for="builder-cheap-river" class="toggle-label">Wants to get to river cheap</label>
                            <div class="toggle-container">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="builder-cheap-river">
                                    <span class="toggle-slider">
                                        <span class="toggle-knob"></span>
                                    </span>
                                </label>
                            </div>
                        </div>

                        <div class="checkbox-group" style="background: transparent; border: none; padding: 0.5rem 0;">
                            <label for="builder-limp-jam" class="toggle-label">Limp/jams with AK, AQ, any pair 88+</label>
                            <div class="toggle-container">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="builder-limp-jam">
                                    <span class="toggle-slider">
                                        <span class="toggle-knob"></span>
                                    </span>
                                </label>
                            </div>
                        </div>

                        <div class="checkbox-group" style="background: transparent; border: none; padding: 0.5rem 0;">
                            <label for="builder-no-river" class="toggle-label">Unable/unwilling to play out to river</label>
                            <div class="toggle-container">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="builder-no-river">
                                    <span class="toggle-slider">
                                        <span class="toggle-knob"></span>
                                    </span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Personality Attributes -->
                    <div class="form-section-divider">
                        <div class="form-section-header">Personality Attributes</div>
                    </div>

                    <div class="form-subsection">
                        <h4 class="form-subsection-header">Psychological</h4>
                        
                        <div class="checkbox-group" style="background: transparent; border: none; padding: 0.5rem 0;">
                            <label for="builder-tilt-prone" class="toggle-label">Tilt prone</label>
                            <div class="toggle-container">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="builder-tilt-prone">
                                    <span class="toggle-slider">
                                        <span class="toggle-knob"></span>
                                    </span>
                                </label>
                            </div>
                        </div>

                        <div class="checkbox-group" style="background: transparent; border: none; padding: 0.5rem 0;">
                            <label for="builder-scared-money" class="toggle-label">Scared money</label>
                            <div class="toggle-container">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="builder-scared-money">
                                    <span class="toggle-slider">
                                        <span class="toggle-knob"></span>
                                    </span>
                                </label>
                            </div>
                        </div>

                        <div class="checkbox-group" style="background: transparent; border: none; padding: 0.5rem 0;">
                            <label for="builder-ego-driven" class="toggle-label">Ego-driven</label>
                            <div class="toggle-container">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="builder-ego-driven">
                                    <span class="toggle-slider">
                                        <span class="toggle-knob"></span>
                                    </span>
                                </label>
                            </div>
                        </div>

                        <div class="checkbox-group" style="background: transparent; border: none; padding: 0.5rem 0;">
                            <label for="builder-result-oriented" class="toggle-label">Result-oriented</label>
                            <div class="toggle-container">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="builder-result-oriented">
                                    <span class="toggle-slider">
                                        <span class="toggle-knob"></span>
                                    </span>
                                </label>
                            </div>
                        </div>

                        <div class="checkbox-group" style="background: transparent; border: none; padding: 0.5rem 0;">
                            <label for="builder-reckless" class="toggle-label">Reckless under pressure</label>
                            <div class="toggle-container">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="builder-reckless">
                                    <span class="toggle-slider">
                                        <span class="toggle-knob"></span>
                                    </span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="form-subsection">
                        <h4 class="form-subsection-header">Player Dynamics</h4>
                        
                        <div class="form-group slider-layout">
                            <label>Table Presence</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label active" data-slider="table-talk" data-value="0">Quiet</span>
                                    <span class="slider-value-label" data-slider="table-talk" data-value="1">Engaged</span>
                                    <span class="slider-value-label" data-slider="table-talk" data-value="2">Talkative</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="0" step="1" class="range-slider" id="table-talk" name="table-talk">
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Focus Level</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label" data-slider="attention" data-value="0">Low</span>
                                    <span class="slider-value-label active" data-slider="attention" data-value="1">Med</span>
                                    <span class="slider-value-label" data-slider="attention" data-value="2">High</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="1" step="1" class="range-slider" id="attention" name="attention">
                            </div>
                        </div>
                    </div>

                    <div class="form-subsection">
                        <h4 class="form-subsection-header">Game Awareness</h4>
                        
                        <div class="form-group slider-layout">
                            <label>Stack Protection</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label" data-slider="stack-protection" data-value="0">Low</span>
                                    <span class="slider-value-label" data-slider="stack-protection" data-value="1">Med</span>
                                    <span class="slider-value-label active" data-slider="stack-protection" data-value="2">High</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="2" step="1" class="range-slider" id="stack-protection" name="stack-protection">
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Skill Level</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label active" data-slider="skill-level" data-value="0">Beginner</span>
                                    <span class="slider-value-label" data-slider="skill-level" data-value="1">Intermediate</span>
                                    <span class="slider-value-label" data-slider="skill-level" data-value="2">Advanced</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="0" step="1" class="range-slider" id="skill-level" name="skill-level">
                            </div>
                        </div>
                    </div>

                    <!-- Exploits -->
                    <div class="form-section-divider">
                        <div class="form-section-header">Exploitation Strategy</div>
                    </div>

                    <div class="form-group">
                        <label>Pre-flop Exploits (one per line)</label>
                        <textarea id="builder-exploits-preflop" placeholder="Steal blinds relentlessly - they fold 90%+
3-bet their rare raises for fold equity
Never cold call their raises without premium hands"></textarea>
                    </div>

                    <div class="form-group">
                        <label>Post-flop Exploits (one per line)</label>
                        <textarea id="builder-exploits-postflop" placeholder="C-bet 100% on all boards - they fold without connection
Double barrel if they call flop
Don't bluff river - if they called flop/turn they have something"></textarea>
                    </div>

                    <div class="form-group">
                        <label>Bubble Exploits (one per line)</label>
                        <textarea id="builder-exploits-bubble" placeholder="Apply maximum ICM pressure - they're paralyzed
Shove any two cards in late position vs their blinds
They'll fold medium pairs to avoid elimination"></textarea>
                    </div>

                    <div class="form-group">
                        <label>Warnings / Red Flags (one per line)</label>
                        <textarea id="builder-warnings" placeholder="If they limp then call a raise - trap with premium hand
If they lead out betting - strong hand, not bluffing
If they check-raise - nuts or very strong"></textarea>
                    </div>

                    <div class="form-group">
                        <label>Additional Notes</label>
                        <textarea id="builder-notes" placeholder="Any other observations about this archetype..."></textarea>
                    </div>

                    <button type="submit" class="btn btn-primary">💾 Save Archetype</button>
                    <button type="button" class="btn btn-secondary" onclick="resetBuilderForm()">🔄 Reset Form</button>
                </form>
            </div>
            <div style="display: flex; justify-content: center; margin: 2rem 0 1rem;">
                <button type="button" class="btn-metallic btn-home" onclick="switchTab('dashboard')" title="Return to Dashboard">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Archetypes Tab -->
        <div id="archetypes" class="tab-content">
            <div class="section">
                <div class="section-title">Archetypes</div>
                <button class="btn btn-primary" onclick="showArchetypeForm()">+ New Archetype</button>
                <div class="search-box">
                    <input type="text" id="archetype-search" placeholder="Search archetypes..." onkeyup="filterArchetypes()">
                </div>
                <div class="list-container" id="archetype-list"></div>
            </div>

            <div class="section" id="archetype-form-section" style="display: none;">
                <div class="section-title" id="archetype-form-title">New Archetype</div>
                <form id="archetype-form">
                    <div class="form-group">
                        <label>Archetype Name *</label>
                        <input type="text" id="arch-name" required>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="arch-description"></textarea>
                    </div>
                    <div class="form-group">
                        <label>VPIP</label>
                        <select id="arch-vpip">
                            <option selected>Low (&lt;25%)</option>
                            <option>Med (25-50%)</option>
                            <option>High (&gt;50%)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>PFR</label>
                        <select id="arch-pfr">
                            <option selected>Low (&lt;25%)</option>
                            <option>Med (25-50%)</option>
                            <option>High (&gt;50%)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Key Exploits (one per line)</label>
                        <textarea id="arch-exploits" placeholder="Steal blinds relentlessly
C-bet 100% of flops
Don't bluff river"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Warnings (one per line)</label>
                        <textarea id="arch-warnings" placeholder="If they check-raise, they have nuts
Sudden aggression = premium hand"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Archetype</button>
                    <button type="button" class="btn btn-secondary" onclick="hideArchetypeForm()">Cancel</button>
                    <button type="button" class="btn btn-danger" onclick="deleteArchetype()" id="delete-archetype-btn" style="display: none;">Delete</button>
                </form>
            </div>
            <div style="display: flex; justify-content: center; margin: 2rem 0 1rem;">
                <button type="button" class="btn-metallic btn-home" onclick="switchTab('dashboard')" title="Return to Dashboard">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Players Tab -->
        <div id="players" class="tab-content">
            <!-- Combination Lock Player Picker -->
            <div class="combo-lock-frame">
                <div class="apple-picker-container" id="drum-container">
                    <div class="apple-picker-selection-bar"></div>
                    <div class="apple-picker-scroll">
                        <div class="drum-cylinder" id="player-picker">
                            <!-- Players will be populated here -->
                        </div>
                    </div>
                    <!-- Drum side ridges (grip texture) -->
                    <div class="drum-ridge drum-ridge-left"></div>
                    <div class="drum-ridge drum-ridge-right"></div>
                    <!-- Touch capture overlay — sits on top, captures all touches -->
                    <div class="drum-touch-overlay" id="drum-touch-overlay"></div>
                </div>
            </div>

            <div class="section" id="player-form-section" style="display: none; margin-top: 3rem;">
                <div class="section-title" id="player-form-title">New Player</div>
                <form id="player-form">
                    <!-- Hidden field to store player name -->
                    <input type="hidden" id="player-name" required>

                    <div class="form-subsection">
                        <h4 class="form-subsection-header">Pre-flop</h4>
                        
                        <div class="form-group slider-layout">
                            <label>VPIP</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label active" data-slider="player-vpip" data-value="0">Low</span>
                                    <span class="slider-value-label" data-slider="player-vpip" data-value="1">Med</span>
                                    <span class="slider-value-label" data-slider="player-vpip" data-value="2">High</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="0" step="1" class="range-slider" id="player-vpip" name="player-vpip">
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Pre-flop Aggression</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label active" data-slider="player-pfr-aggression" data-value="0">Low</span>
                                    <span class="slider-value-label" data-slider="player-pfr-aggression" data-value="1">Med</span>
                                    <span class="slider-value-label" data-slider="player-pfr-aggression" data-value="2">High</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="0" step="1" class="range-slider" id="player-pfr-aggression" name="player-pfr-aggression">
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Defense vs 3-bet</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label active" data-slider="player-fold3bet" data-value="0">Rarely</span>
                                    <span class="slider-value-label" data-slider="player-fold3bet" data-value="1">Sometimes</span>
                                    <span class="slider-value-label" data-slider="player-fold3bet" data-value="2">Often</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="0" step="1" class="range-slider" id="player-fold3bet" name="player-fold3bet">
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Cold Call Freq</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label active" data-slider="player-coldcall" data-value="0">Low</span>
                                    <span class="slider-value-label" data-slider="player-coldcall" data-value="1">Med</span>
                                    <span class="slider-value-label" data-slider="player-coldcall" data-value="2">High</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="0" step="1" class="range-slider" id="player-coldcall" name="player-coldcall">
                            </div>
                        </div>
                    </div>

                    <div class="form-subsection">
                        <h4 class="form-subsection-header">Post-flop</h4>
                        
                        <div class="form-group slider-layout">
                            <label>Post-flop Aggression</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label active" data-slider="player-postflop-aggression" data-value="0">Low</span>
                                    <span class="slider-value-label" data-slider="player-postflop-aggression" data-value="1">Med</span>
                                    <span class="slider-value-label" data-slider="player-postflop-aggression" data-value="2">High</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="0" step="1" class="range-slider" id="player-postflop-aggression" name="player-postflop-aggression">
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Folds to C-bet</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label active" data-slider="player-foldcbet" data-value="0">Never</span>
                                    <span class="slider-value-label" data-slider="player-foldcbet" data-value="1">Sometimes</span>
                                    <span class="slider-value-label" data-slider="player-foldcbet" data-value="2">Often</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="0" step="1" class="range-slider" id="player-foldcbet" name="player-foldcbet">
                            </div>
                        </div>
                    </div>

                    <div class="form-subsection">
                        <h4 class="form-subsection-header">Player Dynamics</h4>
                        
                        <div class="form-group slider-layout">
                            <label>Table Presence</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label active" data-slider="player-table-talk" data-value="0">Quiet</span>
                                    <span class="slider-value-label" data-slider="player-table-talk" data-value="1">Engaged</span>
                                    <span class="slider-value-label" data-slider="player-table-talk" data-value="2">Talkative</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="0" step="1" class="range-slider" id="player-table-talk" name="player-table-talk">
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Focus Level</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label active" data-slider="player-attention" data-value="0">Low</span>
                                    <span class="slider-value-label" data-slider="player-attention" data-value="1">Med</span>
                                    <span class="slider-value-label" data-slider="player-attention" data-value="2">High</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="0" step="1" class="range-slider" id="player-attention" name="player-attention">
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Style</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label active" data-slider="player-style" data-value="0">Weak-Tight</span>
                                    <span class="slider-value-label" data-slider="player-style" data-value="1">Strong-Tight</span>
                                    <span class="slider-value-label" data-slider="player-style" data-value="2">Weak-Loose</span>
                                    <span class="slider-value-label" data-slider="player-style" data-value="3">Strong-Loose</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="3" value="0" step="1" class="range-slider" id="player-style" name="player-style">
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Cunning</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label active" data-slider="player-cunning" data-value="0">Low</span>
                                    <span class="slider-value-label" data-slider="player-cunning" data-value="1">Med</span>
                                    <span class="slider-value-label" data-slider="player-cunning" data-value="2">High</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="0" step="1" class="range-slider" id="player-cunning" name="player-cunning">
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Thinking</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label active" data-slider="player-thinking" data-value="0">Automaton</span>
                                    <span class="slider-value-label" data-slider="player-thinking" data-value="1">Average</span>
                                    <span class="slider-value-label" data-slider="player-thinking" data-value="2">Thinking</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="0" step="1" class="range-slider" id="player-thinking" name="player-thinking">
                            </div>
                        </div>
                    </div>

                    <div class="form-subsection">
                        <h4 class="form-subsection-header">Game Awareness</h4>
                        
                        <div class="form-group slider-layout">
                            <label>Stack Protection</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label active" data-slider="player-stack-protection" data-value="0">Low</span>
                                    <span class="slider-value-label" data-slider="player-stack-protection" data-value="1">Med</span>
                                    <span class="slider-value-label" data-slider="player-stack-protection" data-value="2">High</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="0" step="1" class="range-slider" id="player-stack-protection" name="player-stack-protection">
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Skill Level</label>
                            <div class="slider-control-group">
                                <div class="slider-value-labels">
                                    <span class="slider-value-label active" data-slider="player-skill-level" data-value="0">Beginner</span>
                                    <span class="slider-value-label" data-slider="player-skill-level" data-value="1">Intermediate</span>
                                    <span class="slider-value-label" data-slider="player-skill-level" data-value="2">Advanced</span>
                                </div>
                                <div class="slider-etched-line"></div>
                                <input type="range" min="0" max="2" value="0" step="1" class="range-slider" id="player-skill-level" name="player-skill-level">
                            </div>
                        </div>
                    </div>

                    <!-- Key Weaknesses -->
                    <div class="form-subsection notecard-section">
                        <h4 class="form-subsection-header">Key Weaknesses</h4>
                        <div class="notecard-layout">
                            <div class="notecard-display" id="player-weakness-display">
                                <div class="notecard-entries" id="player-weakness-list"></div>
                                <div class="notecard-actions">
                                    <button type="button" class="notecard-add-btn" id="weakness-add-btn" title="Add new">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                            <line x1="12" y1="5" x2="12" y2="19"></line>
                                            <line x1="5" y1="12" x2="19" y2="12"></line>
                                        </svg>
                                    </button>
                                    <button type="button" class="notecard-edit-btn" id="weakness-edit-btn" title="Edit">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Observations -->
                    <div class="form-subsection notecard-section">
                        <h4 class="form-subsection-header">Observations</h4>
                        <div class="notecard-layout">
                            <div class="notecard-display" id="player-observation-display">
                                <div class="notecard-entries" id="player-observation-list"></div>
                                <div class="notecard-actions">
                                    <button type="button" class="notecard-add-btn" id="observation-add-btn" title="Add new">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                            <line x1="12" y1="5" x2="12" y2="19"></line>
                                            <line x1="5" y1="12" x2="19" y2="12"></line>
                                        </svg>
                                    </button>
                                    <button type="button" class="notecard-edit-btn" id="observation-edit-btn" title="Edit">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <input type="hidden" id="player-observations" />
                    </div>

                    <!-- Player Description -->
                    <div class="form-subsection">
                        <h4 class="form-subsection-header">Player Description</h4>
                        
                        <div class="form-group slider-layout">
                            <label>Gender</label>
                            <div class="desc-selector" data-field="player-gender">
                                <button type="button" class="desc-chip active" data-value="0">Male</button>
                                <button type="button" class="desc-chip" data-value="1">Female</button>
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Age Range</label>
                            <div class="desc-selector" data-field="player-age">
                                <button type="button" class="desc-chip active" data-value="0">Young Stud</button>
                                <button type="button" class="desc-chip" data-value="1">Young</button>
                                <button type="button" class="desc-chip" data-value="2">Middle</button>
                                <button type="button" class="desc-chip" data-value="3">Old</button>
                                <button type="button" class="desc-chip" data-value="4">Ancient</button>
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Ethnicity</label>
                            <div class="desc-selector" data-field="player-ethnicity">
                                <button type="button" class="desc-chip active" data-value="0">White</button>
                                <button type="button" class="desc-chip" data-value="1">Black</button>
                                <button type="button" class="desc-chip" data-value="2">E Asian</button>
                                <button type="button" class="desc-chip" data-value="3">S Asian</button>
                                <button type="button" class="desc-chip" data-value="4">ME</button>
                                <button type="button" class="desc-chip" data-value="5">Hispanic</button>
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Education</label>
                            <div class="desc-selector" data-field="player-education">
                                <button type="button" class="desc-chip active" data-value="0">Some</button>
                                <button type="button" class="desc-chip" data-value="1">College</button>
                                <button type="button" class="desc-chip" data-value="2">Graduate</button>
                                <button type="button" class="desc-chip" data-value="3">Unknown</button>
                            </div>
                        </div>

                        <div class="form-group slider-layout">
                            <label>Profession</label>
                            <div class="desc-selector" data-field="player-profession">
                                <button type="button" class="desc-chip active" data-value="0">Trades</button>
                                <button type="button" class="desc-chip" data-value="1">Home</button>
                                <button type="button" class="desc-chip" data-value="2">Technical</button>
                                <button type="button" class="desc-chip" data-value="3">Prof. Svcs.</button>
                                <button type="button" class="desc-chip" data-value="4">Poker Player</button>
                                <button type="button" class="desc-chip" data-value="5">Business Owner</button>
                                <button type="button" class="desc-chip" data-value="6">Retired</button>
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; justify-content: space-evenly; align-items: center; margin-top: 1.5rem; max-width: 400px; margin-left: auto; margin-right: auto;">
                        <button type="button" class="btn-metallic btn-delete" onclick="deletePlayer()" id="delete-player-btn" title="Delete Player" style="display: none;">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="3 6 5 6 21 6"></polyline>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                <line x1="10" y1="11" x2="10" y2="17"></line>
                                <line x1="14" y1="11" x2="14" y2="17"></line>
                            </svg>
                        </button>
                        <button type="button" class="btn-metallic btn-new" onclick="showPlayerForm()" title="New Player">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                <circle cx="8.5" cy="7" r="4"></circle>
                                <line x1="20" y1="8" x2="20" y2="14"></line>
                                <line x1="23" y1="11" x2="17" y2="11"></line>
                            </svg>
                        </button>
                        <button type="submit" class="btn-metallic btn-save" title="Save Player">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                                <polyline points="17 21 17 13 7 13 7 21"></polyline>
                                <polyline points="7 3 7 8 15 8"></polyline>
                            </svg>
                        </button>
                        <button type="button" class="btn-metallic btn-home" onclick="switchTab('dashboard')" title="Return to Dashboard">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                <polyline points="9 22 9 12 15 12 15 22"></polyline>
                            </svg>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Brief Tab -->
        <div id="brief" class="tab-content">
            <div class="section">
                <div class="section-title">Pre-Game Brief Generator</div>
                <div class="form-group">
                    <label>Select Players at Your Table</label>
                    <div id="brief-player-selection"></div>
                </div>
                <button class="btn btn-primary" onclick="generateBrief()">Generate Brief</button>
            </div>

            <div class="section" id="brief-output" style="display: none;">
                <div class="section-title">🎯 Your Pre-Game Brief</div>
                <div id="brief-content"></div>
            </div>
            <div style="display: flex; justify-content: center; margin: 2rem 0 1rem;">
                <button type="button" class="btn-metallic btn-home" onclick="switchTab('dashboard')" title="Return to Dashboard">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Data Tab -->
        <div id="data" class="tab-content">
            <div class="section">
                <div class="section-title">Import / Export Data</div>
                <div class="form-group">
                    <label>Export Database (JSON)</label>
                    <button class="btn btn-primary" onclick="exportData()">📥 Download JSON</button>
                </div>
                <div class="form-group">
                    <label>Import Database (JSON)</label>
                    <input type="file" id="import-file" accept=".json">
                    <button class="btn btn-secondary" onclick="importData()">📤 Upload JSON</button>
                </div>
            </div>

            <div class="section">
                <div class="section-title">Current Database (JSON)</div>
                <pre id="json-display" style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px; overflow-x: auto; max-height: 500px;"></pre>
            </div>
            <div style="display: flex; justify-content: center; margin: 2rem 0 1rem;">
                <button type="button" class="btn-metallic btn-home" onclick="switchTab('dashboard')" title="Return to Dashboard">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Live Session Tab -->
        <div id="live-session" class="tab-content">
            <div class="section">
                <div class="section-title">🔴 Live Session Notes</div>
                
                <!-- Tournament Info -->
                <div class="form-subsection">
                    <h4 class="form-subsection-header">Tournament Info</h4>
                    
                    <div class="form-group slider-layout">
                        <label>Buy-in</label>
                        <div style="flex: 1;">
                            <input type="text" id="session-buyin" class="session-info-input" placeholder="Enter buy-in amount" inputmode="numeric">
                            <span class="session-info-display hidden" id="session-buyin-display" onclick="editSessionField('buyin')"></span>
                        </div>
                    </div>

                    <div class="form-group slider-layout session-format-row">
                        <label>Format</label>
                        <div class="desc-selector" data-field="session-format" id="session-format-selector">
                            <button type="button" class="desc-chip active" data-value="0">1 Day</button>
                            <button type="button" class="desc-chip" data-value="1">Multi Day</button>
                        </div>
                    </div>

                    <div class="form-group slider-layout">
                        <label>Blind Levels</label>
                        <div style="flex: 1; display: flex; align-items: center; gap: 0.5rem;">
                            <input type="text" id="session-blind-minutes" class="session-info-input" placeholder="Minutes per level" inputmode="numeric">
                            <span class="session-info-display hidden" id="session-blindmin-display" onclick="editSessionField('blindmin')"></span>
                        </div>
                    </div>

                    <div class="form-group slider-layout">
                        <label>Starting Stack</label>
                        <div style="flex: 1;">
                            <input type="text" id="session-stack" class="session-info-input" placeholder="Starting chip count" inputmode="numeric">
                            <span class="session-info-display hidden" id="session-stack-display" onclick="editSessionField('stack')"></span>
                        </div>
                    </div>

                    <div class="form-group slider-layout">
                        <label>Venue</label>
                        <div style="flex: 1;">
                            <input type="text" id="session-venue" class="session-info-input" placeholder="Casino or venue name">
                            <span class="session-info-display hidden" id="session-venue-display" onclick="editSessionField('venue')"></span>
                        </div>
                    </div>

                    <div class="form-group slider-layout">
                        <label>Notes</label>
                        <div style="flex: 1;">
                            <input type="text" id="session-tournotes" class="session-info-input" placeholder="Tournament notes">
                            <span class="session-info-display hidden" id="session-tournotes-display" onclick="editSessionField('tournotes')"></span>
                        </div>
                    </div>
                </div>

                <!-- Table Setup (Combined Blind Level + Players) -->
                <div class="form-subsection">
                    <h4 class="form-subsection-header">Table Setup</h4>
                    
                    <!-- Blind Level Section -->
                    <div class="table-setup-section">
                        <div class="table-setup-label">Blind Level</div>
                        <div class="blind-tracker">
                            <div class="blind-display">
                                <button class="btn-metallic btn-blind-nav" onclick="prevBlindLevel()" title="Previous Level">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                        <polyline points="15 18 9 12 15 6"></polyline>
                                    </svg>
                                </button>
                                <div class="blind-level-info">
                                    <div class="blind-level-number" id="blind-level-num">Level 1</div>
                                    <div class="blind-level-values" id="blind-level-values-display" onclick="editBlindLevel()">25 / 50 / 0 ante</div>
                                    <div class="blind-level-edit-row hidden" id="blind-level-edit-row">
                                        <input type="text" id="blind-sb-input" class="blind-edit-input" placeholder="SB" inputmode="numeric">
                                        <span class="blind-edit-slash">/</span>
                                        <input type="text" id="blind-bb-input" class="blind-edit-input" placeholder="BB" inputmode="numeric">
                                        <span class="blind-edit-slash">/</span>
                                        <input type="text" id="blind-ante-input" class="blind-edit-input" placeholder="Ante" inputmode="numeric">
                                    </div>
                                    <div class="blind-level-ante" id="blind-level-ante">Ante: 50</div>
                                </div>
                                <button class="btn-metallic btn-blind-nav" onclick="nextBlindLevel()" title="Next Level">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                        <polyline points="9 18 15 12 9 6"></polyline>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                </div>

                <!-- Hand History -->
                <div class="form-subsection">
                    <h4 class="form-subsection-header" style="display: flex; justify-content: space-between; align-items: center;">
                        <span>Hand History</span>
                        <span id="hh-hand-number" style="font-size: 0.8rem; color: #8a8e96; font-weight: 600;">#1</span>
                    </h4>
                    <div class="hh-card-inner" id="hh-card-inner">
                        
                        <!-- Setup Card -->
                        <div class="hh-setup-card" id="hh-setup-card">
                            <!-- Player 1 Selection -->
                            <div class="hh-setup-row" id="hh-hero-select-row">
                                <div style="font-size: 12px; font-weight: 600; color: #4db8a8; margin-bottom: 6px;">Select Hero</div>
                                <select class="hh-select" id="hh-hero-select" onchange="hhOnHeroSelect()">
                                    <option value="">Select Player to Track...</option>
                                </select>
                            </div>
                            
                            <!-- Player 2 Selection -->
                            <div class="hh-setup-row" id="hh-villain-select-row" style="display: none;">
                                <div style="font-size: 12px; font-weight: 600; color: #ffa726; margin-bottom: 6px;">Select Villain</div>
                                <select class="hh-select" id="hh-villain-select" onchange="hhOnVillainSelect()">
                                    <option value="">-- Generic Villain --</option>
                                </select>
                            </div>
                            
                            <!-- Shared Position Selection -->
                            <div class="hh-setup-row" id="hh-position-row" style="display: none;">
                                <div id="hh-position-instruction" style="font-size: 14px; font-weight: 600; color: #8a8e96; margin-bottom: 12px; text-align: center;">
                                    Click to select Player 1's position
                                </div>
                                <div class="hh-pos-chips" id="hh-shared-pos-chips" style="display: flex; flex-wrap: wrap; gap: 6px; justify-content: center;">
                                    <div class="hh-pos-chip" data-position="SB" onclick="hhSelectSharedPosition('SB')" style="min-width: 45px; padding: 6px 10px; font-size: 11px;">SB</div>
                                    <div class="hh-pos-chip" data-position="BB" onclick="hhSelectSharedPosition('BB')" style="min-width: 45px; padding: 6px 10px; font-size: 11px;">BB</div>
                                    <div class="hh-pos-chip" data-position="UTG" onclick="hhSelectSharedPosition('UTG')" style="min-width: 45px; padding: 6px 10px; font-size: 11px;">UTG</div>
                                    <div class="hh-pos-chip" data-position="MP" onclick="hhSelectSharedPosition('MP')" style="min-width: 45px; padding: 6px 10px; font-size: 11px;">MP</div>
                                    <div class="hh-pos-chip" data-position="HJ" onclick="hhSelectSharedPosition('HJ')" style="min-width: 45px; padding: 6px 10px; font-size: 11px;">HJ</div>
                                    <div class="hh-pos-chip" data-position="CO" onclick="hhSelectSharedPosition('CO')" style="min-width: 45px; padding: 6px 10px; font-size: 11px;">CO</div>
                                    <div class="hh-pos-chip" data-position="BTN" onclick="hhSelectSharedPosition('BTN')" style="min-width: 45px; padding: 6px 10px; font-size: 11px;">D</div>
                                </div>
                            </div>
                            
                            <!-- Read-only display after setup complete -->
                            <div id="hh-setup-readonly" style="display: none;">
                                <div style="font-family: 'Inter', sans-serif; font-size: 0.72rem; font-weight: 800; color: #5a5e66; text-align: center; padding: 10px; text-shadow: 0 1px 0 rgba(255, 255, 255, 0.3), 0 -1px 0 rgba(0, 0, 0, 0.7);">
                                    <span id="hh-readonly-hero" style="color: #4db8a8;"></span> <span style="color: #5a5e66;">(<span id="hh-readonly-position"></span>)</span> <span style="color: #7a7e86;">•</span> <span id="hh-readonly-villain" style="color: #ffa726;"></span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Street Actions Card -->
                        <div class="hh-street-card" id="hh-street-card" style="display: none;">
                            <div class="hh-street-header">
                                <div>
                                    <span id="hh-street-name" style="font-family: 'Inter', sans-serif; font-size: 1rem; font-weight: 800; font-variant: small-caps; color: #8a8e96; text-shadow: 0 1px 0 rgba(255, 255, 255, 0.3), 0 -1px 0 rgba(0, 0, 0, 0.7); letter-spacing: 0.05em;">PreFlop</span>
                                    <span class="hh-actor-name" id="hh-actor-display"></span>
                                </div>
                            </div>
                            
                            <input type="text" class="hh-cards-input" id="hh-community-cards" placeholder="Community Cards" autocapitalize="off" style="display: none;">
                            
                            <div class="hh-action-grid" id="hh-action-buttons"></div>
                            
                            <div class="hh-amount-row" id="hh-amount-row">
                                <input type="text" class="hh-amount-input" id="hh-amount-input" placeholder="Amount (e.g., 100, 2.5BB, 1/2 Pot)" autocapitalize="off">
                                <button class="hh-next-btn" onclick="hhCommitCurrentAction()">▶</button>
                            </div>
                            
                            <button class="hh-skip-street" onclick="hhSkipStreet()" style="margin-top: 12px; width: 100%; padding: 0.75rem; font-size: 0.875rem;">Next Street ▶</button>
                            
                            <div class="hh-action-history" id="hh-action-history"></div>
                        </div>
                        
                        <!-- Showdown/Results Card -->
                        <div class="hh-street-card" id="hh-results-card" style="display: none;">
                            <div class="hh-street-header">
                                <div id="hh-results-title">Hand Complete</div>
                            </div>
                            
                            <div id="hh-hand-summary"></div>
                            
                            <div style="margin-top: 12px;">
                                <label style="display: block; font-size: 11px; font-weight: 600; color: #8a8e96; margin-bottom: 4px;">Cards (if shown)</label>
                                <div style="display: flex; gap: 8px; margin-bottom: 10px;">
                                    <input type="text" class="hh-cards-input" id="hh-hero-cards" placeholder="Hero: e.g., AsKh" autocapitalize="off" style="flex: 1;">
                                    <input type="text" class="hh-cards-input" id="hh-villain-cards" placeholder="Villain: e.g., QdQc" autocapitalize="off" style="flex: 1;">
                                </div>
                                
                                <label style="display: block; font-size: 11px; font-weight: 600; color: #8a8e96; margin-bottom: 4px;">Winner</label>
                                <div class="hh-position-toggle" style="margin-bottom: 0;">
                                    <div class="hh-toggle-btn" id="hh-winner-btn-hero" onclick="hhSetWinner('hero')">Hero</div>
                                    <div class="hh-toggle-btn" id="hh-winner-btn-villain" onclick="hhSetWinner('villain')">Villain</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Hand Notes (outside results card) -->
                        <div id="hh-notes-section" style="display: none; margin-top: 12px;">
                            <label style="display: block; font-size: 11px; font-weight: 600; color: #8a8e96; margin-bottom: 4px;">Notes:</label>
                            <textarea id="hh-hand-notes" placeholder="Notes about this hand..." rows="2" style="width: 100%; padding: 8px; background: #2a2d35; border: 1px solid #3a3d45; border-radius: 4px; color: #e0e4e8; font-family: 'Inter', sans-serif; font-size: 0.875rem; resize: vertical;"></textarea>
                        </div>
                        
                        <!-- Hand Navigation (outside results card) -->
                        <div id="hh-navigation-section" style="display: none; margin-top: 12px;">
                            <div style="display: flex; gap: 8px; align-items: stretch;">
                                <button class="hh-new-hand-btn" onclick="hhNextHandDifferentPlayers()" style="flex: 1; padding: 0.75rem; background: linear-gradient(135deg, #d8dde5 0%, #c8ccd4 50%, #b8bdc5 100%); border: 2px solid #a8acb4; border-radius: 6px; font-weight: 700; color: #2a2d35; cursor: pointer; display: flex; flex-direction: column; align-items: center; line-height: 1.2; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2), inset 0 1px 2px rgba(255, 255, 255, 0.4);">
                                    <span style="font-size: 0.875rem;">New Hand</span>
                                    <span style="font-size: 0.75rem; font-weight: 600;">Different Players</span>
                                </button>
                                <button class="hh-nav-btn" onclick="hhPreviousHand()" style="padding: 0.75rem 1rem; background: linear-gradient(135deg, #d8dde5 0%, #c8ccd4 50%, #b8bdc5 100%); border: 2px solid #a8acb4; border-radius: 6px; font-weight: 700; color: #5a5e66; cursor: pointer; font-size: 1.25rem; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2), inset 0 1px 2px rgba(255, 255, 255, 0.4);">‹</button>
                                <button class="hh-nav-btn" onclick="hhNextStoredHand()" style="padding: 0.75rem 1rem; background: linear-gradient(135deg, #d8dde5 0%, #c8ccd4 50%, #b8bdc5 100%); border: 2px solid #a8acb4; border-radius: 6px; font-weight: 700; color: #5a5e66; cursor: pointer; font-size: 1.25rem; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2), inset 0 1px 2px rgba(255, 255, 255, 0.4);">›</button>
                                <button class="hh-new-hand-btn" onclick="hhNextHand()" style="flex: 1; padding: 0.75rem; background: linear-gradient(135deg, #b794f6 0%, #9370db 100%); border: 2px solid #7b5fc9; border-radius: 6px; font-weight: 700; color: #ffffff; cursor: pointer; display: flex; flex-direction: column; align-items: center; line-height: 1.2; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2), inset 0 1px 2px rgba(255, 255, 255, 0.4);">
                                    <span style="font-size: 0.875rem;">New Hand</span>
                                    <span style="font-size: 0.75rem; font-weight: 600;">Same Players</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>



                <!-- Note Entry -->
                <div class="form-subsection" style="display: none;">
                    <h4 class="form-subsection-header">Add Note</h4>
                    <div class="note-entry">
                        <textarea id="session-note-input" placeholder="What just happened..." rows="2"></textarea>
                        <button class="btn-metallic btn-add-note" onclick="addSessionNote()" title="Add Note">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Notes Feed -->
                <div class="form-subsection" id="session-notes-section" style="display:none;">
                    <h4 class="form-subsection-header">Session Notes</h4>
                    <div class="session-notes-feed" id="session-notes-feed"></div>
                </div>
            </div>
            <div style="display: flex; justify-content: center; margin: 2rem 0 1rem;">
                <button type="button" class="btn-metallic btn-home" onclick="switchTab('dashboard')" title="Return to Dashboard">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Database structure
        let database = {
            archetypes: [],
            realPlayers: []
        };

        // Load from localStorage or use default
        function loadDatabase() {
            const saved = localStorage.getItem('pokerDatabase');
            if (saved) {
                database = JSON.parse(saved);
            } else {
                // Initialize with player list - all attributes default to 0
                const playerNames = [
                    "Aditya Pailla", "Allen Chapman", "Arlo Strozewski", "Ash Gandhi", "Becky Anderson",
                    "Bee Yang", "Bob Tumlinson", "Bob Van Sykle", "Brian Granger", "Carson Mair",
                    "Chandra Kontham", "Charles Lewis", "Charles Wiggins", "Chogyal Tenzin", "Cody Torke",
                    "Curtis Koenig", "Curtis Vierstrate", "Dad Daughter", "Dallas Schmidt", "Dan Kennedy",
                    "Daniel Hutchinson", "Darshan Pathak", "Dhruva Kota", "E", "Erik Elkema",
                    "Gene Boyer", "Hank Blissenblak", "Jason Alexander", "Jason Sell", "Jeff Petronak",
                    "Jeremy Calvelry", "Jerric Jiang", "John Reading", "Jon Kim", "Jos Osterbaur Jr.",
                    "Jos Osterbaur Sr.", "Joseph Casey Pothead", "Kanat Ozturk", "Kevin Kelly", "Kou Vang",
                    "Leo Fussy", "Leo Pinomonti", "Libby", "Louie Hillman", "Lucas Martin",
                    "Luke Struck", "Mason Redberg-Berg", "Matt Alexander", "Matt Fox", "Mike Wang",
                    "Mike Wilklow", "Moon", "Nghia Lee", "Paul Cross", "Paul Eiden",
                    "Phil Nesburg", "Rich Alsup", "Rob Wazwaz", "Rodney Colson", "Ross \"RF\"",
                    "Sam B", "Santoshima Narayan", "Sean Hinton", "Shafat Zaman", "Sitaram",
                    "Steve Belland", "Steve Wazwaz", "Steven Shanks", "Tanner Pray", "Thai Van Dinh",
                    "Tim Votva", "Tyreese Robinson", "Umut Ozturk", "Vic Peppe", "Vijay Yadav",
                    "Wes Cannon"
                ];

                // Create player objects with all attributes set to 0
                const players = playerNames.map(name => ({
                    name: name,
                    observations: null,
                    vpip: 0,
                    pfrAggression: 0,
                    fold3bet: 0,
                    coldcall: 0,
                    postflopAggression: 0,
                    foldcbet: 0,
                    tableTalk: 0,
                    attention: 0,
                    style: 0,
                    cunning: 0,
                    thinking: 0,
                    stackProtection: 0,
                    skillLevel: 0
                }));

                // Load default database with players
                database = {
                    archetypes: [{
                        id: 'scared-money',
                        name: 'Scared Money',
                        description: 'Risk-averse player terrified of losing chips',
                        playStyle: {
                            preflop: { vpip: 'Low (<25%)', pfr: 'Low (<25%)' }
                        },
                        exploits: {
                            preflop: ['Steal blinds relentlessly - they fold 90%+', '3-bet their rare raises for fold equity'],
                            warnings: ['If they limp then call a raise - trap with premium hand', 'If they lead out betting - strong hand']
                        }
                    }],
                    realPlayers: players
                };
                
                // Save to localStorage
                saveDatabase();
            }
            updateAllViews();
        }

        function saveDatabase() {
            // Sort players alphabetically by name before saving
            database.realPlayers.sort((a, b) => a.name.localeCompare(b.name));
            localStorage.setItem('pokerDatabase', JSON.stringify(database));
            updateAllViews();
        }

        // Toggle switch status updates
        document.querySelectorAll('.toggle-switch input[type="checkbox"]').forEach(toggle => {
            toggle.addEventListener('change', function() {
                const status = this.closest('.toggle-container').querySelector('.toggle-status');
                if (status) {
                    status.textContent = this.checked ? 'Yes' : 'No';
                }
            });
            
            // Set initial state
            const status = toggle.closest('.toggle-container').querySelector('.toggle-status');
            if (status) {
                status.textContent = toggle.checked ? 'Yes' : 'No';
            }
        });

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            if (event && event.target) {
                event.target.classList.add('active');
            }
            document.getElementById(tabName).classList.add('active');
            
            updateAllViews();
        }

        // Update all views
        function updateAllViews() {
            updateDashboard();
            updateArchetypeList();
            updatePlayerList();
            updatePlayerArchetypeDropdown();
            updateBriefPlayerSelection();
            updateJsonDisplay();
        }

        // Dashboard
        function updateDashboard() {
            // Dashboard now shows buttons only, no stats to update
        }

        // Archetypes
        let currentArchetypeId = null;

        function updateArchetypeList() {
            const list = document.getElementById('archetype-list');
            const html = database.archetypes.map(arch => `
                <div class="list-item" onclick="editArchetype('${arch.id}')">
                    <div class="list-item-header">
                        <div class="list-item-title">${arch.name}</div>
                        <div class="list-item-meta">VPIP: ${arch.playStyle.preflop.vpip} | PFR: ${arch.playStyle.preflop.pfr}</div>
                    </div>
                    <div class="list-item-meta">${arch.description || ''}</div>
                </div>
            `).join('');
            list.innerHTML = html || '<p style="opacity: 0.5;">No archetypes yet</p>';
        }

        function filterArchetypes() {
            const search = document.getElementById('archetype-search').value.toLowerCase();
            const items = document.querySelectorAll('#archetype-list .list-item');
            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                item.style.display = text.includes(search) ? '' : 'none';
            });
        }

        function showArchetypeForm() {
            currentArchetypeId = null;
            document.getElementById('archetype-form-section').style.display = 'block';
            document.getElementById('archetype-form-title').textContent = 'New Archetype';
            document.getElementById('archetype-form').reset();
            document.getElementById('delete-archetype-btn').style.display = 'none';
        }

        function hideArchetypeForm() {
            document.getElementById('archetype-form-section').style.display = 'none';
            currentArchetypeId = null;
        }

        function editArchetype(id) {
            const arch = database.archetypes.find(a => a.id === id);
            if (!arch) return;
            
            currentArchetypeId = id;
            document.getElementById('archetype-form-section').style.display = 'block';
            document.getElementById('archetype-form-title').textContent = 'Edit Archetype';
            document.getElementById('delete-archetype-btn').style.display = 'inline-block';
            
            document.getElementById('arch-name').value = arch.name;
            document.getElementById('arch-description').value = arch.description || '';
            document.getElementById('arch-vpip').value = arch.playStyle.preflop.vpip;
            document.getElementById('arch-pfr').value = arch.playStyle.preflop.pfr;
            document.getElementById('arch-exploits').value = arch.exploits.preflop.join('\n');
            document.getElementById('arch-warnings').value = arch.exploits.warnings.join('\n');
        }

        function deleteArchetype() {
            if (!confirm('Delete this archetype?')) return;
            database.archetypes = database.archetypes.filter(a => a.id !== currentArchetypeId);
            saveDatabase();
            hideArchetypeForm();
        }

        document.getElementById('archetype-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('arch-name').value;
            const id = currentArchetypeId || name.toLowerCase().replace(/\s+/g, '-');
            
            const archetype = {
                id: id,
                name: name,
                description: document.getElementById('arch-description').value,
                playStyle: {
                    preflop: {
                        vpip: document.getElementById('arch-vpip').value,
                        pfr: document.getElementById('arch-pfr').value
                    }
                },
                exploits: {
                    preflop: document.getElementById('arch-exploits').value.split('\n').filter(x => x.trim()),
                    warnings: document.getElementById('arch-warnings').value.split('\n').filter(x => x.trim())
                }
            };
            
            if (currentArchetypeId) {
                const index = database.archetypes.findIndex(a => a.id === currentArchetypeId);
                database.archetypes[index] = archetype;
            } else {
                database.archetypes.push(archetype);
            }
            
            saveDatabase();
            hideArchetypeForm();
        });

        // Full Archetype Builder Form
        document.getElementById('full-archetype-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('builder-name').value;
            const id = name.toLowerCase().replace(/\s+/g, '-');
            
            const archetype = {
                id: id,
                name: name,
                description: document.getElementById('builder-description').value,
                playStyle: {
                    preflop: {
                        openingRange: document.querySelector('input[name="opening-range"]:checked').value,
                        vpip: document.querySelector('input[name="vpip"]:checked').value,
                        pfr: document.querySelector('input[name="pfr"]:checked').value,
                        threeBet: document.querySelector('input[name="3bet"]:checked').value,
                        foldTo3Bet: document.querySelector('input[name="fold3bet"]:checked').value,
                        coldCall: document.querySelector('input[name="coldcall"]:checked').value
                    },
                    postflop: {
                        aggressionFrequency: document.querySelector('input[name="aggression"]:checked').value,
                        foldToCBet: document.querySelector('input[name="foldcbet"]:checked').value,
                        bluffFrequency: document.querySelector('input[name="bluff"]:checked').value
                    },
                    overallStyle: {
                        chasesDraws: document.getElementById('builder-chases-draws').checked,
                        anyTwoCards: document.getElementById('builder-any-two').checked,
                        lovesFaces: document.getElementById('builder-loves-faces').checked,
                        cheapRiver: document.getElementById('builder-cheap-river').checked,
                        limpJam: document.getElementById('builder-limp-jam').checked,
                        noRiver: document.getElementById('builder-no-river').checked
                    }
                },
                personality: {
                    psychological: {
                        tiltProne: document.getElementById('builder-tilt-prone').checked,
                        scaredMoney: document.getElementById('builder-scared-money').checked,
                        egoDriven: document.getElementById('builder-ego-driven').checked,
                        resultOriented: document.getElementById('builder-result-oriented').checked,
                        reckless: document.getElementById('builder-reckless').checked
                    },
                    tableDynamics: {
                        tableTalk: document.querySelector('input[name="table-talk"]:checked').value,
                        attention: document.querySelector('input[name="attention"]:checked').value
                    },
                    stackProtection: {
                        early: document.querySelector('input[name="stack-early"]:checked').value,
                        middle: document.querySelector('input[name="stack-middle"]:checked').value,
                        bubble: document.querySelector('input[name="stack-bubble"]:checked').value,
                        late: document.querySelector('input[name="stack-late"]:checked').value
                    },
                    skillIndicators: {
                        handReading: document.querySelector('input[name="hand-reading"]:checked').value,
                        gtoAwareness: document.querySelector('input[name="gto"]:checked').value,
                        exploitability: document.querySelector('input[name="exploitability"]:checked').value
                    }
                },
                exploits: {
                    preflop: document.getElementById('builder-exploits-preflop').value.split('\n').filter(x => x.trim()),
                    postflop: document.getElementById('builder-exploits-postflop').value.split('\n').filter(x => x.trim()),
                    bubble: document.getElementById('builder-exploits-bubble').value.split('\n').filter(x => x.trim()),
                    warnings: document.getElementById('builder-warnings').value.split('\n').filter(x => x.trim())
                },
                notes: document.getElementById('builder-notes').value || null
            };
            
            database.archetypes.push(archetype);
            saveDatabase();
            
            alert('Archetype saved! View in Archetypes tab.');
            resetBuilderForm();
        });

        function resetBuilderForm() {
            document.getElementById('full-archetype-form').reset();
        }

        // Players
        let currentPlayerName = null;

        // === DRUM PICKER ENGINE ===
        const DRUM = {
            ITEM_H: 44,          // must match CSS .apple-picker-item height
            offset: 0,           // current scroll offset in px
            velocity: 0,
            friction: 0.92,
            isDragging: false,
            dragStarted: false,
            lastY: 0,
            lastTime: 0,
            animFrame: null,
            items: [],
            selectedIndex: 0,
            container: null,
            cylinder: null,
            containerH: 260,
        };

        function updatePlayerList() {
            DRUM.cylinder = document.getElementById('player-picker');
            DRUM.container = document.getElementById('drum-container');
            const sorted = [...database.realPlayers].sort((a, b) => a.name.localeCompare(b.name));
            DRUM.items = sorted;

            // Measure container
            DRUM.containerH = DRUM.container.offsetHeight || 260;

            // Restore last position: saved offset > localStorage player > 0
            if (DRUM._savedOffset !== undefined) {
                DRUM.offset = DRUM._savedOffset;
            } else {
                const lastPlayer = localStorage.getItem('nitwiz_lastPlayer');
                if (lastPlayer && DRUM.items.length > 0) {
                    const idx = DRUM.items.findIndex(p => p.name === lastPlayer);
                    if (idx >= 0) {
                        DRUM.offset = -idx * DRUM.ITEM_H;
                    } else {
                        DRUM.offset = 0;
                    }
                } else {
                    DRUM.offset = 0;
                }
            }

            renderDrumItems();
            bindDrumEvents();

            // Auto-load the currently selected player's profile
            if (DRUM.items.length > 0 && !DRUM._addingNew) {
                const n = DRUM.items.length;
                const centerIdx = Math.round(-DRUM.offset / DRUM.ITEM_H);
                const wrappedIdx = wrapIndex(centerIdx, n);
                const player = DRUM.items[wrappedIdx];
                if (player) {
                    editPlayer(player.name);
                }
            }
        }

        // How many items to render above/below center for visibility
        const DRUM_RENDER_BUFFER = 6;

        function wrapIndex(i, len) {
            return ((i % len) + len) % len;
        }

        function renderDrumItems() {
            const n = DRUM.items.length;
            if (n === 0 || DRUM._editing || DRUM._addingNew) {
                return;
            }

            // Which logical index is at center?
            const centerFloat = -DRUM.offset / DRUM.ITEM_H;
            const centerIdx = Math.round(centerFloat);
            DRUM.selectedIndex = wrapIndex(centerIdx, n);

            const centerY = DRUM.containerH / 2 - DRUM.ITEM_H / 2;

            let html = '';
            for (let delta = -DRUM_RENDER_BUFFER; delta <= DRUM_RENDER_BUFFER; delta++) {
                const logicalIdx = centerIdx + delta;
                const wrappedIdx = wrapIndex(logicalIdx, n);
                const player = DRUM.items[wrappedIdx];

                // Y position: how far from center in px
                const itemY = centerY + (logicalIdx * DRUM.ITEM_H + DRUM.offset);
                const isSelected = delta === 0 || (Math.abs(centerFloat - centerIdx) < 0.01 && delta === 0);
                const sel = wrappedIdx === DRUM.selectedIndex ? ' selected' : '';

                html += `<div class="apple-picker-item${sel}" data-name="${player.name}" data-index="${wrappedIdx}" data-logical="${logicalIdx}" style="position:absolute;top:0;left:0;width:100%;transform:translateY(${itemY}px)">${player.name}</div>`;
            }

            DRUM.cylinder.innerHTML = html;
        }

        function getSnappedOffset(logicalIndex) {
            return -logicalIndex * DRUM.ITEM_H;
        }

        // No clamping — infinite scroll
        function clampOffset(off) {
            return off;
        }

        function hardClampOffset(off) {
            return off;
        }

        function positionDrum() {
            // Not used for positioning anymore — renderDrumItems handles it
            // But keep for compat, just re-render
            renderDrumItems();
        }

        function updateDrumSelection() {
            // Handled inside renderDrumItems
        }

        function snapToIndex(logicalIndex) {
            cancelAnimationFrame(DRUM.animFrame);
            const target = getSnappedOffset(logicalIndex);
            animateSnap(target, () => {
                DRUM._savedOffset = DRUM.offset;
                const n = DRUM.items.length;
                const wrappedIdx = wrapIndex(logicalIndex, n);
                const player = DRUM.items[wrappedIdx];
                if (player) editPlayer(player.name);
            });
        }

        // Snap to nearest logical index from current offset
        function snapToNearest() {
            const n = DRUM.items.length;
            if (n === 0) return;
            const logicalIdx = Math.round(-DRUM.offset / DRUM.ITEM_H);
            snapToIndex(logicalIdx);
        }

        function animateSnap(target, callback) {
            const step = () => {
                const diff = target - DRUM.offset;
                if (Math.abs(diff) < 0.5) {
                    DRUM.offset = target;
                    renderDrumItems();
                    if (callback) callback();
                    return;
                }
                DRUM.offset += diff * 0.18;
                renderDrumItems();
                DRUM.animFrame = requestAnimationFrame(step);
            };
            DRUM.animFrame = requestAnimationFrame(step);
        }

        function momentumScroll() {
            if (DRUM.isDragging) return;

            DRUM.velocity *= DRUM.friction;
            DRUM.offset += DRUM.velocity;
            renderDrumItems();

            if (Math.abs(DRUM.velocity) > 0.5) {
                DRUM.animFrame = requestAnimationFrame(momentumScroll);
            } else {
                DRUM.velocity = 0;
                snapToNearest();
            }
        }

        function bindDrumEvents() {
            const overlay = document.getElementById('drum-touch-overlay');

            if (DRUM._bound) return;
            DRUM._bound = true;

            function onDown(clientY) {
                cancelAnimationFrame(DRUM.animFrame);
                DRUM.isDragging = true;
                DRUM.dragStarted = false;
                DRUM.velocity = 0;
                DRUM.lastY = clientY;
                DRUM.lastTime = Date.now();
                DRUM._velocityHistory = [];
            }

            function onMove(clientY) {
                if (!DRUM.isDragging) return;
                const now = Date.now();
                const dy = clientY - DRUM.lastY;
                const dt = Math.max(1, now - DRUM.lastTime);

                if (Math.abs(dy) > 2) DRUM.dragStarted = true;

                DRUM.offset += dy;

                const v = dy * (16 / dt);
                DRUM._velocityHistory.push({ v, t: now });
                DRUM._velocityHistory = DRUM._velocityHistory.filter(s => now - s.t < 100);

                DRUM.lastY = clientY;
                DRUM.lastTime = now;
                renderDrumItems();
            }

            function onUp() {
                if (!DRUM.isDragging) return;
                DRUM.isDragging = false;

                const history = DRUM._velocityHistory || [];
                if (history.length > 0) {
                    const avgV = history.reduce((sum, s) => sum + s.v, 0) / history.length;
                    DRUM.velocity = Math.max(-25, Math.min(25, avgV));
                } else {
                    DRUM.velocity = 0;
                }

                if (Math.abs(DRUM.velocity) < 1) {
                    DRUM.velocity = 0;
                    snapToNearest();
                } else {
                    momentumScroll();
                }
            }

            // Touch — all events on the overlay, nothing can interfere
            overlay.addEventListener('touchstart', (e) => {
                e.preventDefault();
                onDown(e.touches[0].clientY);
            }, { passive: false });

            overlay.addEventListener('touchmove', (e) => {
                e.preventDefault();
                onMove(e.touches[0].clientY);
            }, { passive: false });

            overlay.addEventListener('touchend', (e) => {
                e.preventDefault();
                onUp();
            }, { passive: false });

            overlay.addEventListener('touchcancel', onUp);

            // Mouse — down on overlay, move/up on window
            overlay.addEventListener('mousedown', (e) => { e.preventDefault(); onDown(e.clientY); });
            window.addEventListener('mousemove', (e) => { if (DRUM.isDragging) { e.preventDefault(); onMove(e.clientY); }});
            window.addEventListener('mouseup', onUp);

            // Mouse wheel
            overlay.addEventListener('wheel', (e) => {
                e.preventDefault();
                cancelAnimationFrame(DRUM.animFrame);
                const dir = e.deltaY > 0 ? 1 : -1;
                const logicalIdx = Math.round(-DRUM.offset / DRUM.ITEM_H) + dir;
                snapToIndex(logicalIdx);
            }, { passive: false });
        }

        // === INLINE NAME EDITING ===
        function startDrumInlineEdit(item, index) {
            // Don't start if already editing
            if (DRUM._editing) return;
            DRUM._editing = true;

            const player = DRUM.items[index];
            if (!player) { DRUM._editing = false; return; }
            const oldName = player.name;

            // Create input that replaces the item text
            const input = document.createElement('input');
            input.type = 'text';
            input.value = oldName;
            input.className = 'drum-inline-edit';
            input.setAttribute('autocomplete', 'off');
            input.setAttribute('autocorrect', 'off');
            input.setAttribute('spellcheck', 'false');

            // Clear item text content and insert input
            item.textContent = '';
            item.appendChild(input);
            item.classList.add('editing');

            // Focus and select all
            input.focus();
            input.select();

            // Prevent drum drag while editing
            input.addEventListener('mousedown', (e) => e.stopPropagation());
            input.addEventListener('touchstart', (e) => e.stopPropagation());

            let committed = false;

            function commitEdit() {
                if (committed) return;
                committed = true;

                const newName = input.value.trim();
                if (!newName || newName === oldName) {
                    cancelEdit();
                    return;
                }

                // Check for duplicate names
                const duplicate = database.realPlayers.find(p => p.name === newName && p.name !== oldName);
                if (duplicate) {
                    committed = false; // allow retry
                    alert('A player with that name already exists.');
                    input.focus();
                    input.select();
                    return;
                }

                // Update in database
                const dbPlayer = database.realPlayers.find(p => p.name === oldName);
                if (dbPlayer) {
                    dbPlayer.name = newName;
                    if (currentPlayerName === oldName) {
                        currentPlayerName = newName;
                        document.getElementById('player-form-title').textContent = newName;
                        document.getElementById('player-name').value = newName;
                    }
                    saveDatabase();
                }

                // Rebuild drum with new sorted order
                DRUM._editing = false;
                // Find the new index position
                const sorted = [...database.realPlayers].sort((a, b) => a.name.localeCompare(b.name));
                const newIdx = sorted.findIndex(p => p.name === newName);
                DRUM._savedOffset = -(newIdx >= 0 ? newIdx : 0) * DRUM.ITEM_H;
                updatePlayerList();
            }

            function cancelEdit() {
                DRUM._editing = false;
                // Re-render to restore
                renderDrumItems();
            }

            // Save on Enter, cancel on Escape
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    commitEdit();
                } else if (e.key === 'Escape') {
                    e.preventDefault();
                    cancelEdit();
                }
            });

            // Save on blur
            input.addEventListener('blur', () => {
                setTimeout(() => {
                    if (!committed) commitEdit();
                }, 50);
            });
        }

        function initApplePicker() {
            // Now handled by updatePlayerList + bindDrumEvents
        }

        function selectPlayerFromDropdown() {
            // Legacy function - no longer needed but keeping for compatibility
        }

        function filterPlayers() {
            // No longer needed with picker, but keeping for compatibility
        }

        function updatePlayerArchetypeDropdown() {
            // No longer needed since we removed archetype dropdown
        }

        function showPlayerForm() {
            // Hide any open form first
            document.getElementById('player-form-section').style.display = 'none';
            currentPlayerName = null;

            // Scroll to top of Players tab
            const playersTab = document.getElementById('players');
            playersTab.scrollTo({ top: 0, behavior: 'smooth' });

            // Don't start if already adding
            if (DRUM.cylinder.querySelector('.drum-new-input')) return;

            // Clear the drum and show a single input item centered
            cancelAnimationFrame(DRUM.animFrame);
            DRUM._addingNew = true;

            const centerY = DRUM.containerH / 2 - DRUM.ITEM_H / 2;
            DRUM.cylinder.innerHTML = `<div class="apple-picker-item selected editing" style="position:absolute;top:0;left:0;width:100%;transform:translateY(${centerY}px)"><input type="text" class="drum-inline-edit drum-new-input" placeholder="Enter player name..." autocomplete="off" autocorrect="off" spellcheck="false" /></div>`;

            const input = DRUM.cylinder.querySelector('.drum-new-input');
            setTimeout(() => input.focus(), 150);

            // Prevent drum drag while typing
            input.addEventListener('mousedown', (e) => e.stopPropagation());
            input.addEventListener('touchstart', (e) => e.stopPropagation());

            function commitNewPlayer() {
                const name = input.value.trim();
                if (!name) {
                    cancelNewPlayer();
                    return;
                }

                const duplicate = database.realPlayers.find(p => p.name === name);
                if (duplicate) {
                    alert('A player with that name already exists.');
                    input.focus();
                    input.select();
                    return;
                }

                const newPlayer = {
                    name: name,
                    observationsList: [],
                    weaknesses: [],
                    vpip: 0,
                    pfrAggression: 0,
                    fold3bet: 0,
                    coldcall: 0,
                    postflopAggression: 0,
                    foldcbet: 0,
                    tableTalk: 0,
                    attention: 0,
                    style: 0,
                    cunning: 0,
                    thinking: 0,
                    stackProtection: 0,
                    skillLevel: 0,
                    gender: 0,
                    age: 0,
                    ethnicity: 0,
                    education: 0,
                    profession: 0
                };

                database.realPlayers.push(newPlayer);
                saveDatabase();

                DRUM._addingNew = false;

                // Rebuild and find the new player
                const sorted = [...database.realPlayers].sort((a, b) => a.name.localeCompare(b.name));
                const newIndex = sorted.findIndex(p => p.name === name);
                DRUM._savedOffset = -(newIndex >= 0 ? newIndex : 0) * DRUM.ITEM_H;

                updatePlayerList();
                editPlayer(name);
            }

            function cancelNewPlayer() {
                DRUM._addingNew = false;
                // Restore the drum
                renderDrumItems();
            }

            let committed = false;

            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    committed = true;
                    commitNewPlayer();
                } else if (e.key === 'Escape') {
                    e.preventDefault();
                    committed = true;
                    cancelNewPlayer();
                }
            });

            input.addEventListener('blur', () => {
                setTimeout(() => {
                    if (!committed) {
                        const name = input.value.trim();
                        if (name) {
                            committed = true;
                            commitNewPlayer();
                        } else {
                            committed = true;
                            cancelNewPlayer();
                        }
                    }
                }, 100);
            });
        }

        function hidePlayerForm() {
            document.getElementById('player-form-section').style.display = 'none';
            currentPlayerName = null;
        }

        function editPlayer(name) {
            const player = database.realPlayers.find(p => p.name === name);
            if (!player) return;
            
            currentPlayerName = name;
            localStorage.setItem('nitwiz_lastPlayer', name);
            document.getElementById('player-form-section').style.display = 'block';
            document.getElementById('player-form-title').textContent = name;
            document.getElementById('delete-player-btn').style.display = 'inline-block';
            
            document.getElementById('player-name').value = player.name;
            
            // Load all slider values
            document.getElementById('player-vpip').value = player.vpip || 0;
            document.getElementById('player-pfr-aggression').value = player.pfrAggression || 0;
            document.getElementById('player-fold3bet').value = player.fold3bet || 0;
            document.getElementById('player-coldcall').value = player.coldcall || 0;
            document.getElementById('player-postflop-aggression').value = player.postflopAggression || 0;
            document.getElementById('player-foldcbet').value = player.foldcbet || 0;
            document.getElementById('player-table-talk').value = player.tableTalk || 0;
            document.getElementById('player-attention').value = player.attention || 0;
            document.getElementById('player-style').value = player.style || 0;
            document.getElementById('player-cunning').value = player.cunning || 0;
            document.getElementById('player-thinking').value = player.thinking || 0;
            document.getElementById('player-stack-protection').value = player.stackProtection || 0;
            document.getElementById('player-skill-level').value = player.skillLevel || 0;
            
            // Load weaknesses
            renderWeaknessPlates(player.weaknesses || []);

            // Load observations — support old string format migration
            let obsList = player.observationsList || [];
            if (obsList.length === 0 && player.observations) {
                obsList = player.observations.split('\n').filter(x => x.trim());
            }
            renderObservationPlates(obsList);

            // Load description chips
            setDescChip('player-gender', player.gender || 0);
            setDescChip('player-age', player.age || 0);
            setDescChip('player-ethnicity', player.ethnicity || 0);
            setDescChip('player-education', player.education || 0);
            setDescChip('player-profession', player.profession || 0);

            // Update slider label highlighting
            updatePlayerSliders();
        }

        // === INLINE NAME EDITING ON CARD TITLE ===
        (function initNameEditing() {
            const titleEl = document.getElementById('player-form-title');
            let longPressTimer = null;
            let isEditing = false;

            function startNameEdit() {
                if (isEditing || !currentPlayerName) return;
                isEditing = true;

                const oldName = currentPlayerName;
                const input = document.createElement('input');
                input.type = 'text';
                input.value = oldName;
                input.className = 'card-name-edit-input';
                input.setAttribute('autocomplete', 'off');
                input.setAttribute('autocorrect', 'off');
                input.setAttribute('spellcheck', 'false');

                titleEl.textContent = '';
                titleEl.appendChild(input);
                input.focus();
                input.select();

                function commit() {
                    if (!isEditing) return;
                    isEditing = false;
                    const newName = input.value.trim();

                    if (newName && newName !== oldName) {
                        // Check for duplicate
                        const exists = database.realPlayers.some(p => p.name === newName);
                        if (exists) {
                            titleEl.textContent = oldName;
                            return;
                        }
                        // Rename in database
                        const player = database.realPlayers.find(p => p.name === oldName);
                        if (player) {
                            player.name = newName;
                            currentPlayerName = newName;
                            localStorage.setItem('nitwiz_lastPlayer', newName);
                            titleEl.textContent = newName;
                            document.getElementById('player-name').value = newName;
                            saveDatabase();
                        } else {
                            titleEl.textContent = oldName;
                        }
                    } else {
                        titleEl.textContent = oldName;
                    }
                }

                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') { e.preventDefault(); input.blur(); }
                    if (e.key === 'Escape') { e.preventDefault(); isEditing = false; titleEl.textContent = oldName; }
                });
                input.addEventListener('blur', () => setTimeout(commit, 50));
            }

            // Double-click
            titleEl.addEventListener('dblclick', (e) => {
                e.preventDefault();
                startNameEdit();
            });

            // Long press (mobile)
            titleEl.addEventListener('touchstart', (e) => {
                longPressTimer = setTimeout(() => {
                    e.preventDefault();
                    startNameEdit();
                }, 500);
            }, { passive: false });

            titleEl.addEventListener('touchend', () => clearTimeout(longPressTimer));
            titleEl.addEventListener('touchmove', () => clearTimeout(longPressTimer));
            titleEl.addEventListener('touchcancel', () => clearTimeout(longPressTimer));
        })();

        // === KEY WEAKNESSES & OBSERVATIONS (Notecard System) ===
        let _weaknessData = [];
        let _observationData = [];
        let _editMode = { weakness: false, observation: false };

        function getWeaknessesFromUI() { return [..._weaknessData]; }
        function getObservationsFromUI() { return [..._observationData]; }

        function renderNotecard(type) {
            const data = type === 'weakness' ? _weaknessData : _observationData;
            const container = document.getElementById(type === 'weakness' ? 'player-weakness-list' : 'player-observation-list');
            const isEditing = _editMode[type];

            if (data.length === 0 && !isEditing) {
                container.innerHTML = '<div class="notecard-empty">None recorded</div>';
            } else {
                container.innerHTML = data.map((item, i) => `
                    <div class="notecard-entry" data-index="${i}">
                        <span class="notecard-entry-text">${item}</span>
                        <button type="button" class="notecard-entry-delete" onclick="removeNotecardItem('${type}', ${i})" title="Remove">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                        </button>
                    </div>
                `).join('');
            }

            container.classList.toggle('editing', isEditing);

            // In edit mode, make entries clickable to edit text
            if (isEditing) {
                container.querySelectorAll('.notecard-entry').forEach(entry => {
                    entry.querySelector('.notecard-entry-text').addEventListener('click', () => {
                        startInlineEdit(type, entry);
                    });
                    entry.querySelector('.notecard-entry-text').style.cursor = 'pointer';
                });
            }
        }

        function startInlineEdit(type, entryEl) {
            const data = type === 'weakness' ? _weaknessData : _observationData;
            const index = parseInt(entryEl.dataset.index);
            const textEl = entryEl.querySelector('.notecard-entry-text');
            const oldText = data[index];

            // Replace text with input
            const input = document.createElement('input');
            input.type = 'text';
            input.value = oldText;
            input.className = 'notecard-inline-input';
            input.setAttribute('autocomplete', 'off');

            textEl.style.display = 'none';
            entryEl.insertBefore(input, textEl);
            input.focus();
            input.select();

            let committed = false;

            function commit() {
                if (committed) return;
                committed = true;
                const val = input.value.trim();
                if (val && val !== oldText) {
                    data[index] = val;
                    if (type === 'weakness') saveWeaknessesToPlayer(data);
                    else saveObservationsToPlayer(data);
                }
                renderNotecard(type);
            }

            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') { e.preventDefault(); commit(); }
                else if (e.key === 'Escape') { e.preventDefault(); committed = true; renderNotecard(type); }
            });
            input.addEventListener('blur', () => setTimeout(commit, 80));
        }

        function addInlineEntry(type) {
            const container = document.getElementById(type === 'weakness' ? 'player-weakness-list' : 'player-observation-list');
            if (container.querySelector('.notecard-inline-input')) return;

            // Remove "None recorded" if present
            const empty = container.querySelector('.notecard-empty');
            if (empty) empty.remove();

            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'notecard-inline-input';
            input.placeholder = type === 'weakness' ? 'Add weakness...' : 'Add observation...';
            input.setAttribute('autocomplete', 'off');
            container.appendChild(input);
            input.focus();

            let committed = false;

            function commit() {
                if (committed) return;
                committed = true;
                const val = input.value.trim();
                if (val) {
                    if (type === 'weakness') { _weaknessData.push(val); saveWeaknessesToPlayer(_weaknessData); }
                    else { _observationData.push(val); saveObservationsToPlayer(_observationData); }
                }
                renderNotecard(type);
            }

            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') { e.preventDefault(); commit(); }
                else if (e.key === 'Escape') { e.preventDefault(); committed = true; renderNotecard(type); }
            });
            input.addEventListener('blur', () => setTimeout(commit, 80));
        }

        function removeNotecardItem(type, index) {
            if (type === 'weakness') { _weaknessData.splice(index, 1); saveWeaknessesToPlayer(_weaknessData); }
            else { _observationData.splice(index, 1); saveObservationsToPlayer(_observationData); }
            renderNotecard(type);
        }

        function renderWeaknessPlates(weaknesses) {
            _weaknessData = weaknesses || [];
            _editMode.weakness = false;
            document.getElementById('weakness-edit-btn').classList.remove('active');
            renderNotecard('weakness');
        }

        function renderObservationPlates(observations) {
            _observationData = observations || [];
            _editMode.observation = false;
            document.getElementById('observation-edit-btn').classList.remove('active');
            renderNotecard('observation');
        }

        function addWeakness(text) {
            const trimmed = text.trim();
            if (!trimmed) return;
            _weaknessData.push(trimmed);
            renderNotecard('weakness');
            saveWeaknessesToPlayer(_weaknessData);
        }

        function removeWeakness(index) { removeNotecardItem('weakness', index); }

        function addObservation(text) {
            const trimmed = text.trim();
            if (!trimmed) return;
            _observationData.push(trimmed);
            renderNotecard('observation');
            saveObservationsToPlayer(_observationData);
        }

        function removeObservation(index) { removeNotecardItem('observation', index); }

        function saveWeaknessesToPlayer(weaknesses) {
            if (!currentPlayerName) return;
            const player = database.realPlayers.find(p => p.name === currentPlayerName);
            if (player) { player.weaknesses = weaknesses; saveDatabase(); }
        }

        function saveObservationsToPlayer(observations) {
            if (!currentPlayerName) return;
            const player = database.realPlayers.find(p => p.name === currentPlayerName);
            if (player) { player.observationsList = observations; saveDatabase(); }
        }

        // Pen toggles edit mode (show × and make entries clickable to edit)
        function toggleNotecard(type) {
            _editMode[type] = !_editMode[type];
            document.getElementById(type + '-edit-btn').classList.toggle('active', _editMode[type]);
            renderNotecard(type);
        }

        document.getElementById('weakness-edit-btn').addEventListener('click', () => toggleNotecard('weakness'));
        document.getElementById('observation-edit-btn').addEventListener('click', () => toggleNotecard('observation'));
        document.getElementById('weakness-add-btn').addEventListener('click', () => addInlineEntry('weakness'));
        document.getElementById('observation-add-btn').addEventListener('click', () => addInlineEntry('observation'));

        // === DESCRIPTOR CHIPS ===
        // Wire up all chip selectors
        document.querySelectorAll('.desc-selector').forEach(selector => {
            selector.addEventListener('click', (e) => {
                const chip = e.target.closest('.desc-chip');
                if (!chip) return;
                // Deselect siblings
                selector.querySelectorAll('.desc-chip').forEach(c => c.classList.remove('active'));
                // Select this one
                chip.classList.add('active');
            });
        });

        function setDescChip(field, value) {
            const selector = document.querySelector(`.desc-selector[data-field="${field}"]`);
            if (!selector) return;
            selector.querySelectorAll('.desc-chip').forEach(c => {
                c.classList.toggle('active', parseInt(c.dataset.value) === value);
            });
        }

        function getDescChipValue(field) {
            const selector = document.querySelector(`.desc-selector[data-field="${field}"]`);
            if (!selector) return 0;
            const active = selector.querySelector('.desc-chip.active');
            return active ? parseInt(active.dataset.value) : 0;
        }

        function deletePlayer() {
            if (!confirm('Delete this player?')) return;
            database.realPlayers = database.realPlayers.filter(p => p.name !== currentPlayerName);
            currentPlayerName = null;
            saveDatabase();
            // updatePlayerList will auto-load whichever player is now at the drum center
        }

        document.getElementById('player-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('player-name').value;
            
            const player = {
                name: name,
                observationsList: getObservationsFromUI(),
                weaknesses: getWeaknessesFromUI(),
                vpip: parseInt(document.getElementById('player-vpip').value),
                pfrAggression: parseInt(document.getElementById('player-pfr-aggression').value),
                fold3bet: parseInt(document.getElementById('player-fold3bet').value),
                coldcall: parseInt(document.getElementById('player-coldcall').value),
                postflopAggression: parseInt(document.getElementById('player-postflop-aggression').value),
                foldcbet: parseInt(document.getElementById('player-foldcbet').value),
                tableTalk: parseInt(document.getElementById('player-table-talk').value),
                attention: parseInt(document.getElementById('player-attention').value),
                style: parseInt(document.getElementById('player-style').value),
                cunning: parseInt(document.getElementById('player-cunning').value),
                thinking: parseInt(document.getElementById('player-thinking').value),
                stackProtection: parseInt(document.getElementById('player-stack-protection').value),
                skillLevel: parseInt(document.getElementById('player-skill-level').value),
                gender: getDescChipValue('player-gender'),
                age: getDescChipValue('player-age'),
                ethnicity: getDescChipValue('player-ethnicity'),
                education: getDescChipValue('player-education'),
                profession: getDescChipValue('player-profession')
            };
            
            if (currentPlayerName) {
                const index = database.realPlayers.findIndex(p => p.name === currentPlayerName);
                database.realPlayers[index] = player;
            } else {
                database.realPlayers.push(player);
            }
            
            saveDatabase();
            // Stay on the saved player's profile — update drum to reflect any changes
            DRUM._savedOffset = DRUM.offset;
        });

        // Brief
        function updateBriefPlayerSelection() {
            const container = document.getElementById('brief-player-selection');
            const html = database.realPlayers.map(player => `
                <div class="checkbox-group">
                    <input type="checkbox" id="brief-${player.name}" value="${player.name}">
                    <label for="brief-${player.name}">${player.name}</label>
                </div>
            `).join('');
            container.innerHTML = html || '<p style="opacity: 0.5;">No players in database</p>';
        }

        function generateBrief() {
            const selected = Array.from(document.querySelectorAll('#brief-player-selection input:checked'))
                .map(cb => cb.value);
            
            if (selected.length === 0) {
                alert('Select at least one player');
                return;
            }
            
            const briefHtml = selected.map(playerName => {
                const player = database.realPlayers.find(p => p.name === playerName);
                const arch = database.archetypes.find(a => a.id === player.archetypeId);
                
                if (!arch) return '';
                
                return `
                    <div class="brief-player">
                        <div class="brief-player-name">${player.name}</div>
                        <div style="opacity: 0.7; margin-bottom: 1rem;">${arch.name} • ${player.venue || 'No venue'}</div>
                        
                        <div class="brief-section">
                            <div class="brief-section-title">Key Exploits</div>
                            <ul class="brief-list">
                                ${arch.exploits.preflop.slice(0, 3).map(e => `<li>${e}</li>`).join('')}
                            </ul>
                        </div>
                        
                        <div class="brief-section">
                            <div class="brief-section-title">Watch Out For</div>
                            <ul class="brief-list warnings">
                                ${arch.exploits.warnings.slice(0, 2).map(w => `<li>${w}</li>`).join('')}
                            </ul>
                        </div>
                        
                        ${player.notes ? `<div class="brief-section"><div class="brief-section-title">Notes</div><p style="opacity: 0.8;">${player.notes}</p></div>` : ''}
                    </div>
                `;
            }).join('');
            
            document.getElementById('brief-content').innerHTML = briefHtml;
            document.getElementById('brief-output').style.display = 'block';
        }

        // Data
        function updateJsonDisplay() {
            document.getElementById('json-display').textContent = JSON.stringify(database, null, 2);
        }

        function exportData() {
            const dataStr = JSON.stringify(database, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'poker-database.json';
            link.click();
        }

        function importData() {
            const file = document.getElementById('import-file').files[0];
            if (!file) {
                alert('Select a file first');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    database = JSON.parse(e.target.result);
                    saveDatabase();
                    alert('Database imported successfully!');
                } catch (err) {
                    alert('Error importing file: ' + err.message);
                }
            };
            reader.readAsText(file);
        }

        // Splash screen functionality
        function exitApp() {
            // Switch to dashboard tab before exiting
            switchTab('dashboard');
            // Then show splash screen
            document.getElementById('main-container').style.display = 'none';
            document.getElementById('splash-screen').style.display = 'flex';
        }

        function hideSplash() {
            document.getElementById('splash-screen').style.display = 'none';
            document.getElementById('main-container').style.display = 'block';
            // Make sure dashboard is active when entering from splash
            switchTab('dashboard');
        }

        // ===== LIVE SESSION =====
        let sessionActive = false;
        let sessionStartTime = null;
        let sessionTimerInterval = null;
        let sessionNotes = [];
        let currentBlindLevel = 0;
        let blindTimerInterval = null;
        let blindCountdownInterval = null;
        let blindNextAdvance = null;

        const blindStructure = [
            { sb: 100, bb: 100, ante: 0 },
            { sb: 100, bb: 100, ante: 100 },
            { sb: 100, bb: 200, ante: 200 },
            { sb: 200, bb: 300, ante: 300 },
            { sb: 200, bb: 400, ante: 400 },
            { sb: 300, bb: 600, ante: 600 },
            { sb: 400, bb: 800, ante: 800 },
            { sb: 600, bb: 1200, ante: 1200 },
            { sb: 1000, bb: 1500, ante: 1500 },
            { sb: 1000, bb: 2000, ante: 2000 },
            { sb: 1500, bb: 2500, ante: 2500 },
            { sb: 2000, bb: 3000, ante: 3000 },
            { sb: 2000, bb: 4000, ante: 4000 },
            { sb: 3000, bb: 6000, ante: 6000 },
            { sb: 4000, bb: 8000, ante: 8000 },
            { sb: 6000, bb: 12000, ante: 12000 },
            { sb: 10000, bb: 15000, ante: 15000 },
            { sb: 10000, bb: 20000, ante: 20000 },
            { sb: 15000, bb: 25000, ante: 25000 },
            { sb: 15000, bb: 30000, ante: 30000 },
            { sb: 20000, bb: 40000, ante: 40000 },
            { sb: 30000, bb: 60000, ante: 60000 },
            { sb: 40000, bb: 80000, ante: 80000 },
            { sb: 60000, bb: 120000, ante: 120000 },
            { sb: 100000, bb: 150000, ante: 150000 },
        ];

        function formatChips(n) {
            if (n >= 1000) return (n / 1000) + 'K';
            return n.toString();
        }

        function updateBlindDisplay() {
            const level = blindStructure[currentBlindLevel];
            document.getElementById('blind-level-num').textContent = 'Level ' + (currentBlindLevel + 1);
            document.getElementById('blind-level-values-display').textContent = 
                formatChips(level.sb) + ' / ' + formatChips(level.bb) + ' / ' + formatChips(level.ante) + ' ante';
        }

        function editBlindLevel() {
            const level = blindStructure[currentBlindLevel];
            const display = document.getElementById('blind-level-values-display');
            const editRow = document.getElementById('blind-level-edit-row');
            const sbInput = document.getElementById('blind-sb-input');
            const bbInput = document.getElementById('blind-bb-input');
            const anteInput = document.getElementById('blind-ante-input');

            // Show edit inputs, hide display
            display.classList.add('hidden');
            editRow.classList.remove('hidden');

            // Set current values
            sbInput.value = level.sb;
            bbInput.value = level.bb;
            anteInput.value = level.ante;

            // Focus first input
            sbInput.focus();
            setTimeout(() => sbInput.select(), 0);
        }

        function commitBlindLevel() {
            const level = blindStructure[currentBlindLevel];
            const display = document.getElementById('blind-level-values-display');
            const editRow = document.getElementById('blind-level-edit-row');
            const sbInput = document.getElementById('blind-sb-input');
            const bbInput = document.getElementById('blind-bb-input');
            const anteInput = document.getElementById('blind-ante-input');

            // Parse values
            const sb = parseInt(sbInput.value.replace(/[^0-9]/g, '')) || level.sb;
            const bb = parseInt(bbInput.value.replace(/[^0-9]/g, '')) || level.bb;
            const ante = parseInt(anteInput.value.replace(/[^0-9]/g, '')) || level.ante;

            // Update structure
            blindStructure[currentBlindLevel] = { sb, bb, ante };

            // Hide edit inputs, show display
            editRow.classList.add('hidden');
            display.classList.remove('hidden');

            // Update display
            updateBlindDisplay();
        }

        function prevBlindLevel() {
            if (currentBlindLevel > 0) {
                currentBlindLevel--;
                updateBlindDisplay();
                resetBlindCountdown();
            }
        }

        function nextBlindLevel() {
            if (currentBlindLevel < blindStructure.length - 1) {
                currentBlindLevel++;
                updateBlindDisplay();
                resetBlindCountdown();
            }
        }

        function toggleBlindTimer() {
            const checked = document.getElementById('blind-auto-advance').checked;
            const group = document.getElementById('blind-interval-group');
            const input = document.getElementById('blind-interval');
            
            if (checked) {
                group.style.opacity = '1';
                input.disabled = false;
                startBlindCountdown();
            } else {
                group.style.opacity = '0.4';
                input.disabled = true;
                stopBlindCountdown();
            }
        }

        function startBlindCountdown() {
            stopBlindCountdown();
            const minutes = parseInt(document.getElementById('blind-interval').value) || 20;
            blindNextAdvance = Date.now() + (minutes * 60 * 1000);
            
            blindCountdownInterval = setInterval(() => {
                const remaining = blindNextAdvance - Date.now();
                if (remaining <= 0) {
                    nextBlindLevel();
                    // Reset for next level
                    blindNextAdvance = Date.now() + (minutes * 60 * 1000);
                } else {
                    const mins = Math.floor(remaining / 60000);
                    const secs = Math.floor((remaining % 60000) / 1000);
                    document.getElementById('blind-countdown').textContent = 
                        mins.toString().padStart(2, '0') + ':' + secs.toString().padStart(2, '0');
                }
            }, 1000);
        }

        function stopBlindCountdown() {
            if (blindCountdownInterval) {
                clearInterval(blindCountdownInterval);
                blindCountdownInterval = null;
            }
            document.getElementById('blind-countdown').textContent = '';
        }

        function resetBlindCountdown() {
            if (document.getElementById('blind-auto-advance').checked) {
                startBlindCountdown();
            }
        }

        function toggleSession() {
            if (!sessionActive) {
                // Start session
                sessionActive = true;
                sessionStartTime = Date.now();
                sessionNotes = [];
                
                document.getElementById('session-start-btn').style.display = 'none';
                document.getElementById('session-stop-btn').style.display = 'flex';
                document.getElementById('session-status-label').textContent = 'Session active';
                document.getElementById('session-clock').classList.add('active');
                
                sessionTimerInterval = setInterval(updateSessionClock, 1000);
                updateSessionClock();
            }
        }

        function endSession() {
            if (!sessionActive) return;
            if (sessionNotes.length > 0 && !confirm('End this session? Notes will be cleared.')) return;
            
            sessionActive = false;
            clearInterval(sessionTimerInterval);
            sessionTimerInterval = null;
            
            document.getElementById('session-start-btn').style.display = 'flex';
            document.getElementById('session-stop-btn').style.display = 'none';
            document.getElementById('session-clock').textContent = '00:00:00';
            document.getElementById('session-clock').classList.remove('active');
            document.getElementById('session-status-label').textContent = 'Session not started';
            document.getElementById('session-notes-section').style.display = 'none';
            document.getElementById('session-notes-feed').innerHTML = '';
            sessionNotes = [];
        }

        function updateSessionClock() {
            if (!sessionStartTime) return;
            const elapsed = Date.now() - sessionStartTime;
            const hrs = Math.floor(elapsed / 3600000);
            const mins = Math.floor((elapsed % 3600000) / 60000);
            const secs = Math.floor((elapsed % 60000) / 1000);
            document.getElementById('session-clock').textContent = 
                hrs.toString().padStart(2, '0') + ':' + 
                mins.toString().padStart(2, '0') + ':' + 
                secs.toString().padStart(2, '0');
        }

        function addSessionNote() {
            const input = document.getElementById('session-note-input');
            const text = input.value.trim();
            if (!text) return;
            
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
            const level = blindStructure[currentBlindLevel];
            const blindStr = 'L' + (currentBlindLevel + 1) + ' (' + formatChips(level.sb) + '/' + formatChips(level.bb) + ')';
            
            const note = {
                id: Date.now(),
                time: timeStr,
                blind: blindStr,
                text: text
            };
            
            sessionNotes.unshift(note);
            input.value = '';
            renderSessionNotes();
            input.focus();
        }

        function deleteSessionNote(id) {
            sessionNotes = sessionNotes.filter(n => n.id !== id);
            renderSessionNotes();
        }

        function renderSessionNotes() {
            const section = document.getElementById('session-notes-section');
            const feed = document.getElementById('session-notes-feed');
            
            if (sessionNotes.length === 0) {
                section.style.display = 'none';
                return;
            }
            
            section.style.display = 'block';
            feed.innerHTML = sessionNotes.map(note => `
                <div class="session-note-card">
                    <div class="session-note-header">
                        <span class="session-note-time">${note.time}</span>
                        <span class="session-note-blind">${note.blind}</span>
                    </div>
                    <div class="session-note-text">${note.text}</div>
                    <button class="session-note-delete" onclick="deleteSessionNote(${note.id})" title="Delete">✕</button>
                </div>
            `).join('');
        }

        // Allow Enter to submit note (Shift+Enter for newline)
        document.getElementById('session-note-input').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                addSessionNote();
            }
        });

        // Initialize blind display
        updateBlindDisplay();

        // ===== SESSION PLAYER SELECTION =====
        const MAX_SEATS = 10;
        const MAX_TRACKED_PLAYERS = 2;
        let sessionPlayers = []; // array of { id, name, position, tracked }

        function getSelectedPlayerNames() {
            return sessionPlayers.map(p => p.name).filter(n => n);
        }

        function getTrackedPlayers() {
            return sessionPlayers.filter(p => p.tracked);
        }

        function updatePlayerCount() {
            const btn = document.getElementById('add-player-slot-btn');
            if (!btn) return; // Element removed, skip update
            btn.disabled = sessionPlayers.length >= MAX_SEATS;
        }

        function addPlayerSlot() {
            if (sessionPlayers.length >= MAX_SEATS) return;
            const id = Date.now() + Math.random();
            sessionPlayers.push({ id, name: '', position: '', tracked: false });
            renderSessionPlayers();
            // Focus the new input
            setTimeout(() => {
                const inputs = document.querySelectorAll('.session-player-input');
                const last = inputs[inputs.length - 1];
                if (last) last.focus();
            }, 50);
        }

        function removePlayerSlot(id) {
            sessionPlayers = sessionPlayers.filter(p => p.id !== id);
            renderSessionPlayers();
            hhSyncSeats();
        }

        function setPlayerName(id, name) {
            const player = sessionPlayers.find(p => p.id === id);
            if (player) player.name = name;
        }

        function setPlayerPosition(id, position) {
            const player = sessionPlayers.find(p => p.id === id);
            if (player) player.position = position;
        }

        function togglePlayerTracking(id, checked) {
            const player = sessionPlayers.find(p => p.id === id);
            if (!player) return;

            const trackedCount = getTrackedPlayers().length;

            // If trying to check and already at max, prevent it
            if (checked && !player.tracked && trackedCount >= MAX_TRACKED_PLAYERS) {
                // Re-render to reset the checkbox
                renderSessionPlayers();
                return;
            }

            player.tracked = checked;
            renderSessionPlayers();
        }

        function renderSessionPlayers() {
            const container = document.getElementById('session-players-list');
            if (!container) return; // Element removed, skip rendering
            
            const trackedCount = getTrackedPlayers().length;
            
            container.innerHTML = sessionPlayers.map((player, i) => `
                <div class="session-player-slot" data-player-id="${player.id}">
                    <span class="session-player-seat">${i + 1}</span>
                    <div class="session-player-input-wrap">
                        <input type="text" 
                            class="session-player-input${player.name ? ' has-player' : ''}${player.tracked ? ' tracked' : ''}" 
                            value="${player.name}" 
                            placeholder="Search player..."
                            data-player-id="${player.id}"
                            onfocus="onPlayerInputFocus(this)"
                            oninput="onPlayerInputType(this)"
                            onblur="onPlayerInputBlur(this)"
                        >
                        <div class="session-player-dropdown" id="dropdown-${player.id}"></div>
                    </div>
                    <label class="session-player-track${player.name ? '' : ' hidden'}" 
                           title="${trackedCount >= MAX_TRACKED_PLAYERS && !player.tracked ? 'Max 2 players can be tracked' : 'Track hand history'}">
                        <input type="checkbox" 
                               data-player-id="${player.id}"
                               ${player.tracked ? 'checked' : ''}
                               ${trackedCount >= MAX_TRACKED_PLAYERS && !player.tracked ? 'disabled' : ''}
                               onchange="togglePlayerTracking(${player.id}, this.checked)">
                        <svg class="track-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                    </label>
                    <select class="session-player-position${player.name ? '' : ' hidden'}${player.position ? ' has-position' : ''}${player.tracked ? ' tracked' : ''}" 
                            data-player-id="${player.id}"
                            onchange="onPlayerPositionChange(this)">
                        <option value="">—</option>
                        <option value="SB"${player.position === 'SB' ? ' selected' : ''}>SB</option>
                        <option value="BB"${player.position === 'BB' ? ' selected' : ''}>BB</option>
                        <option value="UTG"${player.position === 'UTG' ? ' selected' : ''}>UTG</option>
                        <option value="MP"${player.position === 'MP' ? ' selected' : ''}>MP</option>
                        <option value="HJ"${player.position === 'HJ' ? ' selected' : ''}>HJ</option>
                        <option value="CO"${player.position === 'CO' ? ' selected' : ''}>CO</option>
                        <option value="D"${player.position === 'D' ? ' selected' : ''}>D</option>
                    </select>
                    <!-- COMMENTED OUT - Red X remove button (may revive later)
                    <button class="session-player-remove" onclick="removePlayerSlot(${player.id})" title="Remove">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                    -->
                </div>
            `).join('');
            updatePlayerCount();
        }

        function onPlayerPositionChange(select) {
            const id = parseFloat(select.dataset.playerId);
            const position = select.value;
            setPlayerPosition(id, position);
            
            // Toggle has-position class based on whether a position is selected
            if (position) {
                select.classList.add('has-position');
            } else {
                select.classList.remove('has-position');
            }
        }

        function onPlayerInputFocus(input) {
            const id = parseFloat(input.dataset.playerId);
            const player = sessionPlayers.find(p => p.id === id);
            
            // If has a name, switch to edit mode
            if (input.classList.contains('has-player')) {
                input.classList.remove('has-player');
            }
            // Show dropdown with all players
            showPlayerDropdown(input, input.value);
        }

        function onPlayerInputType(input) {
            showPlayerDropdown(input, input.value);
        }

        function onPlayerInputBlur(input) {
            const id = parseFloat(input.dataset.playerId);
            
            // Delay to allow dropdown click to fire
            setTimeout(() => {
                const dropdown = document.getElementById('dropdown-' + id);
                if (dropdown) dropdown.classList.remove('open');
                
                const val = input.value.trim();
                setPlayerName(id, val);
                
                const slot = input.closest('.session-player-slot');
                const player = sessionPlayers.find(p => p.id === id);
                
                // Update input styling
                if (val) {
                    input.classList.add('has-player');
                } else {
                    input.classList.remove('has-player');
                }
                
                // Show/hide position dropdown
                const positionSelect = slot.querySelector('.session-player-position');
                if (positionSelect) {
                    if (val) {
                        positionSelect.classList.remove('hidden');
                    } else {
                        positionSelect.classList.add('hidden');
                        // Clear position if name removed
                        if (player) player.position = '';
                    }
                }
                
                // Show/hide tracking checkbox
                const trackLabel = slot.querySelector('.session-player-track');
                if (trackLabel) {
                    if (val) {
                        trackLabel.classList.remove('hidden');
                    } else {
                        trackLabel.classList.add('hidden');
                        // Untrack if name removed
                        if (player) player.tracked = false;
                    }
                }
                
                hhSyncSeats();
            }, 200);
        }

        let newPlayerCounter = 0;

        function showPlayerDropdown(input, query) {
            const id = parseFloat(input.dataset.playerId);
            const dropdown = document.getElementById('dropdown-' + id);
            if (!dropdown) return;

            const search = (query || '').toLowerCase();
            const selected = getSelectedPlayerNames();
            
            const matches = database.realPlayers
                .filter(p => !search || p.name.toLowerCase().includes(search));

            let html = '';

            if (matches.length === 0) {
                html = '<div class="session-player-dropdown-empty">No players found</div>';
            } else {
                html = matches.map(p => {
                    const isSelected = selected.includes(p.name) && sessionPlayers.find(sp => sp.id === id)?.name !== p.name;
                    return `<div class="session-player-dropdown-item${isSelected ? ' already-selected' : ''}" 
                        onmousedown="selectPlayerFromDropdown(${id}, '${p.name.replace(/'/g, "\\'")}')">${p.name}</div>`;
                }).join('');
            }

            // Add "New Player" option at bottom
            const nextNum = newPlayerCounter + 1;
            const newLabel = nextNum === 1 ? 'New Player' : 'New Player ' + nextNum;
            html += `<div class="session-player-dropdown-item session-player-new-option" onmousedown="addNewPlayerFromDropdown(${id})">+ ${newLabel}</div>`;

            dropdown.innerHTML = html;
            dropdown.classList.add('open');
        }

        function addNewPlayerFromDropdown(slotId) {
            newPlayerCounter++;
            const name = newPlayerCounter === 1 ? 'New Player' : 'New Player ' + newPlayerCounter;
            selectPlayerFromDropdown(slotId, name);
            hhSyncSeats();
        }

        function selectPlayerFromDropdown(id, name) {
            setPlayerName(id, name);
            const input = document.querySelector(`input[data-player-id="${id}"]`);
            if (input) {
                input.value = name;
                input.classList.add('has-player');
                input.blur();
            }
            const dropdown = document.getElementById('dropdown-' + id);
            if (dropdown) dropdown.classList.remove('open');
            hhSyncSeats();
        }

        // Close all dropdowns when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.session-player-input-wrap')) {
                document.querySelectorAll('.session-player-dropdown').forEach(d => d.classList.remove('open'));
            }
        });

        renderSessionPlayers();

        // ===== HAND HISTORY =====
        var hhSelectedSeat=null,hhSelectedPos='',hhSavedHands=[];
        var hhStreetActions={preflop:[],flop:[],turn:[],river:[]};
        
        // Position action order for each street
        var hhActionOrder = {
            preflop: ['UTG', 'MP', 'HJ', 'CO', 'D', 'SB', 'BB'],
            postflop: ['SB', 'BB', 'UTG', 'MP', 'HJ', 'CO', 'D']
        };
        
        function hhGetTrackedPlayersInOrder(street) {
            var tracked = getTrackedPlayers();
            if (tracked.length === 0) return [];
            
            var order = street === 'preflop' ? hhActionOrder.preflop : hhActionOrder.postflop;
            
            // Sort tracked players by action order
            return tracked.sort(function(a, b) {
                var aIdx = order.indexOf(a.position);
                var bIdx = order.indexOf(b.position);
                if (aIdx === -1) aIdx = 999;
                if (bIdx === -1) bIdx = 999;
                return aIdx - bIdx;
            });
        }
        var hhActionChoices=['Check','Bet','Fold','Call','Limp','Raise','Re-Raise','All-in'];
        var hhNeedsAmount={Bet:1,Raise:1,'Re-Raise':1,'All-in':1};
        
        // Check if an action is a betting action (keeps action open)
        function hhIsBettingAction(action) {
            return action === 'Bet' || action === 'Raise' || action === 'Re-Raise' || action === 'All-in';
        }
        
        // Check if an action closes the betting round
        function hhClosesRound(action) {
            return action === 'Call' || action === 'Check' || action === 'Fold';
        }
        
        // Get valid actions based on previous action (action hierarchy)
        function hhGetValidActions(street, currentPlayerName) {
            var trackedPlayers = getTrackedPlayers();
            
            // SIMPLE MODE: When tracking 0 or 1 player, show simplified actions
            if (trackedPlayers.length <= 1) {
                if (street === 'preflop') {
                    // PreFlop: No Check option
                    return ['Bet', 'Call', 'Fold', 'All-in', 'Re-Raise'];
                } else {
                    // Post-Flop: Include Check
                    return ['Check', 'Bet', 'Call', 'Fold', 'All-in', 'Re-Raise'];
                }
            }
            
            // COMPLEX MODE: When tracking 2 players, use full poker logic
            var acts = hhStreetActions[street];
            if (!acts || acts.length === 0) {
                // First action on the street
                if (street === 'preflop') {
                    // First actor preflop: Bet or Limp only
                    return ['Bet', 'Limp'];
                } else {
                    return ['Check', 'Bet', 'All-in'];
                }
            }
            
            // Find the last action by the OTHER player (not current player)
            var lastOpponentAction = null;
            for (var i = acts.length - 1; i >= 0; i--) {
                if (acts[i].action && acts[i].player !== currentPlayerName) {
                    lastOpponentAction = acts[i].action;
                    break;
                }
            }
            
            // If no opponent action yet, it's the first action
            if (!lastOpponentAction) {
                if (street === 'preflop') {
                    return ['Bet', 'Limp'];
                } else {
                    return ['Check', 'Bet', 'All-in'];
                }
            }
            
            // After opponent folds, hand is over
            if (lastOpponentAction === 'Fold') {
                return [];
            }
            
            // After opponent checks: Check / Bet / Fold / All-in
            if (lastOpponentAction === 'Check') {
                return ['Check', 'Bet', 'Fold', 'All-in'];
            }
            
            // After Bet: Call / Raise / All-in / Fold
            if (lastOpponentAction === 'Bet') {
                return ['Fold', 'Call', 'Raise', 'All-in'];
            }
            
            // After Raise: Call / Re-Raise / All-in / Fold
            if (lastOpponentAction === 'Raise') {
                return ['Fold', 'Call', 'Re-Raise', 'All-in'];
            }
            
            // After Re-Raise: Call / Re-Raise / All-in / Fold
            if (lastOpponentAction === 'Re-Raise') {
                return ['Fold', 'Call', 'Re-Raise', 'All-in'];
            }
            
            // After All-in: Call / All-in / Fold
            if (lastOpponentAction === 'All-in') {
                return ['Fold', 'Call', 'All-in'];
            }
            
            // After opponent calls, round is complete (they closed the betting)
            if (lastOpponentAction === 'Call') {
                return [];
            }
            
            // Special PreFlop case: After Limp
            if (lastOpponentAction === 'Limp' && street === 'preflop') {
                return ['Check', 'Raise', 'All-in', 'Fold'];
            }
            
            // Fallback
            return hhActionChoices;
        }
        var hhSelectedOutcome='',hhSelectedDetail='';
        var hhCurrentHandIdx=1,hhHandCounter=0,hhIsReadonly=false;

        function hhSyncSeats(){
            // Populate player dropdown from Players at the Table
            const dropdown = document.getElementById('hh-player-select');
            if (!dropdown) return;
            
            // Save current selection
            const currentValue = dropdown.value;
            
            // Clear and rebuild options
            dropdown.innerHTML = '<option value="">Select player...</option>';
            
            sessionPlayers.forEach((player, i) => {
                if (player.name) {
                    const option = document.createElement('option');
                    option.value = i + 1; // Use seat number as value
                    option.textContent = player.name;
                    dropdown.appendChild(option);
                }
            });
            
            // Restore selection if still valid
            if (currentValue) {
                dropdown.value = currentValue;
            }
        }
        
        function hhGetPlayerName(seat){
            if(!seat) return '';
            const idx = parseInt(seat) - 1;
            if(idx < 0 || idx >= sessionPlayers.length) return '';
            return sessionPlayers[idx].name || '';
        }
        
        // Handle player and position selection
        document.addEventListener('DOMContentLoaded', function() {
            const playerSelect = document.getElementById('hh-player-select');
            const selectionInputs = document.getElementById('hh-selection-inputs');
            const selectionDisplay = document.getElementById('hh-selection-display');
            const playerDisplay = document.getElementById('hh-player-display');
            
            if (playerSelect && playerDisplay) {
                playerSelect.addEventListener('change', function() {
                    hhSelectedSeat = this.value;
                    
                    if (this.value) {
                        // Get player name from selected option
                        const selectedOption = this.options[this.selectedIndex];
                        const playerName = selectedOption.textContent;
                        playerDisplay.textContent = playerName;
                        
                        // Check if both player and position are selected
                        hhUpdateSelectionDisplay();
                    }
                });
            }
            
            // Click on display to edit
            if (selectionDisplay) {
                selectionDisplay.addEventListener('click', function() {
                    if (!hhIsReadonly) {
                        selectionDisplay.classList.add('hidden');
                        selectionInputs.classList.remove('hidden');
                    }
                });
            }
        });
        
        function hhUpdateSelectionDisplay() {
            const selectionInputs = document.getElementById('hh-selection-inputs');
            const selectionDisplay = document.getElementById('hh-selection-display');
            const playerDisplay = document.getElementById('hh-player-display');
            const positionDisplay = document.getElementById('hh-position-display');
            
            // Show combined display if both player and position are selected
            if (hhSelectedSeat && hhSelectedPos) {
                selectionDisplay.classList.remove('hidden');
                selectionInputs.classList.add('hidden');
            } else {
                selectionDisplay.classList.add('hidden');
                selectionInputs.classList.remove('hidden');
            }
        }
        
        function hhSelectPos(el) {
            if (hhIsReadonly) return;
            
            // Remove active from all chips
            document.querySelectorAll('.hh-pos-chip').forEach(function(c) {
                c.classList.remove('active');
            });
            
            // Add active to clicked chip
            el.classList.add('active');
            hhSelectedPos = el.dataset.pos;
            
            // Update position display
            const positionDisplay = document.getElementById('hh-position-display');
            positionDisplay.textContent = el.dataset.pos;
            
            // Check if both player and position are selected
            hhUpdateSelectionDisplay();
        }
        
        function hhAddAction(street) {
            if(hhIsReadonly) return;
            
            // Check if previous street is complete before allowing action on current street
            if (street === 'flop' && !hhIsStreetComplete('preflop')) {
                return; // PreFlop not complete
            }
            if (street === 'turn' && (!hhIsStreetComplete('preflop') || !hhIsStreetComplete('flop'))) {
                return; // PreFlop or Flop not complete
            }
            if (street === 'river' && (!hhIsStreetComplete('preflop') || !hhIsStreetComplete('flop') || !hhIsStreetComplete('turn'))) {
                return; // PreFlop, Flop, or Turn not complete
            }
            
            var trackedPlayers = hhGetTrackedPlayersInOrder(street);
            
            if (trackedPlayers.length === 0) {
                // No tracked players - use old behavior
                hhStreetActions[street].push({action:'',amount:'',note:''});
            } else if (trackedPlayers.length === 1) {
                // One tracked player - add action with that player
                hhStreetActions[street].push({
                    player: trackedPlayers[0].name,
                    action: '',
                    amount: '',
                    note: ''
                });
            } else {
                // Multiple tracked players - determine next player to act
                var lastPlayer = null;
                var acts = hhStreetActions[street];
                
                // Find the last player who acted
                for(var i = acts.length - 1; i >= 0; i--) {
                    if(acts[i].player) {
                        lastPlayer = acts[i].player;
                        break;
                    }
                }
                
                // Determine next player in action order
                var nextPlayer = null;
                if(!lastPlayer) {
                    // No previous actions, start with first player
                    nextPlayer = trackedPlayers[0].name;
                } else {
                    // Find current player's index and get next
                    var currentIdx = -1;
                    for(var i = 0; i < trackedPlayers.length; i++) {
                        if(trackedPlayers[i].name === lastPlayer) {
                            currentIdx = i;
                            break;
                        }
                    }
                    
                    // Cycle to next player (wraps around)
                    if(currentIdx !== -1) {
                        var nextIdx = (currentIdx + 1) % trackedPlayers.length;
                        nextPlayer = trackedPlayers[nextIdx].name;
                    } else {
                        // Fallback to first player
                        nextPlayer = trackedPlayers[0].name;
                    }
                }
                
                hhStreetActions[street].push({
                    player: nextPlayer,
                    action: '',
                    amount: '',
                    note: ''
                });
            }
            
            hhRenderStreet(street);
            
            // Focus the action dropdown
            var cells = document.querySelectorAll('.hh-action-select[data-street="'+street+'"]');
            if(cells.length) setTimeout(function(){cells[cells.length-1].focus()},30);
        }

        function hhRenderStreet(street){
            var c = document.getElementById('actions-' + street);
            var acts = hhStreetActions[street];
            var trackedPlayers = hhGetTrackedPlayersInOrder(street);
            
            // Check if previous streets are complete before rendering this street
            var shouldRender = true;
            if (street === 'flop' && !hhIsStreetComplete('preflop')) {
                shouldRender = false;
            }
            if (street === 'turn' && (!hhIsStreetComplete('preflop') || !hhIsStreetComplete('flop'))) {
                shouldRender = false;
            }
            if (street === 'river' && (!hhIsStreetComplete('preflop') || !hhIsStreetComplete('flop') || !hhIsStreetComplete('turn'))) {
                shouldRender = false;
            }
            
            if(!shouldRender || !acts.length){
                c.innerHTML = '';
                hhRenderPlayerCount(street);
                return;
            }
            
            // Read-only mode
            if(hhIsReadonly){
                var h = '';
                for(var i = 0; i < acts.length; i++){
                    if(!acts[i].action) continue;
                    if(h) h += '<span class="hh-dash">\u2013</span>';
                    
                    // Show player first name if present
                    if(acts[i].player) {
                        var firstName = acts[i].player.split(' ')[0];
                        h += '<span class="hh-player-name">' + firstName + ': </span>';
                    }
                    
                    var amt = acts[i].amount ? ' <span class="hh-at-amt">' + parseInt(acts[i].amount).toLocaleString() + '</span>' : '';
                    h += '<span class="hh-action-text">' + acts[i].action + amt + '</span>';
                }
                c.innerHTML = h;
                hhRenderPlayerCount(street);
                return;
            }
            
            // Edit mode - check if we have 2 tracked players for column layout
            var isStreetComplete = hhIsStreetComplete(street);
            
            if(trackedPlayers.length === 2) {
                // Two-column layout: one column per player
                var player1 = trackedPlayers[0];
                var player2 = trackedPlayers[1];
                
                // Separate actions by player
                var player1Actions = [];
                var player2Actions = [];
                
                for(var i = 0; i < acts.length; i++) {
                    if(acts[i].player === player1.name) {
                        player1Actions.push({index: i, action: acts[i]});
                    } else if(acts[i].player === player2.name) {
                        player2Actions.push({index: i, action: acts[i]});
                    }
                }
                
                var h = '<div class="hh-two-column-layout">';
                
                // Player 1 column
                h += '<div class="hh-player-column">';
                h += '<div class="hh-player-column-header">' + player1.name.split(' ')[0] + '</div>';
                for(var i = 0; i < player1Actions.length; i++) {
                    var item = player1Actions[i];
                    var a = item.action;
                    var idx = item.index;
                    var sa = a.action && hhNeedsAmount[a.action];
                    var isLastAction = (idx === acts.length - 1);
                    
                    h += '<div class="hh-action-cell">';
                    
                    // Show as text if: (1) not the last action, OR (2) street is complete
                    if(a.action && (!isLastAction || isStreetComplete)) {
                        var amt = a.amount ? ' ' + parseInt(a.amount).toLocaleString() : '';
                        h += '<span class="hh-action-display" onclick="hhMakeEditable(\'' + street + '\',' + idx + ')">' + a.action + amt + '</span>';
                    } else {
                        // Show dropdown for last action or incomplete actions
                        var actionsToShow;
                        if (a.action) {
                            actionsToShow = hhActionChoices;
                        } else {
                            actionsToShow = hhGetValidActions(street, a.player);
                        }
                        
                        h += '<select class="hh-action-select' + (a.action ? ' has-value' : '') + '" data-street="' + street + '" data-idx="' + idx + '" onchange="hhOnActionChange(this)">';
                        h += '<option value="">...</option>';
                        
                        for(var j = 0; j < actionsToShow.length; j++){
                            h += '<option value="' + actionsToShow[j] + '"' + (a.action === actionsToShow[j] ? ' selected' : '') + '>' + actionsToShow[j] + '</option>';
                        }
                        h += '</select>';
                        
                        h += '<input type="text" class="hh-action-amt' + (sa ? ' visible' : '') + '" data-street="' + street + '" data-idx="' + idx + '" inputmode="numeric" placeholder="$" value="' + (a.amount || '') + '" onchange="hhOnAmtChange(this)" onkeydown="hhOnAmtKey(event,this)">';
                        h += '<button class="hh-action-x" onclick="hhRemoveAction(\'' + street + '\',' + idx + ')">\u2715</button>';
                    }
                    h += '</div>';
                }
                h += '</div>';
                
                // Player 2 column
                h += '<div class="hh-player-column">';
                h += '<div class="hh-player-column-header">' + player2.name.split(' ')[0] + '</div>';
                for(var i = 0; i < player2Actions.length; i++) {
                    var item = player2Actions[i];
                    var a = item.action;
                    var idx = item.index;
                    var sa = a.action && hhNeedsAmount[a.action];
                    var isLastAction = (idx === acts.length - 1);
                    
                    h += '<div class="hh-action-cell">';
                    
                    // Show as text if: (1) not the last action, OR (2) street is complete
                    if(a.action && (!isLastAction || isStreetComplete)) {
                        var amt = a.amount ? ' ' + parseInt(a.amount).toLocaleString() : '';
                        h += '<span class="hh-action-display" onclick="hhMakeEditable(\'' + street + '\',' + idx + ')">' + a.action + amt + '</span>';
                    } else {
                        // Show dropdown for last action or incomplete actions
                        var actionsToShow;
                        if (a.action) {
                            actionsToShow = hhActionChoices;
                        } else {
                            actionsToShow = hhGetValidActions(street, a.player);
                        }
                        
                        h += '<select class="hh-action-select' + (a.action ? ' has-value' : '') + '" data-street="' + street + '" data-idx="' + idx + '" onchange="hhOnActionChange(this)">';
                        h += '<option value="">...</option>';
                        
                        for(var j = 0; j < actionsToShow.length; j++){
                            h += '<option value="' + actionsToShow[j] + '"' + (a.action === actionsToShow[j] ? ' selected' : '') + '>' + actionsToShow[j] + '</option>';
                        }
                        h += '</select>';
                        
                        h += '<input type="text" class="hh-action-amt' + (sa ? ' visible' : '') + '" data-street="' + street + '" data-idx="' + idx + '" inputmode="numeric" placeholder="$" value="' + (a.amount || '') + '" onchange="hhOnAmtChange(this)" onkeydown="hhOnAmtKey(event,this)">';
                        h += '<button class="hh-action-x" onclick="hhRemoveAction(\'' + street + '\',' + idx + ')">\u2715</button>';
                    }
                    h += '</div>';
                }
                h += '</div>';
                
                h += '</div>';
                c.innerHTML = h;
                
            } else {
                // Single column layout (0 or 1 tracked player)
                var h = '';
                for(var i = 0; i < acts.length; i++){
                    var a = acts[i];
                    var sa = a.action && hhNeedsAmount[a.action];
                    var isLastAction = (i === acts.length - 1);
                    
                    if(i > 0) h += '<span class="hh-dash">\u2013</span>';
                    
                    h += '<div class="hh-action-cell">';
                    
                    // Show player first name label if present
                    if(a.player) {
                        var firstName = a.player.split(' ')[0];
                        h += '<span class="hh-player-label">' + firstName + '</span>';
                    }
                    
                    // Show as text if: (1) not the last action, OR (2) street is complete
                    if(a.action && (!isLastAction || isStreetComplete)) {
                        var amt = a.amount ? ' ' + parseInt(a.amount).toLocaleString() : '';
                        h += '<span class="hh-action-display" onclick="hhMakeEditable(\'' + street + '\',' + i + ')">' + a.action + amt + '</span>';
                    } else {
                        // Show dropdown for last action or incomplete actions
                        var actionsToShow;
                        if (a.action) {
                            actionsToShow = hhActionChoices;
                        } else if (a.player) {
                            actionsToShow = hhGetValidActions(street, a.player);
                        } else {
                            actionsToShow = hhActionChoices;
                        }
                        
                        h += '<select class="hh-action-select' + (a.action ? ' has-value' : '') + '" data-street="' + street + '" data-idx="' + i + '" onchange="hhOnActionChange(this)">';
                        h += '<option value="">...</option>';
                        
                        for(var j = 0; j < actionsToShow.length; j++){
                            h += '<option value="' + actionsToShow[j] + '"' + (a.action === actionsToShow[j] ? ' selected' : '') + '>' + actionsToShow[j] + '</option>';
                        }
                        h += '</select>';
                        
                        h += '<input type="text" class="hh-action-amt' + (sa ? ' visible' : '') + '" data-street="' + street + '" data-idx="' + i + '" inputmode="numeric" placeholder="$" value="' + (a.amount || '') + '" onchange="hhOnAmtChange(this)" onkeydown="hhOnAmtKey(event,this)">';
                        h += '<button class="hh-action-x" onclick="hhRemoveAction(\'' + street + '\',' + i + ')">\u2715</button>';
                    }
                    h += '</div>';
                }
                c.innerHTML = h;
            }
            
            hhRenderPlayerCount(street);
        }
        
        function hhMakeEditable(street, idx) {
            // Temporarily mark this action as editable by rendering
            // We'll just re-render - the check for isLastAction will be false for everything
            // So we need a different approach - let's add a flag
            hhRenderStreet(street);
            // Focus the dropdown
            var sel = document.querySelector('.hh-action-select[data-street="'+street+'"][data-idx="'+idx+'"]');
            if(sel) setTimeout(function(){sel.focus()},30);
        }

        function hhRenderPlayerCount(street){if(street==='preflop'){var nw=document.getElementById('pf-note-wrap'),ni=document.getElementById('pf-note');if(!nw||!ni)return;if(hhIsReadonly){var nv=ni.value.trim();nw.innerHTML=nv?'<span class="hh-pf-note-text">'+nv+'</span>':'';ni.style.display='none';}else{nw.innerHTML='';ni.style.display='';}return;}var w=document.getElementById('pc-wrap-'+street),s=document.getElementById('players-'+street),cw=document.getElementById('cc-wrap-'+street),ci=document.getElementById('cc-'+street);if(!w||!s||!cw||!ci)return;if(hhIsReadonly){var v=s.value;w.innerHTML=v?'<span class="hh-pc-text">'+v+'</span>':'<span class="hh-pc-text">\u2013</span>';s.style.display='none';var cv=ci.value.trim();cw.innerHTML=cv?'<span class="hh-cc-text">'+cv+'</span>':'<span class="hh-cc-text">\u2013</span>';ci.style.display='none';}else{w.innerHTML='';s.style.display='';cw.innerHTML='';ci.style.display='';}}


        function hhOnActionChange(sel){
            var st=sel.dataset.street;
            var idx=+sel.dataset.idx;
            
            hhStreetActions[st][idx].action=sel.value;
            hhStreetActions[st][idx].amount='';
            hhRenderStreet(st);
            hhCheckForFold();
            hhCheckForShowdown();
            hhUpdateStreetStates();
            
            if(hhNeedsAmount[sel.value]){
                var inp=document.querySelector('.hh-action-amt[data-street="'+st+'"][data-idx="'+idx+'"]');
                if(inp)setTimeout(function(){inp.focus()},30);
            }
        }
        
        function hhIsStreetComplete(street) {
            var acts = hhStreetActions[street];
            if (!acts || acts.length === 0) return false;
            
            // Get tracked players (use global function, not street-specific)
            var trackedPlayers = getTrackedPlayers();
            
            // If we're tracking 2 players, we need at least 2 actions for completion
            if (trackedPlayers.length === 2 && acts.length < 2) {
                return false;
            }
            
            // Get last action
            var lastAction = null;
            for (var i = acts.length - 1; i >= 0; i--) {
                if (acts[i].action) {
                    lastAction = acts[i].action;
                    break;
                }
            }
            
            // No action yet
            if (!lastAction) return false;
            
            // Fold always ends the hand immediately
            if (lastAction === 'Fold') return true;
            
            // SIMPLE MODE: Street completes immediately if 0 or 1 tracked player (any action except Fold)
            if (trackedPlayers.length <= 1) {
                // Any action that's not Fold completes the street
                return true;
            }
            
            // TWO PLAYER MODE: Full poker logic
            if (trackedPlayers.length === 2) {
                var trackedPlayersInOrder = hhGetTrackedPlayersInOrder(street);
                var player1Name = trackedPlayersInOrder[0].name;
                var player2Name = trackedPlayersInOrder[1].name;
                
                var player1Acted = false;
                var player2Acted = false;
                
                for (var i = 0; i < acts.length; i++) {
                    if (acts[i].action) {
                        if (acts[i].player === player1Name) player1Acted = true;
                        if (acts[i].player === player2Name) player2Acted = true;
                    }
                }
                
                // Both players must have acted
                if (!player1Acted || !player2Acted) {
                    return false;
                }
            }
            
            // Sequences that end a street:
            // - Check → Check (all streets)
            // - Bet → Call
            // - Raise → Call  
            // - Re-Raise → Call
            
            // Call or Check closes the round (after both players have acted)
            if (lastAction === 'Call' || lastAction === 'Check') {
                return true;
            }
            
            // Betting actions keep the round open
            return false;
        }
        
        var hhUpdateCounter = 0;
        
        function hhUpdateStreetStates() {
            hhUpdateCounter++;
            
            var streets = ['preflop', 'flop', 'turn', 'river'];
            var allRows = document.querySelectorAll('.hh-table-row');
            
            // Check completion status of each street
            var preflopComplete = hhIsStreetComplete('preflop');
            var flopComplete = hhIsStreetComplete('flop');
            var turnComplete = hhIsStreetComplete('turn');
            
            // Grey out streets based on completion
            allRows.forEach(function(row, idx) {
                if (idx === 0) {
                    // Preflop - always enabled
                    row.classList.remove('hh-street-disabled');
                } else if (idx === 1) {
                    // Flop - disabled until preflop complete
                    if (preflopComplete) {
                        row.classList.remove('hh-street-disabled');
                    } else {
                        row.classList.add('hh-street-disabled');
                    }
                } else if (idx === 2) {
                    // Turn - disabled until flop complete
                    if (preflopComplete && flopComplete) {
                        row.classList.remove('hh-street-disabled');
                    } else {
                        row.classList.add('hh-street-disabled');
                    }
                } else if (idx === 3) {
                    // River - disabled until turn complete
                    if (preflopComplete && flopComplete && turnComplete) {
                        row.classList.remove('hh-street-disabled');
                    } else {
                        row.classList.add('hh-street-disabled');
                    }
                }
            });
            
            // Disable + buttons on completed streets to prevent accidental additions
            var addPreflopBtn = document.getElementById('hh-add-preflop');
            var addFlopBtn = document.getElementById('hh-add-flop');
            var addTurnBtn = document.getElementById('hh-add-turn');
            var addRiverBtn = document.getElementById('hh-add-river');
            
            // Disable + button if street is complete
            if (addPreflopBtn) addPreflopBtn.disabled = preflopComplete;
            if (addFlopBtn) addFlopBtn.disabled = flopComplete;
            if (addTurnBtn) addTurnBtn.disabled = turnComplete;
            if (addRiverBtn) addRiverBtn.disabled = hhIsStreetComplete('river');
            
            // Re-render all streets to show/hide actions based on completion
            streets.forEach(function(st) {
                hhRenderStreet(st);
            });
        }
        
        function hhOnCombinedActionChange(sel) {
            var st = sel.dataset.street;
            var idx = +sel.dataset.idx;
            var value = sel.value;
            
            if (!value) {
                hhStreetActions[st][idx].player = '';
                hhStreetActions[st][idx].action = '';
                hhStreetActions[st][idx].amount = '';
                hhRenderStreet(st);
                return;
            }
            
            // Split "PlayerName::Action"
            var parts = value.split('::');
            if (parts.length === 2) {
                hhStreetActions[st][idx].player = parts[0];
                hhStreetActions[st][idx].action = parts[1];
                hhStreetActions[st][idx].amount = '';
                hhRenderStreet(st);
                hhCheckForFold();
                
                // Focus amount if needed
                if(hhNeedsAmount[parts[1]]){
                    var inp=document.querySelector('.hh-action-amt[data-street="'+st+'"][data-idx="'+idx+'"]');
                    if(inp)setTimeout(function(){inp.focus()},30);
                }
            }
        }
        
        function hhOnAmtChange(inp){hhStreetActions[inp.dataset.street][+inp.dataset.idx].amount=inp.value.trim();}
        function hhOnAmtKey(e,inp){if(e.key==='Enter'){e.preventDefault();inp.blur();}}
        function hhRemoveAction(st,idx){hhStreetActions[st].splice(idx,1);hhRenderStreet(st);hhCheckForFold();hhUpdateStreetStates();}
        var hhStreetLabels={preflop:'Pre-flop',flop:'Flop',turn:'Turn',river:'River'};

        function hhCheckForShowdown() {
            var showdownSection = document.getElementById('hh-showdown-section');
            var showdownPlayers = document.getElementById('hh-showdown-players');
            var outcomeSection = document.getElementById('hh-outcome-section');
            if (!showdownSection || !showdownPlayers) return;
            
            var trackedPlayers = getTrackedPlayers();
            
            // Show outcome input only when tracking 0 or 1 player
            if (outcomeSection) {
                if (trackedPlayers.length <= 1) {
                    outcomeSection.style.display = 'block';
                } else {
                    outcomeSection.style.display = 'none';
                }
            }
            
            // Showdown section only for 2 players
            if (trackedPlayers.length !== 2) {
                showdownSection.style.display = 'none';
                return;
            }
            
            var hasShowdown = false;
            var streets = ['preflop', 'flop', 'turn', 'river'];
            
            // Check for showdown sequences on any street:
            // 1. All-in → Call
            // 2. All-in → All-in
            for (var s = 0; s < streets.length; s++) {
                var acts = hhStreetActions[streets[s]];
                for (var i = 0; i < acts.length - 1; i++) {
                    // All-in followed by Call
                    if (acts[i].action === 'All-in' && acts[i + 1].action === 'Call') {
                        hasShowdown = true;
                        break;
                    }
                    // All-in followed by All-in
                    if (acts[i].action === 'All-in' && acts[i + 1].action === 'All-in') {
                        hasShowdown = true;
                        break;
                    }
                }
                if (hasShowdown) break;
            }
            
            // Check for Check-Check on River only (showdown)
            if (!hasShowdown && hhIsStreetComplete('river')) {
                var riverActs = hhStreetActions['river'];
                if (riverActs && riverActs.length > 0) {
                    var lastAction = null;
                    for (var i = riverActs.length - 1; i >= 0; i--) {
                        if (riverActs[i].action) {
                            lastAction = riverActs[i].action;
                            break;
                        }
                    }
                    // Showdown if River ends with Call or Check (not Fold)
                    if (lastAction === 'Call' || lastAction === 'Check') {
                        hasShowdown = true;
                    }
                }
            }
            
            if (hasShowdown) {
                // Show showdown section and create input fields for each player
                showdownSection.style.display = 'block';
                
                var html = '';
                for (var i = 0; i < trackedPlayers.length; i++) {
                    var playerName = trackedPlayers[i].name.split(' ')[0];
                    html += '<div class="hh-showdown-player">';
                    html += '<div class="hh-showdown-player-name">' + playerName + '</div>';
                    html += '<input type="text" class="hh-showdown-cards-input" placeholder="AsKh" maxlength="4" data-player="' + trackedPlayers[i].name + '">';
                    html += '</div>';
                }
                showdownPlayers.innerHTML = html;
            } else {
                showdownSection.style.display = 'none';
            }
        }
        
        function hhCheckForFold(){
            // Outcome section removed - fold detection no longer needed
        }

        function hhToggleOutcome(el){
            // Outcome section removed
        }
        function hhToggleDetail(el){
            // Outcome section removed
        }

        function hhSetReadonly(on){
            hhIsReadonly=on;
            var card=document.getElementById('hh-card-inner');
            if(card){
                if(on)card.classList.add('readonly');
                else card.classList.remove('readonly');
            }
            ['preflop','flop','turn','river'].forEach(function(st){hhRenderStreet(st);});
        }

        function hhBuildHandData(){
            var player=hhGetPlayerName(hhSelectedSeat)||'Player';
            var pos=hhSelectedPos||'?';
            var time=new Date().toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit',hour12:true});
            var sts=['preflop','flop','turn','river'];
            var lbls={preflop:'PF',flop:'F',turn:'T',river:'R'};
            var parts=[];
            
            for(var s=0;s<sts.length;s++){
                var st=sts[s];
                var acts=hhStreetActions[st].filter(function(a){return a.action});
                if(!acts.length)continue;
                
                var cc=st==='preflop'?'':(document.getElementById('cc-'+st)?document.getElementById('cc-'+st).value.trim():'');
                var chain=acts.map(function(a){
                    var amt=a.amount?' '+parseInt(a.amount).toLocaleString():'';
                    return a.action+amt;
                }).join(' → ');
                
                var label=lbls[st];
                if(cc)chain='['+cc+'] '+chain;
                parts.push(label+': '+chain);
            }
            
            var notesEl=document.getElementById('hh-notes');
            var notes=notesEl?notesEl.value.trim():'';
            if(notes)parts.push('"'+notes+'"');
            
            var outcomeEl=document.getElementById('hh-outcome-input');
            var outcome=outcomeEl?outcomeEl.value.trim():'';
            
            return {
                time:time,
                text:'🃏 '+player+' ('+pos+') — '+parts.join(' | '),
                data:{
                    seat:hhSelectedSeat,
                    pos:hhSelectedPos,
                    streets:JSON.parse(JSON.stringify(hhStreetActions)),
                    communityCards:{
                        flop:document.getElementById('cc-flop')?document.getElementById('cc-flop').value.trim():'',
                        turn:document.getElementById('cc-turn')?document.getElementById('cc-turn').value.trim():'',
                        river:document.getElementById('cc-river')?document.getElementById('cc-river').value.trim():''
                    },
                    outcome:outcome,
                    notes:notes
                }
            };
        }

        function hhHasContent(){return['preflop','flop','turn','river'].some(function(st){return hhStreetActions[st].some(function(a){return a.action})})||hhSelectedOutcome||hhGetPlayerName(hhSelectedSeat);}

        function hhRebuildEntry(entry){var d=entry.data,player=hhGetPlayerName(d.seat),pos=d.pos||'?',sts=['preflop','flop','turn','river'],lbls={preflop:'PF',flop:'F',turn:'T',river:'R'},parts=[];for(var s=0;s<sts.length;s++){var st=sts[s],acts=d.streets[st].filter(function(a){return a.action});if(!acts.length)continue;var pc=st==='preflop'?'':(d.playerCounts[st]||'');var cc=st==='preflop'?'':(d.communityCards?d.communityCards[st]:'');var chain=acts.map(function(a){var amt=a.amount?' '+parseInt(a.amount).toLocaleString():'';var nt=a.note?' ('+a.note+')':'';return a.action+amt+nt}).join(' \u2192 ');var label=lbls[st];if(pc)label+='('+pc+')';if(cc)chain='['+cc+'] '+chain;if(st==='preflop'&&d.pfNote)chain+=' ('+d.pfNote+')';parts.push(label+': '+chain);}if(d.outcome&&d.outcome!=='Fold'){var o=d.outcome;if(o==='Wins'&&d.detail){if(d.detail==='Shows')o+=' \u2014 Shows'+(d.showsHand?' '+d.showsHand:'');else o+=' \u2014 No SD';}parts.push(o);}if(d.notes)parts.push('"'+d.notes+'"');entry.text='\uD83C\uDCCF '+player+' ('+pos+') \u2014 '+parts.join(' | ');return entry;}

        function hhAutoSaveCurrent(){if(!hhHasContent()||!hhGetPlayerName(hhSelectedSeat))return;if(hhCurrentHandIdx>=0){hhSavedHands[hhCurrentHandIdx].data.notes=document.getElementById('hh-notes').value.trim();hhSavedHands[hhCurrentHandIdx]=hhRebuildEntry(hhSavedHands[hhCurrentHandIdx]);}else{hhHandCounter++;var entry=hhBuildHandData();entry.handNum=hhHandCounter;hhSavedHands.push(entry);hhCurrentHandIdx=hhSavedHands.length-1;}}

        function hhSaveAndNext() {
            console.log('Save & Next clicked');
            console.log('Current index:', hhCurrentHandIdx);
            console.log('Saved hands:', hhSavedHands.length);
            
            // Build hand data
            try {
                var entry = hhBuildHandData();
                entry.handNum = hhCurrentHandIdx;
                
                if (hhCurrentHandIdx <= hhSavedHands.length) {
                    // Update existing hand (array is 0-indexed, so Hand #1 is at position 0)
                    console.log('Updating Hand #' + hhCurrentHandIdx);
                    hhSavedHands[hhCurrentHandIdx - 1] = entry;
                } else {
                    // Create new hand
                    console.log('Creating new Hand #' + hhCurrentHandIdx);
                    hhHandCounter++;
                    hhSavedHands.push(entry);
                }
                
                console.log('Saved. Total hands:', hhSavedHands.length);
            } catch (e) {
                console.error('Error saving hand:', e);
            }
            
            // Move to next hand (new entry)
            hhCurrentHandIdx = hhSavedHands.length + 1;
            console.log('Moving to Hand #' + hhCurrentHandIdx);
            
            // Clear for next entry
            hhStreetActions = {preflop:[], flop:[], turn:[], river:[]};
            
            var notesInput = document.getElementById('hh-notes');
            if (notesInput) notesInput.value = '';
            
            ['flop','turn','river'].forEach(function(st){
                var ccInput = document.getElementById('cc-' + st);
                if (ccInput) ccInput.value = '';
            });
            
            var outcomeInput = document.getElementById('hh-outcome-input');
            if (outcomeInput) outcomeInput.value = '';
            
            // Update UI
            hhSetReadonly(false);
            hhUpdateHandNumber();
            hhUpdateStreetStates();
            ['preflop', 'flop', 'turn', 'river'].forEach(function(st) {
                hhRenderStreet(st);
            });
            hhUpdateNavButtons();
        }
        
        function hhUpdateNavButtons() {
            var prevBtn = document.querySelector('.hh-nav-btn[onclick*="hhPrevHand"]');
            var nextBtn = document.querySelector('.hh-nav-btn[onclick*="hhNextHand"]');
            
            if (prevBtn) {
                // Disable prev if at first hand (index 1)
                if (hhCurrentHandIdx <= 1) {
                    prevBtn.disabled = true;
                    prevBtn.style.opacity = '0.3';
                    prevBtn.style.cursor = 'not-allowed';
                } else {
                    prevBtn.disabled = false;
                    prevBtn.style.opacity = '1';
                    prevBtn.style.cursor = 'pointer';
                }
            }
            
            if (nextBtn) {
                // Disable next if already on new hand (beyond saved hands)
                if (hhCurrentHandIdx > hhSavedHands.length) {
                    nextBtn.disabled = true;
                    nextBtn.style.opacity = '0.3';
                    nextBtn.style.cursor = 'not-allowed';
                } else {
                    nextBtn.disabled = false;
                    nextBtn.style.opacity = '1';
                    nextBtn.style.cursor = 'pointer';
                }
            }
        }
        
        function hhPrevHand(){
            if (hhCurrentHandIdx <= 1) return;
            hhAutoSaveCurrent();
            hhCurrentHandIdx--;
            hhLoadHand(hhCurrentHandIdx);
            hhUpdateNavButtons();
        }
        
        function hhNextHand(){
            if (hhCurrentHandIdx > hhSavedHands.length) return;
            hhAutoSaveCurrent();
            hhCurrentHandIdx++;
            
            if (hhCurrentHandIdx <= hhSavedHands.length) {
                // Load saved hand
                hhLoadHand(hhCurrentHandIdx);
            } else {
                // Clear for new hand
                hhStreetActions = {preflop:[], flop:[], turn:[], river:[]};
                var notesInput = document.getElementById('hh-notes');
                if (notesInput) notesInput.value = '';
                ['flop','turn','river'].forEach(function(st){
                    var ccInput = document.getElementById('cc-' + st);
                    if (ccInput) ccInput.value = '';
                });
                var outcomeInput = document.getElementById('hh-outcome-input');
                if (outcomeInput) outcomeInput.value = '';
                
                hhSetReadonly(false);
                hhUpdateHandNumber();
                hhUpdateStreetStates();
                ['preflop', 'flop', 'turn', 'river'].forEach(function(st) {
                    hhRenderStreet(st);
                });
            }
            
            hhUpdateNavButtons();
        }

        function hhLoadHand(index){
            console.log('Loading Hand #' + index);
            
            // Hand #1 is at array position 0, Hand #2 at position 1, etc.
            var arrayPos = index - 1;
            var h = hhSavedHands[arrayPos];
            
            if(!h || !h.data) {
                console.log('No hand data for Hand #' + index);
                return;
            }
            
            hhCurrentHandIdx = index;
            var d = h.data;
            
            // Set player and position
            hhSelectedSeat = d.seat;
            hhSelectedPos = d.pos || '';
            
            // Update position chips
            document.querySelectorAll('.hh-pos-chip').forEach(function(c){
                if(d.pos && c.dataset.pos === d.pos) {
                    c.classList.add('active');
                } else {
                    c.classList.remove('active');
                }
            });
            
            // Load street actions
            hhStreetActions = JSON.parse(JSON.stringify(d.streets));
            
            // Load cards
            ['flop','turn','river'].forEach(function(st){
                var ccInput = document.getElementById('cc-' + st);
                if (ccInput && d.communityCards) {
                    ccInput.value = d.communityCards[st] || '';
                }
            });
            
            // Load notes
            var notesInput = document.getElementById('hh-notes');
            if (notesInput) {
                notesInput.value = d.notes || '';
            }
            
            // Load outcome
            var outcomeInput = document.getElementById('hh-outcome-input');
            if (outcomeInput) {
                outcomeInput.value = d.outcome || '';
            }
            
            // Update UI - editable
            hhSetReadonly(false);
            hhUpdateHandNumber();
            hhUpdateStreetStates();
            ['preflop', 'flop', 'turn', 'river'].forEach(function(st) {
                hhRenderStreet(st);
            });
            hhUpdateNavButtons();
            
            console.log('Hand #' + index + ' loaded');
        }

        function hhNewHand(preservePlayerAndPosition){
            try {
                console.log('hhNewHand called, preserve:', preservePlayerAndPosition);
                hhCurrentHandIdx = -1;
                hhStreetActions = {preflop:[], flop:[], turn:[], river:[]};
                console.log('Street actions cleared');
                
                // Save current selections if preserving
                var savedSeat = preservePlayerAndPosition ? hhSelectedSeat : null;
                var savedPos = preservePlayerAndPosition ? hhSelectedPos : '';
                console.log('Saved seat:', savedSeat, 'Saved pos:', savedPos);
                
                // Reset player and position
                hhSelectedSeat = savedSeat; // Keep seat if preserving, otherwise null
                hhSelectedPos = savedPos; // Keep position if preserving, otherwise ''
                
                // Reset position chips (then restore if preserving)
                document.querySelectorAll('.hh-pos-chip').forEach(function(c){
                    c.classList.remove('active');
                });
                
                if (savedPos) {
                    document.querySelectorAll('.hh-pos-chip').forEach(function(c){
                        if(c.dataset.pos === savedPos) {
                            c.classList.add('active');
                        }
                    });
                    console.log('Restored position:', hhSelectedPos);
                }
                
                // Clear notes and cards
                var notesInput = document.getElementById('hh-notes');
                if (notesInput) notesInput.value = '';
                
                ['flop','turn','river'].forEach(function(st){
                    var ccInput = document.getElementById('cc-' + st);
                    if (ccInput) ccInput.value = '';
                });
                
                // Clear outcome input
                var outcomeInput = document.getElementById('hh-outcome-input');
                if (outcomeInput) outcomeInput.value = '';
                
                console.log('About to call hhSetReadonly...');
                hhSetReadonly(false);
                console.log('hhSetReadonly completed');
                
                console.log('About to call hhUpdateHandNumber...');
                hhUpdateHandNumber();
                console.log('hhUpdateHandNumber completed');
                
                console.log('About to call hhUpdateStreetStates...');
                hhUpdateStreetStates();
                console.log('hhUpdateStreetStates completed');
                
                console.log('About to re-render streets...');
                // Re-render all streets to ensure they display properly
                ['preflop', 'flop', 'turn', 'river'].forEach(function(st) {
                    hhRenderStreet(st);
                });
                console.log('Streets re-rendered. Current hand index:', hhCurrentHandIdx);
                
                hhUpdateNavButtons();
            } catch (e) {
                console.error('Error in hhNewHand:', e);
            }
        }

        function hhUpdateHandNumber(){
            var el=document.getElementById('hh-hand-number');
            var nav=document.getElementById('hh-nav-counter');
            
            // Title always shows current index
            el.textContent = 'Hand #' + hhCurrentHandIdx;
            
            // Counter shows position
            if (hhCurrentHandIdx <= hhSavedHands.length) {
                // Viewing a saved hand
                nav.innerHTML = hhCurrentHandIdx + ' / ' + hhSavedHands.length;
            } else {
                // On a new unsaved hand
                nav.innerHTML = hhCurrentHandIdx + ' / ' + hhCurrentHandIdx;
            }
        }

        // ===== HAND TRACKER STATE =====
        let hhTrackerHero = null;
        let hhTrackerHeroFirstName = null;
        let hhTrackerHeroPosition = null;
        let hhTrackerVillainName = null;
        let hhTrackerVillainFirstName = null;
        let hhTrackerVillainPosition = null;
        let hhTrackerPositionType = null;
        let hhTrackerCurrentStreet = 'preflop';
        let hhTrackerStreetActions = { preflop: [], flop: [], turn: [], river: [] };
        let hhTrackerCommunityCards = { flop: '', turn: '', river: '' };
        let hhTrackerPendingAction = null;
        let hhTrackerNextActor = null;
        let hhTrackerWinner = null;
        
        // Hand storage
        let hhStoredHands = [];
        let hhCurrentHandNumber = 1;
        let hhViewingHandNumber = null; // null means current live hand
        
        const hhPositionHierarchy = ['SB', 'BB', 'UTG', 'MP', 'HJ', 'CO', 'BTN'];
        const hhPreflopSequence = ['UTG', 'MP', 'HJ', 'CO', 'BTN', 'SB', 'BB'];
        const hhPostflopSequence = ['SB', 'BB', 'UTG', 'MP', 'HJ', 'CO', 'BTN'];

        // ===== HAND TRACKER FUNCTIONS =====
        function hhOnHeroSelect() {
            const select = document.getElementById('hh-hero-select');
            hhTrackerHero = select.value;
            
            // Extract first name
            if (hhTrackerHero) {
                hhTrackerHeroFirstName = hhTrackerHero.split(' ')[0];
            } else {
                hhTrackerHeroFirstName = null;
            }
            
            if (hhTrackerHero) {
                // Show position selection immediately
                document.getElementById('hh-position-row').style.display = 'block';
                
                // Set instruction with hero's name in dark teal
                const instruction = document.getElementById('hh-position-instruction');
                if (instruction) {
                    instruction.innerHTML = `Select position for <span style="color: #4db8a8;">${hhTrackerHeroFirstName}</span>`;
                }
                
                // Populate villain dropdown with all players except selected hero
                const villainSelect = document.getElementById('hh-villain-select');
                villainSelect.innerHTML = '<option value="">-- Generic Villain --</option>';
                
                if (database && database.realPlayers) {
                    database.realPlayers.forEach(player => {
                        if (player.name !== hhTrackerHero) {
                            const option = document.createElement('option');
                            option.value = player.name;
                            option.textContent = player.name;
                            villainSelect.appendChild(option);
                        }
                    });
                }
            } else {
                // Hide everything if no hero selected
                document.getElementById('hh-villain-select-row').style.display = 'none';
                document.getElementById('hh-position-row').style.display = 'none';
                document.getElementById('hh-street-card').style.display = 'none';
            }
        }
        
        function hhOnVillainSelect() {
            const select = document.getElementById('hh-villain-select');
            const selectedVillain = select.value;
            
            // Extract first name for villain if a player was selected
            if (selectedVillain) {
                hhTrackerVillainName = selectedVillain;
                hhTrackerVillainFirstName = selectedVillain.split(' ')[0];
            } else {
                hhTrackerVillainName = null;
                hhTrackerVillainFirstName = null;
            }
        }
        
        function hhSelectSharedPosition(pos) {
            const instruction = document.getElementById('hh-position-instruction');
            const chip = event.target;
            
            // First click - selecting Player 1's position
            if (!hhTrackerHeroPosition) {
                hhTrackerHeroPosition = pos;
                chip.classList.add('active');
                chip.style.background = 'linear-gradient(135deg, #4db8a8 0%, #3a9688 100%)'; // Teal
                
                // Update instruction for Player 2 with actual names
                const villainName = hhTrackerVillainFirstName || 'Villain';
                instruction.innerHTML = `Now select position for <span style="color: #ffa726;">${villainName}</span>`;
                
                // Only show villain selection dropdown if villain not already selected
                if (!hhTrackerVillainName && !hhTrackerVillainFirstName) {
                    document.getElementById('hh-villain-select-row').style.display = 'block';
                }
                
                return;
            }
            
            // Second click - selecting Player 2's position
            if (!hhTrackerVillainPosition) {
                // Don't allow same position
                if (pos === hhTrackerHeroPosition) {
                    return;
                }
                
                hhTrackerVillainPosition = pos;
                chip.classList.add('active');
                chip.style.background = 'linear-gradient(135deg, #ffa726 0%, #fb8c00 100%)'; // Orange
                
                // Calculate IP/OOP
                if (hhTrackerHeroPosition === 'BTN') {
                    hhTrackerPositionType = 'IP';
                } else if (hhTrackerHeroPosition === 'SB') {
                    hhTrackerPositionType = 'OOP';
                } else {
                    const heroIdx = hhPositionHierarchy.indexOf(hhTrackerHeroPosition);
                    const villainIdx = hhPositionHierarchy.indexOf(hhTrackerVillainPosition);
                    hhTrackerPositionType = (heroIdx < villainIdx) ? 'OOP' : 'IP';
                }
                
                hhFinalizeSetup();
            }
        }
        
        function hhFinalizeSetup() {
            // Hide all selection elements
            document.getElementById('hh-hero-select-row').style.display = 'none';
            document.getElementById('hh-villain-select-row').style.display = 'none';
            document.getElementById('hh-position-row').style.display = 'none';
            
            // Set hero name and position
            document.getElementById('hh-readonly-hero').textContent = hhTrackerHero;
            document.getElementById('hh-readonly-position').textContent = hhTrackerHeroPosition;
            
            // Set villain name and position with proper formatting
            const villainName = hhTrackerVillainName || 'Villain';
            const villainReadonly = document.getElementById('hh-readonly-villain');
            villainReadonly.innerHTML = `${villainName} <span style="color: #5a5e66;">(${hhTrackerVillainPosition})</span>`;
            
            document.getElementById('hh-setup-readonly').style.display = 'block';
            
            hhStartHand();
            
            // Save initial hand state
            hhSaveCurrentHandState();
        }
        
        function hhStartHand() {
            hhTrackerCurrentStreet = 'preflop';
            hhTrackerStreetActions = { preflop: [], flop: [], turn: [], river: [] };
            
            const heroIdx = hhPreflopSequence.indexOf(hhTrackerHeroPosition);
            const villainIdx = hhPreflopSequence.indexOf(hhTrackerVillainPosition);
            hhTrackerNextActor = (heroIdx < villainIdx) ? 'hero' : 'villain';
            
            hhShowStreet('preflop');
            document.getElementById('hh-street-card').style.display = 'block';
        }
        
        function hhShowStreet(street) {
            hhTrackerCurrentStreet = street;
            
            const streetNames = { preflop: 'PreFlop', flop: 'Flop', turn: 'Turn', river: 'River' };
            document.getElementById('hh-street-name').textContent = streetNames[street];
            
            const cardsInput = document.getElementById('hh-community-cards');
            if (street !== 'preflop') {
                cardsInput.style.display = 'block';
                cardsInput.placeholder = street === 'flop' ? 'Flop cards' : (street === 'turn' ? 'Turn card' : 'River card');
                cardsInput.value = hhTrackerCommunityCards[street] || '';
                cardsInput.oninput = function() { hhTrackerCommunityCards[street] = this.value; };
            } else {
                cardsInput.style.display = 'none';
            }
            
            if (street !== 'preflop') {
                hhTrackerNextActor = (hhTrackerPositionType === 'OOP') ? 'hero' : 'villain';
            }
            
            hhRenderActions();
            hhShowActionButtons();
        }
        
        function hhRenderActions() {
            const container = document.getElementById('hh-action-history');
            container.innerHTML = '';
            
            const actions = hhTrackerStreetActions[hhTrackerCurrentStreet];
            actions.forEach(item => {
                const div = document.createElement('div');
                div.className = 'hh-action-item ' + item.actor;
                let text;
                if (item.actor === 'hero') {
                    text = hhTrackerHeroFirstName + ': ';
                } else {
                    const villainName = hhTrackerVillainFirstName || 'Villain';
                    text = villainName + ': ';
                }
                text += item.action;
                if (item.amount) text += ' ' + item.amount;
                div.textContent = text;
                container.appendChild(div);
            });
        }
        
        function hhGetValidActions() {
            const actions = hhTrackerStreetActions[hhTrackerCurrentStreet];
            
            if (actions.length === 0) {
                if (hhTrackerCurrentStreet === 'preflop') {
                    if (hhTrackerHeroPosition === 'BB' && hhTrackerNextActor === 'hero') {
                        return ['Check', 'Raise', 'All-in'];
                    } else {
                        return ['Limp', 'Raise', 'All-in'];
                    }
                } else {
                    return ['Check', 'Bet', 'All-in'];
                }
            }
            
            const lastAction = actions[actions.length - 1].action;
            
            if (hhTrackerCurrentStreet === 'preflop') {
                if (lastAction === 'Limp') {
                    if ((hhTrackerNextActor === 'hero' && hhTrackerHeroPosition === 'BB') || 
                        (hhTrackerNextActor === 'villain' && hhTrackerVillainPosition === 'BB')) {
                        return ['Check', 'Call', 'Raise', 'Re-Raise', 'All-in', 'Fold'];
                    } else {
                        return ['Call', 'Raise', 'Re-Raise', 'All-in', 'Fold'];
                    }
                } else if (lastAction === 'Raise') {
                    return ['Call', 'Re-Raise', 'All-in', 'Fold'];
                } else if (lastAction === 'Re-Raise') {
                    return ['Call', 'Re-Raise', 'All-in', 'Fold'];
                } else if (lastAction === 'All-in') {
                    return ['Call', 'Fold'];
                } else if (lastAction === 'Check') {
                    return ['Check', 'Raise', 'All-in'];
                }
            }
            
            if (lastAction === 'Check') {
                return ['Check', 'Bet', 'All-in'];
            } else if (lastAction === 'Bet') {
                return ['Call', 'Raise', 'Re-Raise', 'All-in', 'Fold'];
            } else if (lastAction === 'Raise') {
                return ['Call', 'Re-Raise', 'All-in', 'Fold'];
            } else if (lastAction === 'Re-Raise') {
                return ['Call', 'Re-Raise', 'All-in', 'Fold'];
            } else if (lastAction === 'All-in') {
                return ['Call', 'Fold'];
            }
            
            return ['Check', 'Call', 'Raise', 'Re-Raise', 'Fold', 'All-in'];
        }
        
        function hhShowActionButtons() {
            const container = document.getElementById('hh-action-buttons');
            container.innerHTML = '';
            
            const actorDisplay = document.getElementById('hh-actor-display');
            actorDisplay.classList.remove('flash');
            void actorDisplay.offsetWidth;
            
            if (hhTrackerNextActor === 'hero') {
                actorDisplay.textContent = ` - ${hhTrackerHeroFirstName}'s Action`;
                actorDisplay.className = 'hh-actor-name hero active';
            } else {
                const villainName = hhTrackerVillainFirstName || 'Villain';
                actorDisplay.textContent = ` - ${villainName}'s Action`;
                actorDisplay.className = 'hh-actor-name villain active';
            }
            
            const actions = hhGetValidActions();
            actions.forEach(action => {
                const btn = document.createElement('button');
                btn.className = 'hh-action-btn';
                btn.textContent = action;
                btn.onclick = () => hhSelectAction(action);
                container.appendChild(btn);
            });
        }
        
        function hhSelectAction(action) {
            hhTrackerPendingAction = action;
            document.getElementById('hh-action-buttons').innerHTML = '';
            
            if (action === 'Bet' || action === 'Raise' || action === 'Re-Raise' || action === 'All-in') {
                document.getElementById('hh-amount-row').classList.add('visible');
                document.getElementById('hh-amount-input').value = '';
                document.getElementById('hh-amount-input').focus();
            } else {
                hhCommitAction(null);
            }
        }
        
        function hhCommitCurrentAction() {
            const amount = document.getElementById('hh-amount-input').value.trim();
            hhCommitAction(amount || null);
        }
        
        function hhCommitAction(amount) {
            document.getElementById('hh-amount-row').classList.remove('visible');
            
            hhTrackerStreetActions[hhTrackerCurrentStreet].push({
                actor: hhTrackerNextActor,
                action: hhTrackerPendingAction,
                amount: amount
            });
            
            hhRenderActions();
            
            // Save current hand state in real-time
            hhSaveCurrentHandState();
            
            if (hhCheckStreetComplete()) {
                return;
            }
            
            hhTrackerNextActor = (hhTrackerNextActor === 'hero') ? 'villain' : 'hero';
            hhShowActionButtons();
        }
        
        function hhCheckStreetComplete() {
            const actions = hhTrackerStreetActions[hhTrackerCurrentStreet];
            if (actions.length < 2) return false;
            
            const lastAction = actions[actions.length - 1];
            const secondLastAction = actions[actions.length - 2];
            
            if (lastAction.action === 'Fold') {
                hhEndHand('fold');
                return true;
            }
            
            if (lastAction.action === 'Check' && secondLastAction.action === 'Check') {
                hhAdvanceStreet();
                return true;
            }
            
            if (lastAction.action === 'Check' && secondLastAction.action === 'Limp') {
                hhAdvanceStreet();
                return true;
            }
            
            if (lastAction.action === 'Call' && secondLastAction.action === 'Limp') {
                hhAdvanceStreet();
                return true;
            }
            
            if ((secondLastAction.action === 'Bet' || secondLastAction.action === 'Raise' || secondLastAction.action === 'Re-Raise') 
                && lastAction.action === 'Call') {
                hhAdvanceStreet();
                return true;
            }
            
            if (secondLastAction.action === 'All-in' && lastAction.action === 'Call') {
                hhHandleAllInCall();
                return true;
            }
            
            if (secondLastAction.action === 'All-in' && lastAction.action === 'Fold') {
                hhEndHand('fold');
                return true;
            }
            
            return false;
        }
        
        function hhAdvanceStreet() {
            const streets = ['preflop', 'flop', 'turn', 'river'];
            const currentIndex = streets.indexOf(hhTrackerCurrentStreet);
            
            if (currentIndex < streets.length - 1) {
                hhShowStreet(streets[currentIndex + 1]);
            } else {
                hhShowShowdown();
            }
        }
        
        function hhHandleAllInCall() {
            hhShowShowdown();
        }
        
        function hhEndHand(reason) {
            document.getElementById('hh-street-card').style.display = 'none';
            hhShowResults(reason);
        }
        
        function hhShowShowdown() {
            document.getElementById('hh-street-card').style.display = 'none';
            hhShowResults('showdown');
        }
        
        function hhShowResults(reason) {
            const resultsCard = document.getElementById('hh-results-card');
            const resultsTitle = document.getElementById('hh-results-title');
            const summaryDiv = document.getElementById('hh-hand-summary');
            
            resultsTitle.textContent = reason === 'fold' ? 'Hand Complete - Fold' : 'Showdown';
            
            let summary = '<div class="hh-hand-summary">';
            const streets = ['preflop', 'flop', 'turn', 'river'];
            let accumulatedCards = '';
            
            streets.forEach(street => {
                const actions = hhTrackerStreetActions[street];
                if (actions.length > 0) {
                    const streetNames = { preflop: 'PreFlop', flop: 'Flop', turn: 'Turn', river: 'River' };
                    
                    summary += '<div class="hh-summary-street">';
                    summary += '<div class="hh-summary-street-name">';
                    summary += '<span style="text-transform: uppercase;">' + streetNames[street] + '</span>';
                    
                    if (street !== 'preflop' && hhTrackerCommunityCards[street]) {
                        if (accumulatedCards) accumulatedCards += ' ';
                        accumulatedCards += hhTrackerCommunityCards[street];
                        summary += ' <span>[' + accumulatedCards + ']</span>';
                    } else if (street !== 'preflop' && accumulatedCards) {
                        summary += ' <span>[' + accumulatedCards + ']</span>';
                    }
                    
                    summary += '</div>';
                    
                    actions.forEach(item => {
                        summary += '<div class="hh-summary-action ' + item.actor + '">';
                        if (item.actor === 'hero') {
                            summary += hhTrackerHeroFirstName + ': ';
                        } else {
                            const villainName = hhTrackerVillainFirstName || 'Villain';
                            summary += villainName + ': ';
                        }
                        summary += item.action;
                        if (item.amount) summary += ' ' + item.amount;
                        summary += '</div>';
                    });
                    
                    summary += '</div>';
                }
            });
            
            summary += '</div>';
            summaryDiv.innerHTML = summary;
            resultsCard.style.display = 'block';
            
            // Update winner button text to show player names
            const heroBtn = document.getElementById('hh-winner-btn-hero');
            const villainBtn = document.getElementById('hh-winner-btn-villain');
            if (heroBtn && hhTrackerHeroFirstName) {
                heroBtn.textContent = hhTrackerHeroFirstName;
            }
            if (villainBtn) {
                const villainName = hhTrackerVillainFirstName || 'Villain';
                villainBtn.textContent = villainName;
            }
            
            // Show notes and navigation sections
            document.getElementById('hh-notes-section').style.display = 'block';
            document.getElementById('hh-navigation-section').style.display = 'block';
        }
        
        function hhSetWinner(who) {
            hhTrackerWinner = who;
            document.querySelectorAll('#hh-results-card .hh-toggle-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }
        
        function hhSkipStreet() {
            hhAdvanceStreet();
        }
        
        function hhNextHandDifferentPlayers() {
            // Finalize and save current hand to completed storage
            hhFinalizeCurrentHand();
            
            // Increment hand number (keep counter going)
            hhCurrentHandNumber++;
            hhViewingHandNumber = null; // Back to live mode
            hhUpdateHandNumberDisplay();
            
            // Clear player data - user will select new players
            hhTrackerHero = null;
            hhTrackerHeroFirstName = null;
            hhTrackerHeroPosition = null;
            hhTrackerVillainName = null;
            hhTrackerVillainFirstName = null;
            hhTrackerVillainPosition = null;
            hhTrackerPositionType = null;
            hhTrackerCurrentStreet = 'preflop';
            hhTrackerStreetActions = { preflop: [], flop: [], turn: [], river: [] };
            hhTrackerCommunityCards = { flop: '', turn: '', river: '' };
            hhTrackerPendingAction = null;
            hhTrackerNextActor = null;
            hhTrackerWinner = null;
            
            // Clear dropdowns
            document.getElementById('hh-hero-select').value = '';
            document.getElementById('hh-villain-select').value = '';
            
            // Go back to player selection screen
            document.getElementById('hh-hero-select-row').style.display = 'block';
            document.getElementById('hh-villain-select-row').style.display = 'none';
            document.getElementById('hh-position-row').style.display = 'none';
            document.getElementById('hh-setup-readonly').style.display = 'none';
            document.getElementById('hh-street-card').style.display = 'none';
            document.getElementById('hh-results-card').style.display = 'none';
            document.getElementById('hh-notes-section').style.display = 'none';
            
            // Keep navigation visible so user can view history
            document.getElementById('hh-navigation-section').style.display = 'block';
            
            // Reset all chips and inputs
            document.querySelectorAll('.hh-pos-chip').forEach(chip => {
                chip.classList.remove('active', 'disabled');
                chip.style.background = '';
                chip.style.opacity = '1';
                chip.style.cursor = 'pointer';
            });
            document.querySelectorAll('.hh-toggle-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById('hh-hero-cards').value = '';
            document.getElementById('hh-villain-cards').value = '';
            document.getElementById('hh-hand-notes').value = '';
        }
        
        function hhNextHand() {
            // Finalize and save current hand to completed storage
            hhFinalizeCurrentHand();
            
            // Increment hand number
            hhCurrentHandNumber++;
            hhViewingHandNumber = null; // Back to live mode
            hhUpdateHandNumberDisplay();
            
            // Save current player names
            const savedHero = hhTrackerHero;
            const savedHeroFirstName = hhTrackerHeroFirstName;
            const savedVillainName = hhTrackerVillainName;
            const savedVillainFirstName = hhTrackerVillainFirstName;
            
            // Reset positions and hand data
            hhTrackerHeroPosition = null;
            hhTrackerVillainPosition = null;
            hhTrackerPositionType = null;
            hhTrackerCurrentStreet = 'preflop';
            hhTrackerStreetActions = { preflop: [], flop: [], turn: [], river: [] };
            hhTrackerCommunityCards = { flop: '', turn: '', river: '' };
            hhTrackerPendingAction = null;
            hhTrackerNextActor = null;
            hhTrackerWinner = null;
            
            // Restore player names
            hhTrackerHero = savedHero;
            hhTrackerHeroFirstName = savedHeroFirstName;
            hhTrackerVillainName = savedVillainName;
            hhTrackerVillainFirstName = savedVillainFirstName;
            
            // Keep dropdowns populated with current selections
            document.getElementById('hh-hero-select').value = savedHero || '';
            document.getElementById('hh-villain-select').value = savedVillainName || '';
            
            // Show position selection
            document.getElementById('hh-hero-select-row').style.display = 'none';
            document.getElementById('hh-villain-select-row').style.display = 'none';
            document.getElementById('hh-position-row').style.display = 'block';
            document.getElementById('hh-setup-readonly').style.display = 'none';
            document.getElementById('hh-street-card').style.display = 'none';
            document.getElementById('hh-results-card').style.display = 'none';
            document.getElementById('hh-notes-section').style.display = 'none';
            
            // Show navigation section so user can view history while setting up new hand
            document.getElementById('hh-navigation-section').style.display = 'block';
            
            // Reset position instruction with player names
            const instruction = document.getElementById('hh-position-instruction');
            if (instruction && savedHeroFirstName) {
                instruction.innerHTML = `Select position for <span style="color: #4db8a8;">${savedHeroFirstName}</span>`;
            }
            
            // Reset all position chips
            document.querySelectorAll('.hh-pos-chip').forEach(chip => {
                chip.classList.remove('active', 'disabled');
                chip.style.background = '';
                chip.style.opacity = '1';
                chip.style.cursor = 'pointer';
            });
            document.querySelectorAll('.hh-toggle-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById('hh-hero-cards').value = '';
            document.getElementById('hh-villain-cards').value = '';
            document.getElementById('hh-hand-notes').value = '';
            
            // Repopulate villain dropdown with all players except hero
            if (savedHero && database && database.realPlayers) {
                const villainSelect = document.getElementById('hh-villain-select');
                villainSelect.innerHTML = '<option value="">-- Generic Villain --</option>';
                
                database.realPlayers.forEach(player => {
                    if (player.name !== savedHero) {
                        const option = document.createElement('option');
                        option.value = player.name;
                        option.textContent = player.name;
                        villainSelect.appendChild(option);
                    }
                });
                
                // Restore villain selection if it existed
                if (savedVillainName) {
                    villainSelect.value = savedVillainName;
                }
            }
        }
        
        function hhResetHand() {
            hhTrackerHero = null;
            hhTrackerHeroFirstName = null;
            hhTrackerHeroPosition = null;
            hhTrackerVillainName = null;
            hhTrackerVillainFirstName = null;
            hhTrackerVillainPosition = null;
            hhTrackerPositionType = null;
            hhTrackerCurrentStreet = 'preflop';
            hhTrackerStreetActions = { preflop: [], flop: [], turn: [], river: [] };
            hhTrackerCommunityCards = { flop: '', turn: '', river: '' };
            hhTrackerPendingAction = null;
            hhTrackerNextActor = null;
            hhTrackerWinner = null;
            
            document.getElementById('hh-hero-select').value = '';
            document.getElementById('hh-villain-select').value = '';
            document.getElementById('hh-hero-select-row').style.display = 'block';
            document.getElementById('hh-villain-select-row').style.display = 'none';
            document.getElementById('hh-position-row').style.display = 'none';
            document.getElementById('hh-setup-readonly').style.display = 'none';
            document.getElementById('hh-street-card').style.display = 'none';
            document.getElementById('hh-results-card').style.display = 'none';
            document.getElementById('hh-notes-section').style.display = 'none';
            document.getElementById('hh-navigation-section').style.display = 'none';
            
            // Reset position instruction
            const instruction = document.getElementById('hh-position-instruction');
            if (instruction) {
                instruction.textContent = 'Click to select Player 1\'s position';
            }
            
            // Reset all position chips
            document.querySelectorAll('.hh-pos-chip').forEach(chip => {
                chip.classList.remove('active', 'disabled');
                chip.style.background = '';
                chip.style.opacity = '1';
                chip.style.cursor = 'pointer';
            });
            document.querySelectorAll('.hh-toggle-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById('hh-hero-cards').value = '';
            document.getElementById('hh-villain-cards').value = '';
        }
        
        // Hand storage functions
        function hhGetCurrentHandData() {
            // Capture current hand state
            return {
                handNumber: hhCurrentHandNumber,
                hero: hhTrackerHero,
                heroFirstName: hhTrackerHeroFirstName,
                heroPosition: hhTrackerHeroPosition,
                villainName: hhTrackerVillainName,
                villainFirstName: hhTrackerVillainFirstName,
                villainPosition: hhTrackerVillainPosition,
                positionType: hhTrackerPositionType,
                streetActions: JSON.parse(JSON.stringify(hhTrackerStreetActions)),
                communityCards: JSON.parse(JSON.stringify(hhTrackerCommunityCards)),
                winner: hhTrackerWinner,
                heroCards: document.getElementById('hh-hero-cards')?.value || '',
                villainCards: document.getElementById('hh-villain-cards')?.value || '',
                notes: document.getElementById('hh-hand-notes')?.value || '',
                timestamp: new Date().toISOString(),
                inProgress: true
            };
        }
        
        function hhSaveCurrentHandState() {
            // Real-time save - updates the current hand in storage
            const handData = hhGetCurrentHandData();
            
            // Find if current hand already exists in storage
            const existingIndex = hhStoredHands.findIndex(h => h.handNumber === hhCurrentHandNumber);
            if (existingIndex >= 0) {
                // Update existing
                hhStoredHands[existingIndex] = handData;
            } else {
                // Add new
                hhStoredHands.push(handData);
            }
        }
        
        function hhFinalizeCurrentHand() {
            // Mark hand as complete and finalize
            const handData = hhGetCurrentHandData();
            handData.inProgress = false;
            
            const existingIndex = hhStoredHands.findIndex(h => h.handNumber === hhCurrentHandNumber);
            if (existingIndex >= 0) {
                hhStoredHands[existingIndex] = handData;
            } else {
                hhStoredHands.push(handData);
            }
        }
        
        function hhUpdateHandNumberDisplay() {
            const display = document.getElementById('hh-hand-number');
            if (display) {
                if (hhViewingHandNumber !== null) {
                    display.textContent = `#${hhViewingHandNumber} (viewing)`;
                    display.style.color = '#ffa726';
                } else {
                    display.textContent = `#${hhCurrentHandNumber}`;
                    display.style.color = '#8a8e96';
                }
            }
        }
        
        function hhPreviousHand() {
            if (hhViewingHandNumber === null) {
                // Currently viewing live hand, go to most recent stored
                if (hhStoredHands.length === 0) return;
                hhViewingHandNumber = hhStoredHands[hhStoredHands.length - 1].handNumber;
            } else {
                // Find previous hand
                const currentIndex = hhStoredHands.findIndex(h => h.handNumber === hhViewingHandNumber);
                if (currentIndex > 0) {
                    hhViewingHandNumber = hhStoredHands[currentIndex - 1].handNumber;
                }
            }
            hhLoadStoredHand(hhViewingHandNumber);
        }
        
        function hhNextStoredHand() {
            if (hhViewingHandNumber === null) return; // Already at live hand
            
            const currentIndex = hhStoredHands.findIndex(h => h.handNumber === hhViewingHandNumber);
            if (currentIndex < hhStoredHands.length - 1) {
                // Go to next stored hand
                hhViewingHandNumber = hhStoredHands[currentIndex + 1].handNumber;
                hhLoadStoredHand(hhViewingHandNumber);
            } else {
                // Check if next hand is the current hand
                const nextHandNumber = hhStoredHands[currentIndex].handNumber + 1;
                if (nextHandNumber === hhCurrentHandNumber) {
                    // Return to current live hand
                    hhViewingHandNumber = null;
                    hhReturnToLiveHand();
                } else {
                    // Already at the end
                    hhViewingHandNumber = null;
                    hhUpdateHandNumberDisplay();
                }
            }
        }
        
        function hhLoadStoredHand(handNumber) {
            const hand = hhStoredHands.find(h => h.handNumber === handNumber);
            if (!hand) return;
            
            const isCurrentHand = (handNumber === hhCurrentHandNumber);
            
            // Load hand data into display
            hhTrackerHero = hand.hero;
            hhTrackerHeroFirstName = hand.heroFirstName;
            hhTrackerHeroPosition = hand.heroPosition;
            hhTrackerVillainName = hand.villainName;
            hhTrackerVillainFirstName = hand.villainFirstName;
            hhTrackerVillainPosition = hand.villainPosition;
            hhTrackerPositionType = hand.positionType;
            hhTrackerStreetActions = JSON.parse(JSON.stringify(hand.streetActions));
            hhTrackerCommunityCards = JSON.parse(JSON.stringify(hand.communityCards));
            hhTrackerWinner = hand.winner;
            
            // Update display
            document.getElementById('hh-hero-select-row').style.display = 'none';
            document.getElementById('hh-villain-select-row').style.display = 'none';
            
            // Only show position selection if this is the CURRENT hand AND it's in progress (not completed yet)
            const showPositionSelection = isCurrentHand && hand.inProgress && !hand.winner;
            document.getElementById('hh-position-row').style.display = showPositionSelection ? 'block' : 'none';
            document.getElementById('hh-street-card').style.display = showPositionSelection ? 'block' : 'none';
            
            // Show readonly summary
            document.getElementById('hh-readonly-hero').textContent = hand.hero;
            document.getElementById('hh-readonly-position').textContent = hand.heroPosition;
            const villainName = hand.villainName || 'Villain';
            document.getElementById('hh-readonly-villain').innerHTML = `${villainName} <span style="color: #5a5e66;">(${hand.villainPosition})</span>`;
            document.getElementById('hh-setup-readonly').style.display = 'block';
            
            // Show results if hand is complete
            if (!hand.inProgress || hand.winner) {
                hhShowResults(hand.winner ? 'showdown' : 'fold');
            }
            
            document.getElementById('hh-hero-cards').value = hand.heroCards;
            document.getElementById('hh-villain-cards').value = hand.villainCards;
            document.getElementById('hh-hand-notes').value = hand.notes || '';
            
            // Update viewing state
            if (!isCurrentHand) {
                hhViewingHandNumber = handNumber;
            }
            hhUpdateHandNumberDisplay();
        }
        
        function hhReturnToLiveHand() {
            // Check if current hand has been started
            const currentHandInStorage = hhStoredHands.find(h => h.handNumber === hhCurrentHandNumber);
            
            if (currentHandInStorage) {
                // Restore current hand in progress
                hhLoadStoredHand(hhCurrentHandNumber);
                hhViewingHandNumber = null;
                hhUpdateHandNumberDisplay();
                
                // If hand is in progress, show the action buttons
                if (currentHandInStorage.inProgress) {
                    document.getElementById('hh-street-card').style.display = 'block';
                    hhShowActionButtons();
                }
            } else {
                // Current hand hasn't started yet - show position selection
                hhViewingHandNumber = null;
                hhUpdateHandNumberDisplay();
                document.getElementById('hh-position-row').style.display = 'block';
                document.getElementById('hh-results-card').style.display = 'none';
                document.getElementById('hh-notes-section').style.display = 'none';
            }
        }
        
        // Populate player dropdown from database
        function hhPopulatePlayerDropdown() {
            const select = document.getElementById('hh-hero-select');
            if (!select) return;
            
            // Clear existing options except first
            while (select.options.length > 1) {
                select.remove(1);
            }
            
            // Add players from database
            if (database && database.realPlayers) {
                database.realPlayers.forEach(player => {
                    const option = document.createElement('option');
                    option.value = player.name;
                    option.textContent = player.name;
                    select.appendChild(option);
                });
            }
        }
        
        // Call on load and when database changes
        setTimeout(hhPopulatePlayerDropdown, 100);


        // Sync HH seats when session players change
        var _origRenderSessionPlayers = renderSessionPlayers;
        renderSessionPlayers = function() {
            _origRenderSessionPlayers();
            hhSyncSeats();
        };
        hhSyncSeats();

        // Session info field editing
        const sessionFieldConfig = {
            buyin: {
                input: 'session-buyin',
                display: 'session-buyin-display',
                format: (val) => '$' + parseInt(val).toLocaleString(),
                numeric: true
            },
            blindmin: {
                input: 'session-blind-minutes',
                display: 'session-blindmin-display',
                format: (val) => parseInt(val) + ' min',
                numeric: true
            },
            stack: {
                input: 'session-stack',
                display: 'session-stack-display',
                format: (val) => parseInt(val).toLocaleString() + ' chips',
                numeric: true
            },
            venue: {
                input: 'session-venue',
                display: 'session-venue-display',
                format: (val) => val,
                numeric: false
            },
            tournotes: {
                input: 'session-tournotes',
                display: 'session-tournotes-display',
                format: (val) => val,
                numeric: false
            }
        };

        function editSessionField(field) {
            const cfg = sessionFieldConfig[field];
            const input = document.getElementById(cfg.input);
            const display = document.getElementById(cfg.display);

            // Show input, hide display
            input.classList.remove('hidden');
            display.classList.add('hidden');

            // Set raw value for editing
            input.value = input.dataset.rawValue || '';
            input.focus();
            setTimeout(() => input.select(), 0);
        }

        function commitSessionField(field) {
            const cfg = sessionFieldConfig[field];
            const input = document.getElementById(cfg.input);
            const display = document.getElementById(cfg.display);

            const raw = input.value.trim();
            const val = cfg.numeric !== false ? raw.replace(/[^0-9.]/g, '') : raw;

            if (cfg.numeric !== false ? (val && parseFloat(val) > 0) : val.length > 0) {
                // Has value - show formatted display, hide input
                input.dataset.rawValue = val;
                display.textContent = cfg.format(val);
                display.classList.remove('hidden');
                input.classList.add('hidden');
            } else {
                // No value - keep input visible, hide display
                input.dataset.rawValue = '';
                display.classList.add('hidden');
                input.classList.remove('hidden');
            }
        }

        // Wire up blur and enter for all fields
        Object.keys(sessionFieldConfig).forEach(field => {
            const cfg = sessionFieldConfig[field];
            const input = document.getElementById(cfg.input);

            input.addEventListener('blur', () => commitSessionField(field));
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') { e.preventDefault(); input.blur(); }
                if (e.key === 'Escape') { e.preventDefault(); input.blur(); }
            });
        });

        // Wire up blind level edit inputs
        ['blind-sb-input', 'blind-bb-input', 'blind-ante-input'].forEach(inputId => {
            const input = document.getElementById(inputId);
            
            input.addEventListener('blur', () => {
                // Delay to allow tab navigation between fields
                setTimeout(() => {
                    const editRow = document.getElementById('blind-level-edit-row');
                    // Only commit if no other blind input is focused
                    if (!editRow.contains(document.activeElement)) {
                        commitBlindLevel();
                    }
                }, 100);
            });
            
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') { 
                    e.preventDefault(); 
                    commitBlindLevel();
                }
                if (e.key === 'Escape') { 
                    e.preventDefault(); 
                    commitBlindLevel();
                }
            });
        });

        // Format selector chip clicks
        document.getElementById('session-format-selector').addEventListener('click', function(e) {
            const chip = e.target.closest('.desc-chip');
            if (!chip) return;
            this.querySelectorAll('.desc-chip').forEach(c => c.classList.remove('active'));
            chip.classList.add('active');
        });

        // Initialize
        loadDatabase();
        
        // Initialize street states after a short delay to ensure DOM is ready
        setTimeout(function() {
            hhUpdateStreetStates();
        }, 100);

        // Slider label highlighting
        function initSlider(sliderId) {
            const slider = document.getElementById(sliderId);
            if (!slider) return;
            
            const labels = document.querySelectorAll(`[data-slider="${sliderId}"]`);
            
            slider.addEventListener('input', function() {
                labels.forEach(label => {
                    if (parseInt(label.dataset.value) === parseInt(this.value)) {
                        label.classList.add('active');
                    } else {
                        label.classList.remove('active');
                    }
                });
                // Update inlay position when slider changes
                updateSliderInlay(this);
            });
            
            // Initial inlay position
            setTimeout(() => updateSliderInlay(slider), 10);
        }

        // Position purple inlay triangle on slider thumb
        function updateSliderInlay(slider) {
            const container = slider.closest('.slider-container');
            if (!container) return;
            
            const min = parseFloat(slider.min);
            const max = parseFloat(slider.max);
            const value = parseFloat(slider.value);
            
            // Calculate percentage (0.0 to 1.0)
            const percentage = (value - min) / (max - min);
            
            // Calculate thumb center position
            const sliderRect = slider.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();
            
            // Sliders typically reserve space on each side for the thumb
            const thumbWidth = 18; // 9px on each side of triangle
            const availableWidth = sliderRect.width - thumbWidth;
            const thumbCenterX = (thumbWidth / 2) + (percentage * availableWidth);
            
            // Convert to position relative to container
            const containerOffsetX = sliderRect.left - containerRect.left;
            const inlayLeft = containerOffsetX + thumbCenterX;
            
            // Position the ::after pseudo-element via CSS variable
            container.style.setProperty('--inlay-left', `${inlayLeft}px`);
        }

        // Update CSS to use the variable
        const inlayStyle = document.createElement('style');
        inlayStyle.textContent = `
            .slider-container::after {
                left: var(--inlay-left, 50%) !important;
            }
        `;
        document.head.appendChild(inlayStyle);

        // Initialize all sliders
        ['vpip', 'pfr-aggression', 'fold3bet', 'coldcall',
         'postflop-aggression', 'foldcbet',
         'table-talk', 'attention',
         'stack-protection', 'skill-level'].forEach(initSlider);

        // Initialize player sliders
        ['player-vpip', 'player-pfr-aggression', 'player-fold3bet', 'player-coldcall',
         'player-postflop-aggression', 'player-foldcbet',
         'player-table-talk', 'player-attention',
         'player-style', 'player-cunning', 'player-thinking',
         'player-stack-protection', 'player-skill-level'].forEach(initSlider);

        // Update inlay positions on window resize
        window.addEventListener('resize', () => {
            document.querySelectorAll('.range-slider').forEach(slider => {
                updateSliderInlay(slider);
            });
        });

        // Function to update all player slider labels
        function updatePlayerSliders() {
            ['player-vpip', 'player-pfr-aggression', 'player-fold3bet', 'player-coldcall',
             'player-postflop-aggression', 'player-foldcbet',
             'player-table-talk', 'player-attention',
             'player-style', 'player-cunning', 'player-thinking',
             'player-stack-protection', 'player-skill-level'].forEach(sliderId => {
                const slider = document.getElementById(sliderId);
                if (!slider) return;
                const labels = document.querySelectorAll(`[data-slider="${sliderId}"]`);
                labels.forEach(label => {
                    if (parseInt(label.dataset.value) === parseInt(slider.value)) {
                        label.classList.add('active');
                    } else {
                        label.classList.remove('active');
                    }
                });
                // Update inlay position
                updateSliderInlay(slider);
            });
        }
    </script>
</body>
</html>